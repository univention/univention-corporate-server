var FCK_STATUS_NOTLOADED=window.parent.FCK_STATUS_NOTLOADED=0;var FCK_STATUS_ACTIVE=window.parent.FCK_STATUS_ACTIVE=1;var FCK_STATUS_COMPLETE=window.parent.FCK_STATUS_COMPLETE=2;var FCK_TRISTATE_OFF=window.parent.FCK_TRISTATE_OFF=0;var FCK_TRISTATE_ON=window.parent.FCK_TRISTATE_ON=1;var FCK_TRISTATE_DISABLED=window.parent.FCK_TRISTATE_DISABLED=-1;var FCK_UNKNOWN=window.parent.FCK_UNKNOWN=-9;var FCK_TOOLBARITEM_ONLYICON=window.parent.FCK_TOOLBARITEM_ONLYICON=0;var FCK_TOOLBARITEM_ONLYTEXT=window.parent.FCK_TOOLBARITEM_ONLYTEXT=1;var FCK_TOOLBARITEM_ICONTEXT=window.parent.FCK_TOOLBARITEM_ICONTEXT=2;var FCK_EDITMODE_WYSIWYG=window.parent.FCK_EDITMODE_WYSIWYG=0;var FCK_EDITMODE_SOURCE=window.parent.FCK_EDITMODE_SOURCE=1;var FCK_IMAGES_PATH="images/";var FCK_SPACER_PATH="images/spacer.gif";var CTRL=1000;var SHIFT=2000;var ALT=4000;var FCK_STYLE_BLOCK=0;var FCK_STYLE_INLINE=1;var FCK_STYLE_OBJECT=2;String.prototype.Contains=function(B){return(this.indexOf(B)>-1)};String.prototype.Equals=function(){var B=arguments;if(B.length==1&&B[0].pop){B=B[0]}for(var C=0;C<B.length;C++){if(this==B[C]){return true}}return false};String.prototype.IEquals=function(){var C=this.toUpperCase();var E=arguments;if(E.length==1&&E[0].pop){E=E[0]}for(var D=0;D<E.length;D++){if(C==E[D].toUpperCase()){return true}}return false};String.prototype.ReplaceAll=function(D,G){var F=this;for(var E=0;E<D.length;E++){F=F.replace(D[E],G[E])}return F};String.prototype.StartsWith=function(B){return(this.substr(0,B.length)==B)};String.prototype.EndsWith=function(F,J){var I=this.length;var H=F.length;if(H>I){return false}if(J){var G=new RegExp(F+"$","i");return G.test(this)}else{return(H==0||this.substr(I-H,H)==F)}};String.prototype.Remove=function(C,E){var D="";if(C>0){D=this.substring(0,C)}if(C+E<this.length){D+=this.substring(C+E,this.length)}return D};String.prototype.Trim=function(){return this.replace(/(^[ \t\n\r]*)|([ \t\n\r]*$)/g,"")};String.prototype.LTrim=function(){return this.replace(/^[ \t\n\r]*/g,"")};String.prototype.RTrim=function(){return this.replace(/[ \t\n\r]*$/g,"")};String.prototype.ReplaceNewLineChars=function(B){return this.replace(/\n/g,B)};String.prototype.Replace=function(D,F,E){if(typeof F=="function"){return this.replace(D,function(){return F.apply(E||this,arguments)})}else{return this.replace(D,F)}};Array.prototype.AddItem=function(B){var C=this.length;this[C]=B;return C};Array.prototype.IndexOf=function(B){for(var C=0;C<this.length;C++){if(this[C]==B){return C}}return-1};var s=navigator.userAgent.toLowerCase();var FCKBrowserInfo={IsIE:false,IsIE7:false&&(parseInt(s.match(/msie (\d+)/)[1],10)>=7),IsIE6:false&&(parseInt(s.match(/msie (\d+)/)[1],10)>=6),IsSafari:s.Contains(" applewebkit/"),IsOpera:!!window.opera,IsAIR:s.Contains(" adobeair/"),IsMac:s.Contains("macintosh")};(function(D){D.IsGecko=(navigator.product=="Gecko")&&!D.IsSafari&&!D.IsOpera;D.IsGeckoLike=(D.IsGecko||D.IsSafari||D.IsOpera);if(D.IsGecko){var F=s.match(/rv:(\d+\.\d+)/);var E=F&&parseFloat(F[1]);if(E){D.IsGecko10=(E<1.8);D.IsGecko19=(E>1.8)}}})(FCKBrowserInfo);var FCKURLParams={};(function(){var E=document.location.search.substr(1).split("&");for(var F=0;F<E.length;F++){var I=E[F].split("=");var H=decodeURIComponent(I[0]);var G=decodeURIComponent(I[1]);FCKURLParams[H]=G}})();var FCKEvents=function(B){this.Owner=B;this._RegisteredEvents={}};FCKEvents.prototype.AttachEvent=function(D,F){var E;if(!(E=this._RegisteredEvents[D])){this._RegisteredEvents[D]=[F]}else{if(E.IndexOf(F)==-1){E.push(F)}}};FCKEvents.prototype.FireEvent=function(E,J){var I=true;var H=this._RegisteredEvents[E];if(H){for(var F=0;F<H.length;F++){try{I=(H[F](this.Owner,J)&&I)}catch(G){if(G.number!=-2146823277){throw G}}}}return I};var FCKDataProcessor=function(){};FCKDataProcessor.prototype={ConvertToHtml:function(C){if(FCKConfig.FullPage){FCK.DocTypeDeclaration=C.match(FCKRegexLib.DocTypeTag);if(!FCKRegexLib.HasBodyTag.test(C)){C="<body>"+C+"</body>"}if(!FCKRegexLib.HtmlOpener.test(C)){C='<html dir="'+FCKConfig.ContentLangDirection+'">'+C+"</html>"}if(!FCKRegexLib.HeadOpener.test(C)){C=C.replace(FCKRegexLib.HtmlOpener,"$&<head><title></title></head>")}return C}else{var D=FCKConfig.DocType+'<html dir="'+FCKConfig.ContentLangDirection+'"';if(FCKBrowserInfo.IsIE&&FCKConfig.DocType.length>0&&!FCKRegexLib.Html4DocType.test(FCKConfig.DocType)){D+=' style="overflow-y: scroll"'}D+="><head><title></title></head><body"+FCKConfig.GetBodyAttributes()+">"+C+"</body></html>";return D}},ConvertToDataFormat:function(F,J,I,H){var G=FCKXHtml.GetXHTML(F,!J,H);if(I&&FCKRegexLib.EmptyOutParagraph.test(G)){return""}return G},FixHtml:function(B){return B}};var FCK={Name:FCKURLParams.InstanceName,Status:0,EditMode:0,Toolbar:null,HasFocus:false,DataProcessor:new FCKDataProcessor(),GetInstanceObject:(function(){var A=window;return function(B){return A[B]}})(),AttachToOnSelectionChange:function(B){this.Events.AttachEvent("OnSelectionChange",B)},GetLinkedFieldValue:function(){return this.LinkedField.value},GetParentForm:function(){return this.LinkedField.form},StartupValue:"",IsDirty:function(){if(this.EditMode==1){return(this.StartupValue!=this.EditingArea.Textarea.value)}else{if(!this.EditorDocument){return false}return(this.StartupValue!=this.EditorDocument.body.innerHTML)}},ResetIsDirty:function(){if(this.EditMode==1){this.StartupValue=this.EditingArea.Textarea.value}else{if(this.EditorDocument.body){this.StartupValue=this.EditorDocument.body.innerHTML}}},StartEditor:function(){this.TempBaseTag=FCKConfig.BaseHref.length>0?'<base href="'+FCKConfig.BaseHref+'" _fcktemp="true"></base>':"";var B=FCK.KeystrokeHandler=new FCKKeystrokeHandler();B.OnKeystroke=_FCK_KeystrokeHandler_OnKeystroke;B.SetKeystrokes(FCKConfig.Keystrokes);if(FCKBrowserInfo.IsIE7){if((CTRL+86)in B.Keystrokes){B.SetKeystrokes([CTRL+86,true])}if((SHIFT+45)in B.Keystrokes){B.SetKeystrokes([SHIFT+45,true])}}B.SetKeystrokes([CTRL+8,true]);this.EditingArea=new FCKEditingArea(document.getElementById("xEditingArea"));this.EditingArea.FFSpellChecker=FCKConfig.FirefoxSpellChecker;this.SetData(this.GetLinkedFieldValue(),true);FCKTools.AddEventListener(document,"keydown",this._TabKeyHandler);this.AttachToOnSelectionChange(_FCK_PaddingNodeListener);if(FCKBrowserInfo.IsGecko){this.AttachToOnSelectionChange(this._ExecCheckEmptyBlock)}},Focus:function(){FCK.EditingArea.Focus()},SetStatus:function(B){this.Status=B;if(B==1){FCKFocusManager.AddWindow(window,true);if(FCKBrowserInfo.IsIE){FCKFocusManager.AddWindow(window.frameElement,true)}if(FCKConfig.StartupFocus){FCK.Focus()}}this.Events.FireEvent("OnStatusChange",B)},FixBody:function(){var I=FCKConfig.EnterMode;if(I!="p"&&I!="div"){return}var P=this.EditorDocument;if(!P){return}var O=P.body;if(!O){return}FCKDomTools.TrimNode(O);var N=O.firstChild;var M;while(N){var L=false;switch(N.nodeType){case 1:var K=N.nodeName.toLowerCase();if(!FCKListsLib.BlockElements[K]&&K!="li"&&!N.getAttribute("_fckfakelement")&&N.getAttribute("_moz_dirty")==null){L=true}break;case 3:if(M||N.nodeValue.Trim().length>0){L=true}break;case 8:if(M){L=true}break}if(L){var J=N.parentNode;if(!M){M=J.insertBefore(P.createElement(I),N)}M.appendChild(J.removeChild(N));N=M.nextSibling}else{if(M){FCKDomTools.TrimNode(M);M=null}N=N.nextSibling}}if(M){FCKDomTools.TrimNode(M)}},GetData:function(E){if(FCK.EditMode==1){return FCK.EditingArea.Textarea.value}this.FixBody();var H=FCK.EditorDocument;if(!H){return null}var G=FCKConfig.FullPage;var F=FCK.DataProcessor.ConvertToDataFormat(G?H.documentElement:H.body,!G,FCKConfig.IgnoreEmptyParagraphValue,E);F=FCK.ProtectEventsRestore(F);if(FCKBrowserInfo.IsIE){F=F.replace(FCKRegexLib.ToReplace,"$1")}if(G){if(FCK.DocTypeDeclaration&&FCK.DocTypeDeclaration.length>0){F=FCK.DocTypeDeclaration+"\n"+F}if(FCK.XmlDeclaration&&FCK.XmlDeclaration.length>0){F=FCK.XmlDeclaration+"\n"+F}}return FCKConfig.ProtectedSource.Revert(F)},UpdateLinkedField:function(){var B=FCK.GetXHTML(FCKConfig.FormatOutput);if(FCKConfig.HtmlEncodeOutput){B=FCKTools.HTMLEncode(B)}FCK.LinkedField.value=B;FCK.Events.FireEvent("OnAfterLinkedFieldUpdate")},RegisteredDoubleClickHandlers:{},OnDoubleClick:function(C){var E=FCK.RegisteredDoubleClickHandlers[C.tagName.toUpperCase()];if(E){for(var D=0;D<E.length;D++){E[D](C)}}E=FCK.RegisteredDoubleClickHandlers["*"];if(E){for(var D=0;D<E.length;D++){E[D](C)}}},RegisterDoubleClickHandler:function(E,H){var G=H||"*";G=G.toUpperCase();var F;if(!(F=FCK.RegisteredDoubleClickHandlers[G])){FCK.RegisteredDoubleClickHandlers[G]=[E]}else{if(F.IndexOf(E)==-1){F.push(E)}}},OnAfterSetHTML:function(){FCKDocumentProcessor.Process(FCK.EditorDocument);FCKUndo.SaveUndoStep();FCK.Events.FireEvent("OnSelectionChange");FCK.Events.FireEvent("OnAfterSetHTML")},ProtectUrls:function(B){B=B.replace(FCKRegexLib.ProtectUrlsA,"$& _fcksavedurl=$1");B=B.replace(FCKRegexLib.ProtectUrlsImg,"$& _fcksavedurl=$1");B=B.replace(FCKRegexLib.ProtectUrlsArea,"$& _fcksavedurl=$1");return B},ProtectEvents:function(B){return B.replace(FCKRegexLib.TagsWithEvent,_FCK_ProtectEvents_ReplaceTags)},ProtectEventsRestore:function(B){return B.replace(FCKRegexLib.ProtectedEvents,_FCK_ProtectEvents_RestoreEvents)},ProtectTags:function(D){var F=FCKConfig.ProtectedTags;if(FCKBrowserInfo.IsIE){F+=F.length>0?"|ABBR|XML|EMBED|OBJECT":"ABBR|XML|EMBED|OBJECT"}var E;if(F.length>0){E=new RegExp("<("+F+")(?!w|:)","gi");D=D.replace(E,"<FCK:$1");E=new RegExp("</("+F+")>","gi");D=D.replace(E,"</FCK:$1>")}F="META";if(FCKBrowserInfo.IsIE){F+="|HR"}E=new RegExp("<(("+F+")(?=\\s|>|/)[\\s\\S]*?)/?>","gi");D=D.replace(E,"<FCK:$1 />");return D},SetData:function(D,F){this.EditingArea.Mode=FCK.EditMode;if(FCKBrowserInfo.IsIE&&FCK.EditorDocument){FCK.EditorDocument.detachEvent("onselectionchange",Doc_OnSelectionChange)}FCKTempBin.Reset();if(FCK.EditMode==0){this._ForceResetIsDirty=(F===true);D=FCKConfig.ProtectedSource.Protect(D);D=FCK.DataProcessor.ConvertToHtml(D);D=D.replace(FCKRegexLib.InvalidSelfCloseTags,"$1></$2>");D=FCK.ProtectEvents(D);D=FCK.ProtectUrls(D);D=FCK.ProtectTags(D);if(FCK.TempBaseTag.length>0&&!FCKRegexLib.HasBaseTag.test(D)){D=D.replace(FCKRegexLib.HeadOpener,"$&"+FCK.TempBaseTag)}var E="";if(!FCKConfig.FullPage){E+=_FCK_GetEditorAreaStyleTags()}if(FCKBrowserInfo.IsIE){E+=FCK._GetBehaviorsStyle()}else{if(FCKConfig.ShowBorders){E+=FCKTools.GetStyleHtml(FCK_ShowTableBordersCSS,true)}}E+=FCKTools.GetStyleHtml(FCK_InternalCSS,true);D=D.replace(FCKRegexLib.HeadCloser,E+"$&");this.EditingArea.OnLoad=_FCK_EditingArea_OnLoad;this.EditingArea.Start(D)}else{FCK.EditorWindow=null;FCK.EditorDocument=null;FCKDomTools.PaddingNode=null;this.EditingArea.OnLoad=null;this.EditingArea.Start(D);this.EditingArea.Textarea._FCKShowContextMenu=true;FCK.EnterKeyHandler=null;if(F){this.ResetIsDirty()}FCK.KeystrokeHandler.AttachToElement(this.EditingArea.Textarea);this.EditingArea.Textarea.focus();FCK.Events.FireEvent("OnAfterSetHTML")}if(FCKBrowserInfo.IsGecko){window.onresize()}},RedirectNamedCommands:{},ExecuteNamedCommand:function(E,H,G,F){if(!F){FCKUndo.SaveUndoStep()}if(!G&&FCK.RedirectNamedCommands[E]!=null){FCK.ExecuteRedirectedNamedCommand(E,H)}else{FCK.Focus();FCK.EditorDocument.execCommand(E,false,H);FCK.Events.FireEvent("OnSelectionChange")}if(!F){FCKUndo.SaveUndoStep()}},GetNamedCommandState:function(B){try{if(FCKBrowserInfo.IsSafari&&FCK.EditorWindow&&B.IEquals("Paste")){return 0}if(!FCK.EditorDocument.queryCommandEnabled(B)){return-1}else{return FCK.EditorDocument.queryCommandState(B)?1:0}}catch(C){return 0}},GetNamedCommandValue:function(D){var G="";var F=FCK.GetNamedCommandState(D);if(F==-1){return null}try{G=this.EditorDocument.queryCommandValue(D)}catch(E){}return G?G:""},Paste:function(B){if(FCK.Status!=2||!FCK.Events.FireEvent("OnPaste")){return false}return B||FCK._ExecPaste()},PasteFromWord:function(){FCKDialog.OpenDialog("FCKDialog_Paste",FCKLang.PasteFromWord,"dialog/fck_paste.html",400,330,"Word")},Preview:function(){var G;if(FCKConfig.FullPage){if(FCK.TempBaseTag.length>0){G=FCK.TempBaseTag+FCK.GetXHTML()}else{G=FCK.GetXHTML()}}else{G=FCKConfig.DocType+'<html dir="'+FCKConfig.ContentLangDirection+'"><head>'+FCK.TempBaseTag+"<title>"+FCKLang.Preview+"</title>"+_FCK_GetEditorAreaStyleTags()+"</head><body"+FCKConfig.GetBodyAttributes()+">"+FCK.GetXHTML()+"</body></html>"}var L=FCKConfig.ScreenWidth*0.8;var K=FCKConfig.ScreenHeight*0.7;var J=(FCKConfig.ScreenWidth-L)/2;var I="";if(FCK_IS_CUSTOM_DOMAIN&&FCKBrowserInfo.IsIE){window._FCKHtmlToLoad=G;I='javascript:void( (function(){document.open() ;document.domain="'+document.domain+'" ;document.write( window.opener._FCKHtmlToLoad );document.close() ;window.opener._FCKHtmlToLoad = null ;})() )'}var H=window.open(I,null,"toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+L+",height="+K+",left="+J);if(!FCK_IS_CUSTOM_DOMAIN||!FCKBrowserInfo.IsIE){H.document.write(G);H.document.close()}},SwitchEditMode:function(E){var H=(FCK.EditMode==0);var G=FCK.IsDirty();var F;if(H){FCKCommands.GetCommand("ShowBlocks").SaveState();if(!E&&FCKBrowserInfo.IsIE){FCKUndo.SaveUndoStep()}F=FCK.GetXHTML(FCKConfig.FormatSource);if(FCKBrowserInfo.IsIE){FCKTempBin.ToHtml()}if(F==null){return false}}else{F=this.EditingArea.Textarea.value}FCK.EditMode=H?1:0;FCK.SetData(F,!G);FCK.Focus();FCKTools.RunFunction(FCK.ToolbarSet.RefreshModeState,FCK.ToolbarSet);return true},InsertElement:function(E){if(typeof E=="string"){E=this.EditorDocument.createElement(E)}var H=E.nodeName.toLowerCase();FCKSelection.Restore();var G=new FCKDomRange(this.EditorWindow);G.MoveToSelection();G.DeleteContents();if(FCKListsLib.BlockElements[H]!=null){if(G.StartBlock){if(G.CheckStartOfBlock()){G.MoveToPosition(G.StartBlock,3)}else{if(G.CheckEndOfBlock()){G.MoveToPosition(G.StartBlock,4)}else{G.SplitBlock()}}}G.InsertNode(E);var F=FCKDomTools.GetNextSourceElement(E,false,null,["hr","br","param","img","area","input"],true);if(!F&&FCKConfig.EnterMode!="br"){F=this.EditorDocument.body.appendChild(this.EditorDocument.createElement(FCKConfig.EnterMode));if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(F)}}if(FCKListsLib.EmptyElements[H]==null){G.MoveToElementEditStart(E)}else{if(F){G.MoveToElementEditStart(F)}else{G.MoveToPosition(E,4)}}if(FCKBrowserInfo.IsGeckoLike){if(F){FCKDomTools.ScrollIntoView(F,false)}FCKDomTools.ScrollIntoView(E,false)}}else{G.InsertNode(E);G.SetStart(E,4);G.SetEnd(E,4)}G.Select();G.Release();this.Focus();return E},_InsertBlockElement:function(B){},_IsFunctionKey:function(B){if(B>=16&&B<=20){return true}if(B==27||(B>=33&&B<=40)){return true}if(B==45){return true}return false},_KeyDownListener:function(B){if(!B){B=FCK.EditorWindow.event}if(FCK.EditorWindow){if(!FCK._IsFunctionKey(B.keyCode)&&!(B.ctrlKey||B.metaKey)&&!(B.keyCode==46)){FCK._KeyDownUndo()}}return true},_KeyDownUndo:function(){if(!FCKUndo.Typing){FCKUndo.SaveUndoStep();FCKUndo.Typing=true;FCK.Events.FireEvent("OnSelectionChange")}FCKUndo.TypesCount++;FCKUndo.Changed=1;if(FCKUndo.TypesCount>FCKUndo.MaxTypes){FCKUndo.TypesCount=0;FCKUndo.SaveUndoStep()}},_TabKeyHandler:function(G){if(!G){G=window.event}var M=G.keyCode;if(M==9&&FCK.EditMode!=0){if(FCKBrowserInfo.IsIE){var L=document.selection.createRange();if(L.parentElement()!=FCK.EditingArea.Textarea){return true}L.text="\t";L.select()}else{var H=[];var K=FCK.EditingArea.Textarea;var J=K.selectionStart;var I=K.selectionEnd;H.push(K.value.substr(0,J));H.push("\t");H.push(K.value.substr(I));K.value=H.join("");K.setSelectionRange(J+1,J+1)}if(G.preventDefault){return G.preventDefault()}return G.returnValue=false}return true}};FCK.Events=new FCKEvents(FCK);FCK.GetHTML=FCK.GetXHTML=FCK.GetData;FCK.SetHTML=FCK.SetData;FCK.InsertElementAndGetIt=FCK.CreateElement=FCK.InsertElement;function _FCK_ProtectEvents_ReplaceTags(B){return B.replace(FCKRegexLib.EventAttributes,_FCK_ProtectEvents_ReplaceEvents)}function _FCK_ProtectEvents_ReplaceEvents(C,D){return" "+D+'_fckprotectedatt="'+encodeURIComponent(C)+'"'}function _FCK_ProtectEvents_RestoreEvents(C,D){return decodeURIComponent(D)}function _FCK_MouseEventsListener(B){if(!B){B=window.event}if(B.type=="mousedown"){FCK.MouseDownFlag=true}else{if(B.type=="mouseup"){FCK.MouseDownFlag=false}else{if(B.type=="mousemove"){FCK.Events.FireEvent("OnMouseMove",B)}}}}function _FCK_PaddingNodeListener(){if(FCKConfig.EnterMode.IEquals("br")){return}FCKDomTools.EnforcePaddingNode(FCK.EditorDocument,FCKConfig.EnterMode);if(!FCKBrowserInfo.IsIE&&FCKDomTools.PaddingNode){var E=FCKSelection.GetSelection();if(E&&E.rangeCount==1){var J=E.getRangeAt(0);if(J.collapsed&&J.startContainer==FCK.EditorDocument.body&&J.startOffset==0){J.selectNodeContents(FCKDomTools.PaddingNode);J.collapse(true);E.removeAllRanges();E.addRange(J)}}}else{if(FCKDomTools.PaddingNode){var I=FCKSelection.GetParentElement();var H=FCKDomTools.PaddingNode;if(I&&I.nodeName.IEquals("body")){if(FCK.EditorDocument.body.childNodes.length==1&&FCK.EditorDocument.body.firstChild==H){if(FCKSelection._GetSelectionDocument(FCK.EditorDocument.selection)!=FCK.EditorDocument){return}var J=FCK.EditorDocument.body.createTextRange();var G=false;if(!H.childNodes.firstChild){H.appendChild(FCKTools.GetElementDocument(H).createTextNode("\ufeff"));G=true}J.moveToElementText(H);J.select();if(G){J.pasteHTML("")}}}}}}function _FCK_EditingArea_OnLoad(){FCK.EditorWindow=FCK.EditingArea.Window;FCK.EditorDocument=FCK.EditingArea.Document;if(FCKBrowserInfo.IsIE){FCKTempBin.ToElements()}FCK.InitializeBehaviors();FCK.MouseDownFlag=false;FCKTools.AddEventListener(FCK.EditorDocument,"mousemove",_FCK_MouseEventsListener);FCKTools.AddEventListener(FCK.EditorDocument,"mousedown",_FCK_MouseEventsListener);FCKTools.AddEventListener(FCK.EditorDocument,"mouseup",_FCK_MouseEventsListener);if(FCKBrowserInfo.IsSafari){var B=function(A){if(!(A.ctrlKey||A.metaKey)){return}if(FCK.EditMode!=0){return}switch(A.keyCode){case 89:FCKUndo.Redo();break;case 90:FCKUndo.Undo();break}};FCKTools.AddEventListener(FCK.EditorDocument,"keyup",B)}FCK.EnterKeyHandler=new FCKEnterKey(FCK.EditorWindow,FCKConfig.EnterMode,FCKConfig.ShiftEnterMode,FCKConfig.TabSpaces);FCK.KeystrokeHandler.AttachToElement(FCK.EditorDocument);if(FCK._ForceResetIsDirty){FCK.ResetIsDirty()}if(FCKBrowserInfo.IsIE&&FCK.HasFocus){FCK.EditorDocument.body.setActive()}FCK.OnAfterSetHTML();FCKCommands.GetCommand("ShowBlocks").RestoreState();if(FCK.Status!=0){return}FCK.SetStatus(1)}function _FCK_GetEditorAreaStyleTags(){return FCKTools.GetStyleHtml(FCKConfig.EditorAreaCSS)+FCKTools.GetStyleHtml(FCKConfig.EditorAreaStyles)}function _FCK_KeystrokeHandler_OnKeystroke(D,F){if(FCK.Status!=2){return false}if(FCK.EditMode==0){switch(F){case"Paste":return!FCK.Paste();case"Cut":FCKUndo.SaveUndoStep();return false}}else{if(F.Equals("Paste","Undo","Redo","SelectAll","Cut")){return false}}var E=FCK.Commands.GetCommand(F);if(E.GetState()==-1){return false}return(E.Execute.apply(E,FCKTools.ArgumentsToArray(arguments,2))!==false)}(function(){var C=window.parent.document;var E=C.getElementById(FCK.Name);var D=0;while(E||D==0){if(E&&E.tagName.toLowerCase().Equals("input","textarea")){FCK.LinkedField=E;break}E=C.getElementsByName(FCK.Name)[D++]}})();var FCKTempBin={Elements:[],AddElement:function(C){var D=this.Elements.length;this.Elements[D]=C;return D},RemoveElement:function(B){var C=this.Elements[B];this.Elements[B]=null;return C},Reset:function(){var A=0;while(A<this.Elements.length){this.Elements[A++]=null}this.Elements.length=0},ToHtml:function(){for(var A=0;A<this.Elements.length;A++){this.Elements[A]="<div>&nbsp;"+this.Elements[A].outerHTML+"</div>";this.Elements[A].isHtml=true}},ToElements:function(){var B=FCK.EditorDocument.createElement("div");for(var C=0;C<this.Elements.length;C++){if(this.Elements[C].isHtml){B.innerHTML=this.Elements[C];this.Elements[C]=B.firstChild.removeChild(B.firstChild.lastChild)}}}};var FCKFocusManager=FCK.FocusManager={IsLocked:false,AddWindow:function(D,F){var E;if(FCKBrowserInfo.IsIE){E=D.nodeType==1?D:D.frameElement?D.frameElement:D.document}else{if(FCKBrowserInfo.IsSafari){E=D}else{E=D.document}}FCKTools.AddEventListener(E,"blur",FCKFocusManager_Win_OnBlur);FCKTools.AddEventListener(E,"focus",F?FCKFocusManager_Win_OnFocus_Area:FCKFocusManager_Win_OnFocus)},RemoveWindow:function(B){if(FCKBrowserInfo.IsIE){oTarget=B.nodeType==1?B:B.frameElement?B.frameElement:B.document}else{oTarget=B.document}FCKTools.RemoveEventListener(oTarget,"blur",FCKFocusManager_Win_OnBlur);FCKTools.RemoveEventListener(oTarget,"focus",FCKFocusManager_Win_OnFocus_Area);FCKTools.RemoveEventListener(oTarget,"focus",FCKFocusManager_Win_OnFocus)},Lock:function(){this.IsLocked=true},Unlock:function(){if(this._HasPendingBlur){FCKFocusManager._Timer=window.setTimeout(FCKFocusManager_FireOnBlur,100)}this.IsLocked=false},_ResetTimer:function(){this._HasPendingBlur=false;if(this._Timer){window.clearTimeout(this._Timer);delete this._Timer}}};function FCKFocusManager_Win_OnBlur(){if(typeof(FCK)!="undefined"&&FCK.HasFocus){FCKFocusManager._ResetTimer();FCKFocusManager._Timer=window.setTimeout(FCKFocusManager_FireOnBlur,100)}}function FCKFocusManager_FireOnBlur(){if(FCKFocusManager.IsLocked){FCKFocusManager._HasPendingBlur=true}else{FCK.HasFocus=false;FCK.Events.FireEvent("OnBlur")}}function FCKFocusManager_Win_OnFocus_Area(){if(FCKFocusManager._IsFocusing){return}FCKFocusManager._IsFocusing=true;FCK.Focus();FCKFocusManager_Win_OnFocus();FCKTools.RunFunction(function(){delete FCKFocusManager._IsFocusing})}function FCKFocusManager_Win_OnFocus(){FCKFocusManager._ResetTimer();if(!FCK.HasFocus&&!FCKFocusManager.IsLocked){FCK.HasFocus=true;FCK.Events.FireEvent("OnFocus")}}(function(){var E=window.frameElement;var H=E.width;var G=E.height;if(/^\d+$/.test(H)){H+="px"}if(/^\d+$/.test(G)){G+="px"}var F=E.style;F.border=F.padding=F.margin=0;F.backgroundColor="transparent";F.backgroundImage="none";F.width=H;F.height=G})();FCK.Description="FCKeditor for Gecko Browsers";FCK.InitializeBehaviors=function(){if(window.onresize){window.onresize()}FCKFocusManager.AddWindow(this.EditorWindow);this.ExecOnSelectionChange=function(){FCK.Events.FireEvent("OnSelectionChange")};this._ExecDrop=function(C){if(FCK.MouseDownFlag){FCK.MouseDownFlag=false;return}if(FCKConfig.ForcePasteAsPlainText){if(C.dataTransfer){var B=C.dataTransfer.getData("Text");B=FCKTools.HTMLEncode(B);B=FCKTools.ProcessLineBreaks(window,FCKConfig,B);FCK.InsertHtml(B)}else{if(FCKConfig.ShowDropDialog){FCK.PasteAsPlainText()}}C.preventDefault();C.stopPropagation()}};this._ExecCheckCaret=function(D){if(FCK.EditMode!=0){return}if(D.type=="keypress"){var H=D.keyCode;if(H<33||H>40){return}}var G=function(B){if(B.nodeType!=1){return false}var C=B.tagName.toLowerCase();return(FCKListsLib.BlockElements[C]||FCKListsLib.EmptyElements[C])};var F=function(){var Q=FCKSelection.GetSelection();var P=Q.getRangeAt(0);if(!P||!P.collapsed){return}var O=P.endContainer;if(O.nodeType!=3){return}if(O.nodeValue.length!=P.endOffset){return}var N=O.parentNode.tagName.toLowerCase();if(!(N=="a"||(!FCKBrowserInfo.IsOpera&&String(O.parentNode.contentEditable)=="false")||(!(FCKListsLib.BlockElements[N]||FCKListsLib.NonEmptyBlockElements[N])&&H==35))){return}var E=FCKTools.GetNextTextNode(O,O.parentNode,G);if(E){return}P=FCK.EditorDocument.createRange();E=FCKTools.GetNextTextNode(O,O.parentNode.parentNode,G);if(E){if(FCKBrowserInfo.IsOpera&&H==37){return}P.setStart(E,0);P.setEnd(E,0)}else{while(O.parentNode&&O.parentNode!=FCK.EditorDocument.body&&O.parentNode!=FCK.EditorDocument.documentElement&&O==O.parentNode.lastChild&&(!FCKListsLib.BlockElements[O.parentNode.tagName.toLowerCase()]&&!FCKListsLib.NonEmptyBlockElements[O.parentNode.tagName.toLowerCase()])){O=O.parentNode}if(FCKListsLib.BlockElements[N]||FCKListsLib.EmptyElements[N]||O==FCK.EditorDocument.body){P.setStart(O,O.childNodes.length);P.setEnd(O,O.childNodes.length)}else{var C=O.nextSibling;while(C){if(C.nodeType!=1){C=C.nextSibling;continue}var B=C.tagName.toLowerCase();if(FCKListsLib.BlockElements[B]||FCKListsLib.EmptyElements[B]||FCKListsLib.NonEmptyBlockElements[B]){break}C=C.nextSibling}var R=FCK.EditorDocument.createTextNode("");if(C){O.parentNode.insertBefore(R,C)}else{O.parentNode.appendChild(R)}P.setStart(R,0);P.setEnd(R,0)}}Q.removeAllRanges();Q.addRange(P);FCK.Events.FireEvent("OnSelectionChange")};setTimeout(F,1)};this.ExecOnSelectionChangeTimer=function(){if(FCK.LastOnChangeTimer){window.clearTimeout(FCK.LastOnChangeTimer)}FCK.LastOnChangeTimer=window.setTimeout(FCK.ExecOnSelectionChange,100)};this.EditorDocument.addEventListener("mouseup",this.ExecOnSelectionChange,false);this.EditorDocument.addEventListener("keyup",this.ExecOnSelectionChangeTimer,false);this._DblClickListener=function(B){FCK.OnDoubleClick(B.target);B.stopPropagation()};this.EditorDocument.addEventListener("dblclick",this._DblClickListener,true);this.EditorDocument.addEventListener("keydown",this._KeyDownListener,false);if(FCKBrowserInfo.IsGecko){this.EditorWindow.addEventListener("dragdrop",this._ExecDrop,true)}else{if(FCKBrowserInfo.IsSafari){var A=function(B){if(!FCK.MouseDownFlag){B.returnValue=false}};this.EditorDocument.addEventListener("dragenter",A,true);this.EditorDocument.addEventListener("dragover",A,true);this.EditorDocument.addEventListener("drop",this._ExecDrop,true);this.EditorDocument.addEventListener("mousedown",function(B){var C=B.srcElement;if(C.nodeName.IEquals("IMG","HR","INPUT","TEXTAREA","SELECT")){FCKSelection.SelectNode(C)}},true);this.EditorDocument.addEventListener("mouseup",function(B){if(B.srcElement.nodeName.IEquals("INPUT","TEXTAREA","SELECT")){B.preventDefault()}},true);this.EditorDocument.addEventListener("click",function(B){if(B.srcElement.nodeName.IEquals("INPUT","TEXTAREA","SELECT")){B.preventDefault()}},true)}}if(FCKBrowserInfo.IsGecko||FCKBrowserInfo.IsOpera){this.EditorDocument.addEventListener("keypress",this._ExecCheckCaret,false);this.EditorDocument.addEventListener("click",this._ExecCheckCaret,false)}FCK.ContextMenu._InnerContextMenu.SetMouseClickWindow(FCK.EditorWindow);FCK.ContextMenu._InnerContextMenu.AttachToElement(FCK.EditorDocument)};FCK.MakeEditable=function(){this.EditingArea.MakeEditable()};function Document_OnContextMenu(A){if(!A.target._FCKShowContextMenu){A.preventDefault()}}document.oncontextmenu=Document_OnContextMenu;FCK._BaseGetNamedCommandState=FCK.GetNamedCommandState;FCK.GetNamedCommandState=function(B){switch(B){case"Unlink":return FCKSelection.HasAncestorNode("A")?0:-1;default:return FCK._BaseGetNamedCommandState(B)}};FCK.RedirectNamedCommands={Print:true,Paste:true};FCK.ExecuteRedirectedNamedCommand=function(C,E){switch(C){case"Print":FCK.EditorWindow.print();break;case"Paste":try{if(FCKBrowserInfo.IsSafari){throw""}if(FCK.Paste()){FCK.ExecuteNamedCommand("Paste",null,true)}}catch(D){FCKDialog.OpenDialog("FCKDialog_Paste",FCKLang.Paste,"dialog/fck_paste.html",400,330,"Security")}break;default:FCK.ExecuteNamedCommand(C,E)}};FCK._ExecPaste=function(){FCKUndo.SaveUndoStep();if(FCKConfig.ForcePasteAsPlainText){FCK.PasteAsPlainText();return false}return true};FCK.InsertHtml=function(F){var L=FCK.EditorDocument,G;F=FCKConfig.ProtectedSource.Protect(F);F=FCK.ProtectEvents(F);F=FCK.ProtectUrls(F);F=FCK.ProtectTags(F);FCKUndo.SaveUndoStep();if(FCKBrowserInfo.IsGecko){F=F.replace(/&nbsp;$/,'$&<span _fcktemp="1"/>');var K=new FCKDocumentFragment(this.EditorDocument);K.AppendHtml(F);var J=K.RootNode.lastChild;G=new FCKDomRange(this.EditorWindow);G.MoveToSelection();G.DeleteContents();G.InsertNode(K.RootNode);G.MoveToPosition(J,4)}else{L.execCommand("inserthtml",false,F)}this.Focus();if(!G){G=new FCKDomRange(this.EditorWindow);G.MoveToSelection()}var H=G.CreateBookmark();FCKDocumentProcessor.Process(L);try{G.MoveToBookmark(H);G.Select()}catch(I){}this.Events.FireEvent("OnSelectionChange")};FCK.PasteAsPlainText=function(){FCKTools.RunFunction(FCKDialog.OpenDialog,FCKDialog,["FCKDialog_Paste",FCKLang.PasteAsText,"dialog/fck_paste.html",400,330,"PlainText"])};FCK.GetClipboardHTML=function(){return""};FCK.CreateLink=function(G,M){var L=[];if(FCKSelection.GetSelection().isCollapsed){return L}FCK.ExecuteNamedCommand("Unlink",null,false,!!M);if(G.length>0){var K="javascript:void(0);/*"+(new Date().getTime())+"*/";FCK.ExecuteNamedCommand("CreateLink",K,false,!!M);var J=this.EditorDocument.evaluate("//a[@href='"+K+"']",this.EditorDocument.body,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(var H=0;H<J.snapshotLength;H++){var I=J.snapshotItem(H);I.href=G;L.push(I)}}return L};FCK._FillEmptyBlock=function(C){if(!C||C.nodeType!=1){return}var D=C.tagName.toLowerCase();if(D!="p"&&D!="div"){return}if(C.firstChild){return}FCKTools.AppendBogusBr(C)};FCK._ExecCheckEmptyBlock=function(){FCK._FillEmptyBlock(FCK.EditorDocument.body.firstChild);var C=FCKSelection.GetSelection();if(!C||C.rangeCount<1){return}var D=C.getRangeAt(0);FCK._FillEmptyBlock(D.startContainer)};var FCKConfig=FCK.Config={};if(document.location.protocol=="file:"){FCKConfig.BasePath=decodeURIComponent(document.location.pathname.substr(1));FCKConfig.BasePath=FCKConfig.BasePath.replace(/\\/gi,"/");var sFullProtocol=document.location.href.match(/^(file\:\/{2,3})/)[1];if(FCKBrowserInfo.IsOpera){sFullProtocol+="localhost/"}FCKConfig.BasePath=sFullProtocol+FCKConfig.BasePath.substring(0,FCKConfig.BasePath.lastIndexOf("/")+1)}else{FCKConfig.BasePath=document.location.protocol+"//"+document.location.host+document.location.pathname.substring(0,document.location.pathname.lastIndexOf("/")+1)}FCKConfig.FullBasePath=FCKConfig.BasePath;FCKConfig.EditorPath=FCKConfig.BasePath.replace(/editor\/$/,"");try{FCKConfig.ScreenWidth=screen.width;FCKConfig.ScreenHeight=screen.height}catch(e){FCKConfig.ScreenWidth=800;FCKConfig.ScreenHeight=600}FCKConfig.ProcessHiddenField=function(){this.PageConfig={};var F=window.parent.document.getElementById(FCK.Name+"___Config");if(!F){return}var K=F.value.split("&");for(var G=0;G<K.length;G++){if(K[G].length==0){continue}var J=K[G].split("=");var I=decodeURIComponent(J[0]);var H=decodeURIComponent(J[1]);if(I=="CustomConfigurationsPath"){FCKConfig[I]=H}else{if(H.toLowerCase()=="true"){this.PageConfig[I]=true}else{if(H.toLowerCase()=="false"){this.PageConfig[I]=false}else{if(H.length>0&&!isNaN(H)){this.PageConfig[I]=parseInt(H,10)}else{this.PageConfig[I]=H}}}}}};function FCKConfig_LoadPageConfig(){var C=FCKConfig.PageConfig;for(var D in C){FCKConfig[D]=C[D]}}function FCKConfig_PreProcess(){var C=FCKConfig;if(C.AllowQueryStringDebug){try{if((/fckdebug=true/i).test(window.top.location.search)){C.Debug=true}}catch(D){}}if(!C.PluginsPath.EndsWith("/")){C.PluginsPath+="/"}var E=C.ToolbarComboPreviewCSS;if(!E||E.length==0){C.ToolbarComboPreviewCSS=C.EditorAreaCSS}C.RemoveAttributesArray=(C.RemoveAttributes||"").split(",");if(!FCKConfig.SkinEditorCSS||FCKConfig.SkinEditorCSS.length==0){FCKConfig.SkinEditorCSS=FCKConfig.SkinPath+"fck_editor.css"}if(!FCKConfig.SkinDialogCSS||FCKConfig.SkinDialogCSS.length==0){FCKConfig.SkinDialogCSS=FCKConfig.SkinPath+"fck_dialog.css"}}FCKConfig.ToolbarSets={};FCKConfig.Plugins={};FCKConfig.Plugins.Items=[];FCKConfig.Plugins.Add=function(D,F,E){FCKConfig.Plugins.Items.AddItem([D,F,E])};FCKConfig.ProtectedSource={};FCKConfig.ProtectedSource._CodeTag=(new Date()).valueOf();FCKConfig.ProtectedSource.RegexEntries=[/<!--[\s\S]*?-->/g,/<script[\s\S]*?<\/script>/gi,/<noscript[\s\S]*?<\/noscript>/gi];FCKConfig.ProtectedSource.Add=function(B){this.RegexEntries.AddItem(B)};FCKConfig.ProtectedSource.Protect=function(C){var F=this._CodeTag;function E(A){var B=FCKTempBin.AddElement(A);return"<!--{"+F+B+"}-->"}for(var D=0;D<this.RegexEntries.length;D++){C=C.replace(this.RegexEntries[D],E)}return C};FCKConfig.ProtectedSource.Revert=function(C,G){function F(A,D,B){var H=G?FCKTempBin.RemoveElement(B):FCKTempBin.Elements[B];return FCKConfig.ProtectedSource.Revert(H,G)}var E=new RegExp("(<|&lt;)!--\\{"+this._CodeTag+"(\\d+)\\}--(>|&gt;)","g");return C.replace(E,F)};FCKConfig.GetBodyAttributes=function(){var B="";if(this.BodyId&&this.BodyId.length>0){B+=' id="'+this.BodyId+'"'}if(this.BodyClass&&this.BodyClass.length>0){B+=' class="'+this.BodyClass+'"'}return B};FCKConfig.ApplyBodyAttributes=function(B){if(this.BodyId&&this.BodyId.length>0){B.id=FCKConfig.BodyId}if(this.BodyClass&&this.BodyClass.length>0){B.className+=" "+FCKConfig.BodyClass}};var FCKDebug={Output:function(){},OutputObject:function(){}};var FCKDomTools={MoveChildren:function(E,H,G){if(E==H){return}var F;if(G){while((F=E.lastChild)){H.insertBefore(E.removeChild(F),H.firstChild)}}else{while((F=E.firstChild)){H.appendChild(E.removeChild(F))}}},MoveNode:function(D,F,E){if(E){F.insertBefore(FCKDomTools.RemoveNode(D),F.firstChild)}else{F.appendChild(FCKDomTools.RemoveNode(D))}},TrimNode:function(B){this.LTrimNode(B);this.RTrimNode(B)},LTrimNode:function(E){var H;while((H=E.firstChild)){if(H.nodeType==3){var G=H.nodeValue.LTrim();var F=H.nodeValue.length;if(G.length==0){E.removeChild(H);continue}else{if(G.length<F){H.splitText(F-G.length);E.removeChild(E.firstChild)}}}break}},RTrimNode:function(E){var H;while((H=E.lastChild)){if(H.nodeType==3){var G=H.nodeValue.RTrim();var F=H.nodeValue.length;if(G.length==0){H.parentNode.removeChild(H);continue}else{if(G.length<F){H.splitText(G.length);E.lastChild.parentNode.removeChild(E.lastChild)}}}break}if(!FCKBrowserInfo.IsIE&&!FCKBrowserInfo.IsOpera){H=E.lastChild;if(H&&H.nodeType==1&&H.nodeName.toLowerCase()=="br"){H.parentNode.removeChild(H)}}},RemoveNode:function(D,F){if(F){var E;while((E=D.firstChild)){D.parentNode.insertBefore(D.removeChild(E),D)}}return D.parentNode.removeChild(D)},GetFirstChild:function(D,F){if(typeof(F)=="string"){F=[F]}var E=D.firstChild;while(E){if(E.nodeType==1&&E.tagName.Equals.apply(E.tagName,F)){return E}E=E.nextSibling}return null},GetLastChild:function(D,F){if(typeof(F)=="string"){F=[F]}var E=D.lastChild;while(E){if(E.nodeType==1&&(!F||E.tagName.Equals(F))){return E}E=E.previousSibling}return null},GetPreviousSourceElement:function(E,H,G,F){if(!E){return null}if(G&&E.nodeType==1&&E.nodeName.IEquals(G)){return null}if(E.previousSibling){E=E.previousSibling}else{return this.GetPreviousSourceElement(E.parentNode,H,G,F)}while(E){if(E.nodeType==1){if(G&&E.nodeName.IEquals(G)){break}if(!F||!E.nodeName.IEquals(F)){return E}}else{if(H&&E.nodeType==3&&E.nodeValue.RTrim().length>0){break}}if(E.lastChild){E=E.lastChild}else{return this.GetPreviousSourceElement(E,H,G,F)}}return null},GetNextSourceElement:function(F,J,I,H,G){while((F=this.GetNextSourceNode(F,G))){if(F.nodeType==1){if(I&&F.nodeName.IEquals(I)){break}if(H&&F.nodeName.IEquals(H)){return this.GetNextSourceElement(F,J,I,H)}return F}else{if(J&&F.nodeType==3&&F.nodeValue.RTrim().length>0){break}}}return null},GetNextSourceNode:function(F,J,I,H){if(!F){return null}var G;if(!J&&F.firstChild){G=F.firstChild}else{if(H&&F==H){return null}G=F.nextSibling;if(!G&&(!H||H!=F.parentNode)){return this.GetNextSourceNode(F.parentNode,true,I,H)}}if(I&&G&&G.nodeType!=I){return this.GetNextSourceNode(G,false,I,H)}return G},GetPreviousSourceNode:function(F,J,I,H){if(!F){return null}var G;if(!J&&F.lastChild){G=F.lastChild}else{if(H&&F==H){return null}G=F.previousSibling;if(!G&&(!H||H!=F.parentNode)){return this.GetPreviousSourceNode(F.parentNode,true,I,H)}}if(I&&G&&G.nodeType!=I){return this.GetPreviousSourceNode(G,false,I,H)}return G},InsertAfterNode:function(C,D){return C.parentNode.insertBefore(D,C.nextSibling)},GetParents:function(C){var D=[];while(C){D.unshift(C);C=C.parentNode}return D},GetCommonParents:function(F,K){var J=this.GetParents(F);var I=this.GetParents(K);var H=[];for(var G=0;G<J.length;G++){if(J[G]==I[G]){H.push(J[G])}}return H},GetCommonParentNode:function(G,L,K){var J={};if(!K.pop){K=[K]}while(K.length>0){J[K.pop().toLowerCase()]=1}var I=this.GetCommonParents(G,L);var H=null;while((H=I.pop())){if(J[H.nodeName.toLowerCase()]){return H}}return null},GetIndexOf:function(D){var F=D.parentNode?D.parentNode.firstChild:null;var E=-1;while(F){E++;if(F==D){return E}F=F.nextSibling}return-1},PaddingNode:null,EnforcePaddingNode:function(D,G){try{if(!D||!D.body){return}}catch(E){return}this.CheckAndRemovePaddingNode(D,G,true);try{if(D.body.lastChild&&(D.body.lastChild.nodeType!=1||D.body.lastChild.tagName.toLowerCase()==G.toLowerCase())){return}}catch(E){return}var F=D.createElement(G);if(FCKBrowserInfo.IsGecko&&FCKListsLib.NonEmptyBlockElements[G]){FCKTools.AppendBogusBr(F)}this.PaddingNode=F;if(D.body.childNodes.length==1&&D.body.firstChild.nodeType==1&&D.body.firstChild.tagName.toLowerCase()=="br"&&(D.body.firstChild.getAttribute("_moz_dirty")!=null||D.body.firstChild.getAttribute("type")=="_moz")){D.body.replaceChild(F,D.body.firstChild)}else{D.body.appendChild(F)}},CheckAndRemovePaddingNode:function(E,I,H){var G=this.PaddingNode;if(!G){return}try{if(G.parentNode!=E.body||G.tagName.toLowerCase()!=I||(G.childNodes.length>1)||(G.firstChild&&G.firstChild.nodeValue!="\xa0"&&String(G.firstChild.tagName).toLowerCase()!="br")){this.PaddingNode=null;return}}catch(F){this.PaddingNode=null;return}if(!H){if(G.parentNode.childNodes.length>1){G.parentNode.removeChild(G)}this.PaddingNode=null}},HasAttribute:function(D,F){if(D.hasAttribute){return D.hasAttribute(F)}else{var E=D.attributes[F];return(E!=undefined&&E.specified)}},HasAttributes:function(C){var E=C.attributes;for(var D=0;D<E.length;D++){if(FCKBrowserInfo.IsIE&&E[D].nodeName=="class"){if(C.className.length>0){return true}}else{if(E[D].specified){return true}}}return false},RemoveAttribute:function(C,D){if(FCKBrowserInfo.IsIE&&D.toLowerCase()=="class"){D="className"}return C.removeAttribute(D,0)},RemoveAttributes:function(C,E){for(var D=0;D<E.length;D++){this.RemoveAttribute(C,E[D])}},GetAttributeValue:function(D,F){var E=F;if(typeof F=="string"){F=D.attributes[F]}else{E=F.nodeName}if(F&&F.specified){if(E=="style"){return D.style.cssText}else{if(E=="class"||E.indexOf("on")==0){return F.nodeValue}else{return D.getAttribute(E,2)}}}return null},Contains:function(C,D){if(C.contains&&D.nodeType==1){return C.contains(D)}while((D=D.parentNode)){if(D==C){return true}}return false},BreakParent:function(F,J,I){var H=I||new FCKDomRange(FCKTools.GetElementWindow(F));H.SetStart(F,4);H.SetEnd(J,4);var G=H.ExtractContents();H.InsertNode(F.parentNode.removeChild(F));G.InsertAfterNode(F);H.Release(!!I)},GetNodeAddress:function(G,M){var L=[];while(G&&G!=FCKTools.GetElementDocument(G).documentElement){var K=G.parentNode;var J=-1;for(var H=0;H<K.childNodes.length;H++){var I=K.childNodes[H];if(M===true&&I.nodeType==3&&I.previousSibling&&I.previousSibling.nodeType==3){continue}J++;if(K.childNodes[H]==G){break}}L.unshift(J);G=G.parentNode}return L},GetNodeFromAddress:function(K,J,I){var H=K.documentElement;for(var M=0;M<J.length;M++){var P=J[M];if(!I){H=H.childNodes[P];continue}var O=-1;for(var L=0;L<H.childNodes.length;L++){var N=H.childNodes[L];if(I===true&&N.nodeType==3&&N.previousSibling&&N.previousSibling.nodeType==3){continue}O++;if(O==P){H=N;break}}}return H},CloneElement:function(B){B=B.cloneNode(false);B.removeAttribute("id",false);return B},ClearElementJSProperty:function(C,D){if(FCKBrowserInfo.IsIE){C.removeAttribute(D)}else{delete C[D]}},SetElementMarker:function(F,J,I,H){var G=String(parseInt(Math.random()*4294967295,10));J._FCKMarkerId=G;J[I]=H;if(!F[G]){F[G]={element:J,markers:{}}}F[G]["markers"][I]=H},ClearElementMarkers:function(E,I,H){var G=I._FCKMarkerId;if(!G){return}this.ClearElementJSProperty(I,"_FCKMarkerId");for(var F in E[G]["markers"]){this.ClearElementJSProperty(I,F)}if(H){delete E[G]}},ClearAllMarkers:function(B){for(var C in B){this.ClearElementMarkers(B,B[C]["element"],true)}},ListToArray:function(L,K,J,I,R){if(!L.nodeName.IEquals(["ul","ol"])){return[]}if(!I){I=0}if(!J){J=[]}for(var N=0;N<L.childNodes.length;N++){var Q=L.childNodes[N];if(!Q.nodeName.IEquals("li")){continue}var P={parent:L,indent:I,contents:[]};if(!R){P.grandparent=L.parentNode;if(P.grandparent&&P.grandparent.nodeName.IEquals("li")){P.grandparent=P.grandparent.parentNode}}else{P.grandparent=R}if(K){this.SetElementMarker(K,Q,"_FCK_ListArray_Index",J.length)}J.push(P);for(var M=0;M<Q.childNodes.length;M++){var O=Q.childNodes[M];if(O.nodeName.IEquals(["ul","ol"])){this.ListToArray(O,K,J,I+1,P.grandparent)}else{P.contents.push(O)}}}return J},ArrayToList:function(Q,P,O){if(O==undefined){O=0}if(!Q||Q.length<O+1){return null}var L=FCKTools.GetElementDocument(Q[O].parent);var a=L.createDocumentFragment();var Z=null;var Y=O;var X=Math.max(Q[O].indent,0);var W=null;while(true){var V=Q[Y];if(V.indent==X){if(!Z||Q[Y].parent.nodeName!=Z.nodeName){Z=Q[Y].parent.cloneNode(false);a.appendChild(Z)}W=L.createElement("li");Z.appendChild(W);for(var R=0;R<V.contents.length;R++){W.appendChild(V.contents[R].cloneNode(true))}Y++}else{if(V.indent==Math.max(X,0)+1){var U=this.ArrayToList(Q,null,Y);W.appendChild(U.listNode);Y=U.nextIndex}else{if(V.indent==-1&&O==0&&V.grandparent){var W;if(V.grandparent.nodeName.IEquals(["ul","ol"])){W=L.createElement("li")}else{if(FCKConfig.EnterMode.IEquals(["div","p"])&&!V.grandparent.nodeName.IEquals("td")){W=L.createElement(FCKConfig.EnterMode)}else{W=L.createDocumentFragment()}}for(var R=0;R<V.contents.length;R++){W.appendChild(V.contents[R].cloneNode(true))}if(W.nodeType==11){if(W.lastChild&&W.lastChild.getAttribute&&W.lastChild.getAttribute("type")=="_moz"){W.removeChild(W.lastChild)}W.appendChild(L.createElement("br"))}if(W.nodeName.IEquals(FCKConfig.EnterMode)&&W.firstChild){this.TrimNode(W);if(FCKListsLib.BlockBoundaries[W.firstChild.nodeName.toLowerCase()]){var T=L.createDocumentFragment();while(W.firstChild){T.appendChild(W.removeChild(W.firstChild))}W=T}}if(FCKBrowserInfo.IsGeckoLike&&W.nodeName.IEquals(["div","p"])){FCKTools.AppendBogusBr(W)}a.appendChild(W);Z=null;Y++}else{return null}}}if(Q.length<=Y||Math.max(Q[Y].indent,0)<X){break}}if(P){var S=a.firstChild;while(S){if(S.nodeType==1){this.ClearElementMarkers(P,S)}S=this.GetNextSourceNode(S)}}return{listNode:a,nextIndex:Y}},GetNextSibling:function(C,D){C=C.nextSibling;while(C&&!D&&C.nodeType!=1&&(C.nodeType!=3||C.nodeValue.length==0)){C=C.nextSibling}return C},GetPreviousSibling:function(C,D){C=C.previousSibling;while(C&&!D&&C.nodeType!=1&&(C.nodeType!=3||C.nodeValue.length==0)){C=C.previousSibling}return C},CheckIsEmptyElement:function(E,H){var G=E.firstChild;var F;while(G){if(G.nodeType==1){if(F||!FCKListsLib.InlineNonEmptyElements[G.nodeName.toLowerCase()]){return false}if(!H||H(G)===true){F=G}}else{if(G.nodeType==3&&G.nodeValue.length>0){return false}}G=G.nextSibling}return F?this.CheckIsEmptyElement(F,H):true},SetElementStyles:function(E,H){var G=E.style;for(var F in H){G[F]=H[F]}},SetOpacity:function(C,D){if(FCKBrowserInfo.IsIE){D=Math.round(D*100);C.style.filter=(D>100?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+D+")")}else{C.style.opacity=D}},GetCurrentElementStyle:function(C,D){if(FCKBrowserInfo.IsIE){return C.currentStyle[D]}else{return C.ownerDocument.defaultView.getComputedStyle(C,"").getPropertyValue(D)}},GetPositionedAncestor:function(C){var D=C;while(D!=FCKTools.GetElementDocument(D).documentElement){if(this.GetCurrentElementStyle(D,"position")!="static"){return D}if(D==FCKTools.GetElementDocument(D).documentElement&&currentWindow!=w){D=currentWindow.frameElement}else{D=D.parentNode}}return null},ScrollIntoView:function(H,N){var M=FCKTools.GetElementWindow(H);var L=FCKTools.GetViewPaneSize(M).Height;var K=L*-1;if(N===false){K+=H.offsetHeight||0;K+=parseInt(this.GetCurrentElementStyle(H,"marginBottom")||0,10)||0}var J=FCKTools.GetDocumentPosition(M,H);K+=J.y;var I=FCKTools.GetScrollPosition(M).Y;if(K>0&&(K>I||K<I-L)){M.scrollTo(0,K)}},CheckIsEditable:function(D){var F=D.nodeName.toLowerCase();var E=FCK.DTD[F]||FCK.DTD.span;return(E["#"]&&!FCKListsLib.NonEditableElements[F])},GetSelectedDivContainers:function(){var H=[];var N=new FCKDomRange(FCK.EditorWindow);N.MoveToSelection();var M=N.GetTouchedStartNode();var L=N.GetTouchedEndNode();var K=M;if(M==L){while(L.nodeType==1&&L.lastChild){L=L.lastChild}L=FCKDomTools.GetNextSourceNode(L)}while(K&&K!=L){if(K.nodeType!=3||!/^[ \t\n]*$/.test(K.nodeValue)){var J=new FCKElementPath(K);var I=J.BlockLimit;if(I&&I.nodeName.IEquals("div")&&H.IndexOf(I)==-1){H.push(I)}}K=FCKDomTools.GetNextSourceNode(K)}return H}};var FCKTools={};FCKTools.CreateBogusBR=function(C){var D=C.createElement("br");D.setAttribute("type","_moz");return D};FCKTools.FixCssUrls=function(C,D){if(!C||C.length==0){return D}return D.replace(/url\s*\(([\s'"]*)(.*?)([\s"']*)\)/g,function(A,B,E,F){if(/^\/|^\w?:/.test(E)){return A}else{return"url("+B+C+E+F+")"}})};FCKTools._GetUrlFixedCss=function(D,F){var E=D.match(/^([^|]+)\|([\s\S]*)/);if(E){return FCKTools.FixCssUrls(E[1],E[2])}else{return D}};FCKTools.AppendStyleSheet=function(D,G){if(!G){return[]}if(typeof(G)=="string"){if(/[\\\/\.][^{}]*$/.test(G)){return this.AppendStyleSheet(D,G.split(","))}else{return[this.AppendStyleString(D,FCKTools._GetUrlFixedCss(G))]}}else{var F=[];for(var E=0;E<G.length;E++){F.push(this._AppendStyleSheet(D,G[E]))}return F}};FCKTools.GetStyleHtml=(function(){var B=function(C,A){if(C.length==0){return""}var E=A?' _fcktemp="true"':"";return'<style type="text/css"'+E+">"+C+"</style>"};var D=function(A,C){if(A.length==0){return""}var E=C?' _fcktemp="true"':"";return'<link href="'+A+'" type="text/css" rel="stylesheet" '+E+"/>"};return function(G,C){if(!G){return""}if(typeof(G)=="string"){if(/[\\\/\.][^{}]*$/.test(G)){return this.GetStyleHtml(G.split(","),C)}else{return B(this._GetUrlFixedCss(G),C)}}else{var F="";for(var A=0;A<G.length;A++){F+=D(G[A],C)}return F}}})();FCKTools.GetElementDocument=function(B){return B.ownerDocument||B.document};FCKTools.GetElementWindow=function(B){return this.GetDocumentWindow(this.GetElementDocument(B))};FCKTools.GetDocumentWindow=function(B){if(FCKBrowserInfo.IsSafari&&!B.parentWindow){this.FixDocumentParentWindow(window.top)}return B.parentWindow||B.defaultView};FCKTools.FixDocumentParentWindow=function(B){if(B.document){B.document.parentWindow=B}for(var C=0;C<B.frames.length;C++){FCKTools.FixDocumentParentWindow(B.frames[C])}};FCKTools.HTMLEncode=function(B){if(!B){return""}B=B.replace(/&/g,"&amp;");B=B.replace(/</g,"&lt;");B=B.replace(/>/g,"&gt;");return B};FCKTools.HTMLDecode=function(B){if(!B){return""}B=B.replace(/&gt;/g,">");B=B.replace(/&lt;/g,"<");B=B.replace(/&amp;/g,"&");return B};FCKTools._ProcessLineBreaksForPMode=function(M,L,K,J,U){var T=0;var S="<p>";var R="</p>";var Q="<br />";if(K){S="<li>";R="</li>";T=1}while(J&&J!=M.FCK.EditorDocument.body){if(J.tagName.toLowerCase()=="p"){T=1;break}J=J.parentNode}for(var O=0;O<L.length;O++){var P=L.charAt(O);if(P=="\r"){continue}if(P!="\n"){U.push(P);continue}var N=L.charAt(O+1);if(N=="\r"){O++;N=L.charAt(O+1)}if(N=="\n"){O++;if(T){U.push(R)}U.push(S);T=1}else{U.push(Q)}}};FCKTools._ProcessLineBreaksForDivMode=function(L,K,J,I,R){var Q=0;var P="<div>";var O="</div>";if(J){P="<li>";O="</li>";Q=1}while(I&&I!=L.FCK.EditorDocument.body){if(I.tagName.toLowerCase()=="div"){Q=1;break}I=I.parentNode}for(var M=0;M<K.length;M++){var N=K.charAt(M);if(N=="\r"){continue}if(N!="\n"){R.push(N);continue}if(Q){if(R[R.length-1]==P){R.push("&nbsp;")}R.push(O)}R.push(P);Q=1}if(Q){R.push(O)}};FCKTools._ProcessLineBreaksForBrMode=function(L,K,J,I,R){var Q=0;var P="<br />";var O="";if(J){P="<li>";O="</li>";Q=1}for(var M=0;M<K.length;M++){var N=K.charAt(M);if(N=="\r"){continue}if(N!="\n"){R.push(N);continue}if(Q&&O.length){R.push(O)}R.push(P);Q=1}};FCKTools.ProcessLineBreaks=function(I,P,O){var N=P.EnterMode.toLowerCase();var M=[];var L=0;var K=new I.FCKDomRange(I.FCK.EditorWindow);K.MoveToSelection();var J=K._Range.startContainer;while(J&&J.nodeType!=1){J=J.parentNode}if(J&&J.tagName.toLowerCase()=="li"){L=1}if(N=="p"){this._ProcessLineBreaksForPMode(I,O,L,J,M)}else{if(N=="div"){this._ProcessLineBreaksForDivMode(I,O,L,J,M)}else{if(N=="br"){this._ProcessLineBreaksForBrMode(I,O,L,J,M)}}}return M.join("")};FCKTools.AddSelectOption=function(E,H,G){var F=FCKTools.GetElementDocument(E).createElement("OPTION");F.text=H;F.value=G;E.options.add(F);return F};FCKTools.RunFunction=function(E,H,G,F){if(E){this.SetTimeout(E,0,H,G,F)}};FCKTools.SetTimeout=function(F,J,I,H,G){return(G||window).setTimeout(function(){if(H){F.apply(I,[].concat(H))}else{F.apply(I)}},J)};FCKTools.SetInterval=function(F,J,I,H,G){return(G||window).setInterval(function(){F.apply(I,H||[])},J)};FCKTools.ConvertStyleSizeToHtml=function(B){return B.EndsWith("%")?B:parseInt(B,10)};FCKTools.ConvertHtmlSizeToStyle=function(B){return B.EndsWith("%")?B:(B+"px")};FCKTools.GetElementAscensor=function(D,G){var E=D;var F=","+G.toUpperCase()+",";while(E){if(F.indexOf(","+E.nodeName.toUpperCase()+",")!=-1){return E}E=E.parentNode}return null};FCKTools.CreateEventListener=function(C,E){var D=function(){var B=[];for(var A=0;A<arguments.length;A++){B.push(arguments[A])}C.apply(this,B.concat(E))};return D};FCKTools.IsStrictMode=function(B){return("CSS1Compat"==(B.compatMode||(FCKBrowserInfo.IsSafari?"CSS1Compat":null)))};FCKTools.ArgumentsToArray=function(E,I,H){I=I||0;H=H||E.length;var G=[];for(var F=I;F<I+H&&F<E.length;F++){G.push(E[F])}return G};FCKTools.CloneObject=function(C){var D=function(){};D.prototype=C;return new D};FCKTools.AppendBogusBr=function(D){if(!D){return}var F=this.GetLastItem(D.getElementsByTagName("br"));if(!F||(F.getAttribute("type",2)!="_moz"&&F.getAttribute("_moz_dirty")==null)){var E=this.GetElementDocument(D);if(FCKBrowserInfo.IsOpera){D.appendChild(E.createTextNode(""))}else{D.appendChild(this.CreateBogusBR(E))}}};FCKTools.GetLastItem=function(B){if(B.length>0){return B[B.length-1]}return null};FCKTools.GetDocumentPosition=function(H,G){var F=0;var M=0;var L=G;var K=null;var J=FCKTools.GetElementWindow(L);while(L&&!(J==H&&(L==H.document.body||L==H.document.documentElement))){F+=L.offsetLeft-L.scrollLeft;M+=L.offsetTop-L.scrollTop;if(!FCKBrowserInfo.IsOpera){var I=K;while(I&&I!=L){F-=I.scrollLeft;M-=I.scrollTop;I=I.parentNode}}K=L;if(L.offsetParent){L=L.offsetParent}else{if(J!=H){L=J.frameElement;K=null;if(L){J=L.contentWindow.parent}}else{L=null}}}if(FCKDomTools.GetCurrentElementStyle(H.document.body,"position")!="static"||(FCKBrowserInfo.IsIE&&FCKDomTools.GetPositionedAncestor(G)==null)){F+=H.document.body.offsetLeft;M+=H.document.body.offsetTop}return{x:F,y:M}};FCKTools.GetWindowPosition=function(E,D){var G=this.GetDocumentPosition(E,D);var F=FCKTools.GetScrollPosition(E);G.x-=F.X;G.y-=F.Y;return G};FCKTools.ProtectFormStyles=function(F){if(!F||F.nodeType!=1||F.tagName.toLowerCase()!="form"){return[]}var K=[];var J=["style","className"];for(var G=0;G<J.length;G++){var I=J[G];if(F.elements.namedItem(I)){var H=F.elements.namedItem(I);K.push([H,H.nextSibling]);F.removeChild(H)}}return K};FCKTools.RestoreFormStyles=function(E,I){if(!E||E.nodeType!=1||E.tagName.toLowerCase()!="form"){return}if(I.length>0){for(var F=I.length-1;F>=0;F--){var H=I[F][0];var G=I[F][1];if(G){E.insertBefore(H,G)}else{E.appendChild(H)}}}};FCKTools.GetNextNode=function(D,F){if(D.firstChild){return D.firstChild}else{if(D.nextSibling){return D.nextSibling}else{var E=D.parentNode;while(E){if(E==F){return null}if(E.nextSibling){return E.nextSibling}else{E=E.parentNode}}}}return null};FCKTools.GetNextTextNode=function(D,F,E){node=this.GetNextNode(D,F);if(E&&node&&E(node)){return null}while(node&&node.nodeType!=3){node=this.GetNextNode(node,F);if(E&&node&&E(node)){return null}}return node};FCKTools.Merge=function(){var C=arguments;var F=C[0];for(var D=1;D<C.length;D++){var G=C[D];for(var E in G){F[E]=G[E]}}return F};FCKTools.IsArray=function(B){return(B instanceof Array)};FCKTools.AppendLengthProperty=function(D,G){var E=0;for(var F in D){E++}return D[G||"length"]=E};FCKTools.NormalizeCssText=function(C){var D=document.createElement("span");D.style.cssText=C;return D.style.cssText};FCKTools.Bind=function(C,D){return function(){return D.apply(C,arguments)}};FCKTools.GetVoidUrl=function(){if(FCK_IS_CUSTOM_DOMAIN){return"javascript: void( function(){document.open();document.write('<html><head><title></title></head><body></body></html>');document.domain = '"+FCK_RUNTIME_DOMAIN+"';document.close();}() ) ;"}if(FCKBrowserInfo.IsIE){if(FCKBrowserInfo.IsIE7||!FCKBrowserInfo.IsIE6){return""}else{return"javascript: '';"}}return"javascript: void(0);"};FCKTools.ResetStyles=function(B){B.style.cssText="margin:0;padding:0;border:0;background-color:transparent;background-image:none;"};FCKTools.CancelEvent=function(A){if(A){A.preventDefault()}};FCKTools.DisableSelection=function(B){if(FCKBrowserInfo.IsGecko){B.style.MozUserSelect="none"}else{if(FCKBrowserInfo.IsSafari){B.style.KhtmlUserSelect="none"}else{B.style.userSelect="none"}}};FCKTools._AppendStyleSheet=function(C,E){var D=C.createElement("LINK");D.rel="stylesheet";D.type="text/css";D.href=E;C.getElementsByTagName("HEAD")[0].appendChild(D);return D};FCKTools.AppendStyleString=function(C,E){if(!E){return null}var D=C.createElement("STYLE");D.appendChild(C.createTextNode(E));C.getElementsByTagName("HEAD")[0].appendChild(D);return D};FCKTools.ClearElementAttributes=function(B){for(var C=0;C<B.attributes.length;C++){B.removeAttribute(B.attributes[C].name,0)}};FCKTools.GetAllChildrenIds=function(D){var F=[];var E=function(B){for(var A=0;A<B.childNodes.length;A++){var C=B.childNodes[A].id;if(C&&C.length>0){F[F.length]=C}E(B.childNodes[A])}};E(D);return F};FCKTools.RemoveOuterTags=function(D){var B=D.ownerDocument.createDocumentFragment();for(var C=0;C<D.childNodes.length;C++){B.appendChild(D.childNodes[C].cloneNode(true))}D.parentNode.replaceChild(B,D)};FCKTools.CreateXmlObject=function(C){switch(C){case"XmlHttp":return new XMLHttpRequest();case"DOMDocument":var D=(new DOMParser()).parseFromString("<tmp></tmp>","text/xml");FCKDomTools.RemoveNode(D.firstChild);return D}return null};FCKTools.GetScrollPosition=function(B){return{X:B.pageXOffset,Y:B.pageYOffset}};FCKTools.AddEventListener=function(D,F,E){D.addEventListener(F,E,false)};FCKTools.RemoveEventListener=function(D,F,E){D.removeEventListener(F,E,false)};FCKTools.AddEventListenerEx=function(E,H,G,F){E.addEventListener(H,function(A){G.apply(E,[A].concat(F||[]))},false)};FCKTools.GetViewPaneSize=function(B){return{Width:B.innerWidth,Height:B.innerHeight}};FCKTools.SaveStyles=function(E){var H=FCKTools.ProtectFormStyles(E);var G={};if(E.className.length>0){G.Class=E.className;E.className=""}var F=E.getAttribute("style");if(F&&F.length>0){G.Inline=F;E.setAttribute("style","",0)}FCKTools.RestoreFormStyles(E,H);return G};FCKTools.RestoreStyles=function(D,F){var E=FCKTools.ProtectFormStyles(D);D.className=F.Class||"";if(F.Inline){D.setAttribute("style",F.Inline,0)}else{D.removeAttribute("style",0)}FCKTools.RestoreFormStyles(D,E)};FCKTools.RegisterDollarFunction=function(B){B.$=function(A){return B.document.getElementById(A)}};FCKTools.AppendElement=function(C,D){return C.appendChild(C.ownerDocument.createElement(D))};FCKTools.GetElementPosition=function(H,O){var N={X:0,Y:0};var M=O||window;var L=FCKTools.GetElementWindow(H);var K=null;while(H){var J=L.getComputedStyle(H,"").position;if(J&&J!="static"&&H.style.zIndex!=FCKConfig.FloatingPanelsZIndex){break}N.X+=H.offsetLeft-H.scrollLeft;N.Y+=H.offsetTop-H.scrollTop;if(!FCKBrowserInfo.IsOpera){var I=K;while(I&&I!=H){N.X-=I.scrollLeft;N.Y-=I.scrollTop;I=I.parentNode}}K=H;if(H.offsetParent){H=H.offsetParent}else{if(L!=M){H=L.frameElement;K=null;if(H){L=FCKTools.GetElementWindow(H)}}else{N.X+=H.scrollLeft;N.Y+=H.scrollTop;break}}}return N};var FCKeditorAPI;function InitializeAPI(){var A=window.parent;if(!(FCKeditorAPI=A.FCKeditorAPI)){var B='window.FCKeditorAPI = {Version : "2.6.3",VersionBuild : "19836",Instances : new Object(),GetInstance : function( name ){return this.Instances[ name ];},_FormSubmit : function(){for ( var name in FCKeditorAPI.Instances ){var oEditor = FCKeditorAPI.Instances[ name ] ;if ( oEditor.GetParentForm && oEditor.GetParentForm() == this )oEditor.UpdateLinkedField() ;}this._FCKOriginalSubmit() ;},_FunctionQueue : {Functions : new Array(),IsRunning : false,Add : function( f ){this.Functions.push( f );if ( !this.IsRunning )this.StartNext();},StartNext : function(){var aQueue = this.Functions ;if ( aQueue.length > 0 ){this.IsRunning = true;aQueue[0].call();}else this.IsRunning = false;},Remove : function( f ){var aQueue = this.Functions;var i = 0, fFunc;while( (fFunc = aQueue[ i ]) ){if ( fFunc == f )aQueue.splice( i,1 );i++ ;}this.StartNext();}}}';if(A.execScript){A.execScript(B,"JavaScript")}else{if(FCKBrowserInfo.IsGecko10){eval.call(A,B)}else{if(FCKBrowserInfo.IsAIR){FCKAdobeAIR.FCKeditorAPI_Evaluate(A,B)}else{if(FCKBrowserInfo.IsSafari){var C=A.document;var D=C.createElement("script");D.appendChild(C.createTextNode(B));C.documentElement.appendChild(D)}else{A.eval(B)}}}}FCKeditorAPI=A.FCKeditorAPI;FCKeditorAPI.__Instances=FCKeditorAPI.Instances}FCKeditorAPI.Instances[FCK.Name]=FCK}function _AttachFormSubmitToAPI(){var B=FCK.GetParentForm();if(B){FCKTools.AddEventListener(B,"submit",FCK.UpdateLinkedField);if(!B._FCKOriginalSubmit&&(typeof(B.submit)=="function"||(!B.submit.tagName&&!B.submit.length))){B._FCKOriginalSubmit=B.submit;B.submit=FCKeditorAPI._FormSubmit}}}function FCKeditorAPI_Cleanup(){if(window.FCKConfig&&FCKConfig.MsWebBrowserControlCompat&&!window.FCKUnloadFlag){return}delete FCKeditorAPI.Instances[FCK.Name]}function FCKeditorAPI_ConfirmCleanup(){if(window.FCKConfig&&FCKConfig.MsWebBrowserControlCompat){window.FCKUnloadFlag=true}}FCKTools.AddEventListener(window,"unload",FCKeditorAPI_Cleanup);FCKTools.AddEventListener(window,"beforeunload",FCKeditorAPI_ConfirmCleanup);var FCKImagePreloader=function(){this._Images=[]};FCKImagePreloader.prototype={AddImages:function(B){if(typeof(B)=="string"){B=B.split(";")}this._Images=this._Images.concat(B)},Start:function(){var C=this._Images;this._PreloadCount=C.length;for(var D=0;D<C.length;D++){var E=document.createElement("img");FCKTools.AddEventListenerEx(E,"load",_FCKImagePreloader_OnImage,this);FCKTools.AddEventListenerEx(E,"error",_FCKImagePreloader_OnImage,this);E.src=C[D];_FCKImagePreloader_ImageCache.push(E)}}};var _FCKImagePreloader_ImageCache=[];function _FCKImagePreloader_OnImage(C,D){if((--D._PreloadCount)==0&&D.OnComplete){D.OnComplete()}}var FCKRegexLib={AposEntity:/&apos;/gi,ObjectElements:/^(?:IMG|TABLE|TR|TD|TH|INPUT|SELECT|TEXTAREA|HR|OBJECT|A|UL|OL|LI)$/i,NamedCommands:/^(?:Cut|Copy|Paste|Print|SelectAll|RemoveFormat|Unlink|Undo|Redo|Bold|Italic|Underline|StrikeThrough|Subscript|Superscript|JustifyLeft|JustifyCenter|JustifyRight|JustifyFull|Outdent|Indent|InsertOrderedList|InsertUnorderedList|InsertHorizontalRule)$/i,BeforeBody:/(^[\s\S]*\<body[^\>]*\>)/i,AfterBody:/(\<\/body\>[\s\S]*$)/i,ToReplace:/___fcktoreplace:([\w]+)/ig,MetaHttpEquiv:/http-equiv\s*=\s*["']?([^"' ]+)/i,HasBaseTag:/<base /i,HasBodyTag:/<body[\s|>]/i,HtmlOpener:/<html\s?[^>]*>/i,HeadOpener:/<head\s?[^>]*>/i,HeadCloser:/<\/head\s*>/i,FCK_Class:/\s*FCK__[^ ]*(?=\s+|$)/,ElementName:/(^[a-z_:][\w.\-:]*\w$)|(^[a-z_]$)/,ForceSimpleAmpersand:/___FCKAmp___/g,SpaceNoClose:/\/>/g,EmptyParagraph:/^<(p|div|address|h\d|center)(?=[ >])[^>]*>\s*(<\/\1>)?$/,EmptyOutParagraph:/^<(p|div|address|h\d|center)(?=[ >])[^>]*>(?:\s*|&nbsp;)(<\/\1>)?$/,TagBody:/></,GeckoEntitiesMarker:/#\?-\:/g,ProtectUrlsImg:/<img(?=\s).*?\ssrc=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi,ProtectUrlsA:/<a(?=\s).*?\shref=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi,ProtectUrlsArea:/<area(?=\s).*?\shref=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi,Html4DocType:/HTML 4\.0 Transitional/i,DocTypeTag:/<!DOCTYPE[^>]*>/i,HtmlDocType:/DTD HTML/,TagsWithEvent:/<[^\>]+ on\w+[\s\r\n]*=[\s\r\n]*?('|")[\s\S]+?\>/g,EventAttributes:/\s(on\w+)[\s\r\n]*=[\s\r\n]*?('|")([\s\S]*?)\2/g,ProtectedEvents:/\s\w+_fckprotectedatt="([^"]+)"/g,StyleProperties:/\S+\s*:/g,InvalidSelfCloseTags:/(<(?!base|meta|link|hr|br|param|img|area|input)([a-zA-Z0-9:]+)[^>]*)\/>/gi,StyleVariableAttName:/#\(\s*("|')(.+?)\1[^\)]*\s*\)/g,RegExp:/^\/(.*)\/([gim]*)$/,HtmlTag:/<[^\s<>](?:"[^"]*"|'[^']*'|[^<])*>/};var FCKListsLib={BlockElements:{address:1,blockquote:1,center:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,marquee:1,noscript:1,ol:1,p:1,pre:1,script:1,table:1,ul:1},NonEmptyBlockElements:{p:1,div:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,address:1,pre:1,ol:1,ul:1,li:1,td:1,th:1},InlineChildReqElements:{abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},InlineNonEmptyElements:{a:1,abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},EmptyElements:{base:1,col:1,meta:1,link:1,hr:1,br:1,param:1,img:1,area:1,input:1},PathBlockElements:{address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,de:1},PathBlockLimitElements:{body:1,div:1,td:1,th:1,caption:1,form:1},StyleBlockElements:{address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},StyleObjectElements:{img:1,hr:1,li:1,table:1,tr:1,td:1,embed:1,object:1,ol:1,ul:1},NonEditableElements:{button:1,option:1,script:1,iframe:1,textarea:1,object:1,embed:1,map:1,applet:1},BlockBoundaries:{p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,address:1,pre:1,ol:1,ul:1,li:1,dt:1,de:1,table:1,thead:1,tbody:1,tfoot:1,tr:1,th:1,td:1,caption:1,col:1,colgroup:1,blockquote:1,body:1},ListBoundaries:{p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,address:1,pre:1,ol:1,ul:1,li:1,dt:1,de:1,table:1,thead:1,tbody:1,tfoot:1,tr:1,th:1,td:1,caption:1,col:1,colgroup:1,blockquote:1,body:1,br:1}};var FCKLanguageManager=FCK.Language={AvailableLanguages:{af:"Afrikaans",ar:"Arabic",bg:"Bulgarian",bn:"Bengali/Bangla",bs:"Bosnian",ca:"Catalan",cs:"Czech",da:"Danish",de:"German",el:"Greek",en:"English","en-au":"English (Australia)","en-ca":"English (Canadian)","en-uk":"English (United Kingdom)",eo:"Esperanto",es:"Spanish",et:"Estonian",eu:"Basque",fa:"Persian",fi:"Finnish",fo:"Faroese",fr:"French","fr-ca":"French (Canada)",gl:"Galician",gu:"Gujarati",he:"Hebrew",hi:"Hindi",hr:"Croatian",hu:"Hungarian",it:"Italian",ja:"Japanese",km:"Khmer",ko:"Korean",lt:"Lithuanian",lv:"Latvian",mn:"Mongolian",ms:"Malay",nb:"Norwegian Bokmal",nl:"Dutch",no:"Norwegian",pl:"Polish",pt:"Portuguese (Portugal)","pt-br":"Portuguese (Brazil)",ro:"Romanian",ru:"Russian",sk:"Slovak",sl:"Slovenian",sr:"Serbian (Cyrillic)","sr-latn":"Serbian (Latin)",sv:"Swedish",th:"Thai",tr:"Turkish",uk:"Ukrainian",vi:"Vietnamese",zh:"Chinese Traditional","zh-cn":"Chinese Simplified"},GetActiveLanguage:function(){if(FCKConfig.AutoDetectLanguage){var B;if(navigator.userLanguage){B=navigator.userLanguage.toLowerCase()}else{if(navigator.language){B=navigator.language.toLowerCase()}else{return FCKConfig.DefaultLanguage}}if(B.length>=5){B=B.substr(0,5);if(this.AvailableLanguages[B]){return B}}if(B.length>=2){B=B.substr(0,2);if(this.AvailableLanguages[B]){return B}}}return this.DefaultLanguage},TranslateElements:function(F,M,L,K){var J=F.getElementsByTagName(M);var I,H;for(var G=0;G<J.length;G++){if((I=J[G].getAttribute("fckLang"))){if((H=FCKLang[I])){if(K){H=FCKTools.HTMLEncode(H)}J[G][L]=H}}}},TranslatePage:function(B){this.TranslateElements(B,"INPUT","value");this.TranslateElements(B,"SPAN","innerHTML");this.TranslateElements(B,"LABEL","innerHTML");this.TranslateElements(B,"OPTION","innerHTML",true);this.TranslateElements(B,"LEGEND","innerHTML")},Initialize:function(){if(this.AvailableLanguages[FCKConfig.DefaultLanguage]){this.DefaultLanguage=FCKConfig.DefaultLanguage}else{this.DefaultLanguage="en"}this.ActiveLanguage={};this.ActiveLanguage.Code=this.GetActiveLanguage();this.ActiveLanguage.Name=this.AvailableLanguages[this.ActiveLanguage.Code]}};var FCKXHtmlEntities={};FCKXHtmlEntities.Initialize=function(){if(FCKXHtmlEntities.Entities){return}var E="";var I,G;if(FCKConfig.ProcessHTMLEntities){FCKXHtmlEntities.Entities={"??":"nbsp","??":"iexcl","??":"cent","??":"pound","??":"curren","??":"yen","??":"brvbar","??":"sect","??":"uml","??":"copy","??":"ordf","??":"laquo","??":"not","??":"shy","??":"reg","??":"macr","??":"deg","??":"plusmn","??":"sup2","??":"sup3","??":"acute","??":"micro","??":"para","??":"middot","??":"cedil","??":"sup1","??":"ordm","??":"raquo","??":"frac14","??":"frac12","??":"frac34","??":"iquest","??":"times","??":"divide","??":"fnof","???":"bull","???":"hellip","???":"prime","???":"Prime","???":"oline","???":"frasl","???":"weierp","???":"image","???":"real","???":"trade","???":"alefsym","???":"larr","???":"uarr","???":"rarr","???":"darr","???":"harr","???":"crarr","???":"lArr","???":"uArr","???":"rArr","???":"dArr","???":"hArr","???":"forall","???":"part","???":"exist","???":"empty","???":"nabla","???":"isin","???":"notin","???":"ni","???":"prod","???":"sum","???":"minus","???":"lowast","???":"radic","???":"prop","???":"infin","???":"ang","???":"and","???":"or","???":"cap","???":"cup","???":"int","???":"there4","???":"sim","???":"cong","???":"asymp","???":"ne","???":"equiv","???":"le","???":"ge","???":"sub","???":"sup","???":"nsub","???":"sube","???":"supe","???":"oplus","???":"otimes","???":"perp","???":"sdot","\u2308":"lceil","\u2309":"rceil","\u230a":"lfloor","\u230b":"rfloor","\u2329":"lang","\u232a":"rang","???":"loz","???":"spades","???":"clubs","???":"hearts","???":"diams",'"':"quot","??":"circ","??":"tilde","???":"ensp","???":"emsp","???":"thinsp","???":"zwnj","???":"zwj","???":"lrm","???":"rlm","???":"ndash","???":"mdash","???":"lsquo","???":"rsquo","???":"sbquo","???":"ldquo","???":"rdquo","???":"bdquo","???":"dagger","???":"Dagger","???":"permil","???":"lsaquo","???":"rsaquo","???":"euro"};for(G in FCKXHtmlEntities.Entities){E+=G}if(FCKConfig.IncludeLatinEntities){I={"??":"Agrave","??":"Aacute","??":"Acirc","??":"Atilde","??":"Auml","??":"Aring","??":"AElig","??":"Ccedil","??":"Egrave","??":"Eacute","??":"Ecirc","??":"Euml","??":"Igrave","??":"Iacute","??":"Icirc","??":"Iuml","??":"ETH","??":"Ntilde","??":"Ograve","??":"Oacute","??":"Ocirc","??":"Otilde","??":"Ouml","??":"Oslash","??":"Ugrave","??":"Uacute","??":"Ucirc","??":"Uuml","??":"Yacute","??":"THORN","??":"szlig","??":"agrave","??":"aacute","??":"acirc","??":"atilde","??":"auml","??":"aring","??":"aelig","??":"ccedil","??":"egrave","??":"eacute","??":"ecirc","??":"euml","??":"igrave","??":"iacute","??":"icirc","??":"iuml","??":"eth","??":"ntilde","??":"ograve","??":"oacute","??":"ocirc","??":"otilde","??":"ouml","??":"oslash","??":"ugrave","??":"uacute","??":"ucirc","??":"uuml","??":"yacute","??":"thorn","??":"yuml","??":"OElig","??":"oelig","??":"Scaron","??":"scaron","??":"Yuml"};for(G in I){FCKXHtmlEntities.Entities[G]=I[G];E+=G}I=null}if(FCKConfig.IncludeGreekEntities){I={"??":"Alpha","??":"Beta","??":"Gamma","??":"Delta","??":"Epsilon","??":"Zeta","??":"Eta","??":"Theta","??":"Iota","??":"Kappa","??":"Lambda","??":"Mu","??":"Nu","??":"Xi","??":"Omicron","??":"Pi","??":"Rho","??":"Sigma","??":"Tau","??":"Upsilon","??":"Phi","??":"Chi","??":"Psi","??":"Omega","??":"alpha","??":"beta","??":"gamma","??":"delta","??":"epsilon","??":"zeta","??":"eta","??":"theta","??":"iota","??":"kappa","??":"lambda","??":"mu","??":"nu","??":"xi","??":"omicron","??":"pi","??":"rho","??":"sigmaf","??":"sigma","??":"tau","??":"upsilon","??":"phi","??":"chi","??":"psi","??":"omega","\u03d1":"thetasym","\u03d2":"upsih","\u03d6":"piv"};for(G in I){FCKXHtmlEntities.Entities[G]=I[G];E+=G}I=null}}else{FCKXHtmlEntities.Entities={};E="??"}var H="["+E+"]";if(FCKConfig.ProcessNumericEntities){H="[^ -~]|"+H}var F=FCKConfig.AdditionalNumericEntities;if(F&&F.length>0){H+="|"+FCKConfig.AdditionalNumericEntities}FCKXHtmlEntities.EntitiesRegex=new RegExp(H,"g")};var FCKXHtml={};FCKXHtml.CurrentJobNum=0;FCKXHtml.GetXHTML=function(G,M,L){FCKDomTools.CheckAndRemovePaddingNode(FCKTools.GetElementDocument(G),FCKConfig.EnterMode);FCKXHtmlEntities.Initialize();this._NbspEntity=(FCKConfig.ProcessHTMLEntities?"nbsp":"#160");var K=FCK.IsDirty();FCKXHtml.SpecialBlocks=[];this.XML=FCKTools.CreateXmlObject("DOMDocument");this.MainNode=this.XML.appendChild(this.XML.createElement("xhtml"));FCKXHtml.CurrentJobNum++;if(M){this._AppendNode(this.MainNode,G)}else{this._AppendChildNodes(this.MainNode,G,false)}var J=this._GetMainXmlString();this.XML=null;if(FCKBrowserInfo.IsSafari){J=J.replace(/^<xhtml.*?>/,"<xhtml>")}J=J.substr(7,J.length-15).Trim();if(FCKConfig.DocType.length>0&&FCKRegexLib.HtmlDocType.test(FCKConfig.DocType)){J=J.replace(FCKRegexLib.SpaceNoClose,">")}else{J=J.replace(FCKRegexLib.SpaceNoClose," />")}if(FCKConfig.ForceSimpleAmpersand){J=J.replace(FCKRegexLib.ForceSimpleAmpersand,"&")}if(L){J=FCKCodeFormatter.Format(J)}for(var H=0;H<FCKXHtml.SpecialBlocks.length;H++){var I=new RegExp("___FCKsi___"+H);J=J.replace(I,FCKXHtml.SpecialBlocks[H])}J=J.replace(FCKRegexLib.GeckoEntitiesMarker,"&");if(!K){FCK.ResetIsDirty()}FCKDomTools.EnforcePaddingNode(FCKTools.GetElementDocument(G),FCKConfig.EnterMode);return J};FCKXHtml._AppendAttribute=function(E,I,H){try{if(H==undefined||H==null){H=""}else{if(H.replace){if(FCKConfig.ForceSimpleAmpersand){H=H.replace(/&/g,"___FCKAmp___")}H=H.replace(FCKXHtmlEntities.EntitiesRegex,FCKXHtml_GetEntity)}}var G=this.XML.createAttribute(I);G.value=H;E.attributes.setNamedItem(G)}catch(F){}};FCKXHtml._AppendChildNodes=function(G,L,K){var J=L.firstChild;while(J){this._AppendNode(G,J);J=J.nextSibling}if(K&&L.tagName&&L.tagName.toLowerCase()!="pre"){FCKDomTools.TrimNode(G);if(FCKConfig.FillEmptyBlocks){var I=G.lastChild;if(I&&I.nodeType==1&&I.nodeName=="br"){this._AppendEntity(G,this._NbspEntity)}}}if(G.childNodes.length==0){if(K&&FCKConfig.FillEmptyBlocks){this._AppendEntity(G,this._NbspEntity);return G}var H=G.nodeName;if(FCKListsLib.InlineChildReqElements[H]){return null}if(!FCKListsLib.EmptyElements[H]){G.appendChild(this.XML.createTextNode(""))}}return G};FCKXHtml._AppendNode=function(G,M){if(!M){return false}switch(M.nodeType){case 1:if(FCKBrowserInfo.IsGecko&&M.tagName.toLowerCase()=="br"&&M.parentNode.tagName.toLowerCase()=="pre"){var L="\r";if(M==M.parentNode.firstChild){L+="\r"}return FCKXHtml._AppendNode(G,this.XML.createTextNode(L))}if(M.getAttribute("_fckfakelement")){return FCKXHtml._AppendNode(G,FCK.GetRealElement(M))}if(FCKBrowserInfo.IsGecko&&(M.hasAttribute("_moz_editor_bogus_node")||M.getAttribute("type")=="_moz")){if(M.nextSibling){return false}else{M.removeAttribute("_moz_editor_bogus_node");M.removeAttribute("type")}}if(M.getAttribute("_fcktemp")){return false}var K=M.tagName.toLowerCase();if(FCKBrowserInfo.IsIE){if(M.scopeName&&M.scopeName!="HTML"&&M.scopeName!="FCK"){K=M.scopeName.toLowerCase()+":"+K}}else{if(K.StartsWith("fck:")){K=K.Remove(0,4)}}if(!FCKRegexLib.ElementName.test(K)){return false}if(M._fckxhtmljob&&M._fckxhtmljob==FCKXHtml.CurrentJobNum){return false}var I=this.XML.createElement(K);FCKXHtml._AppendAttributes(G,M,I,K);M._fckxhtmljob=FCKXHtml.CurrentJobNum;var H=FCKXHtml.TagProcessors[K];if(H){I=H(I,M,G)}else{I=this._AppendChildNodes(I,M,Boolean(FCKListsLib.NonEmptyBlockElements[K]))}if(!I){return false}G.appendChild(I);break;case 3:if(M.parentNode&&M.parentNode.nodeName.IEquals("pre")){return this._AppendTextNode(G,M.nodeValue)}return this._AppendTextNode(G,M.nodeValue.ReplaceNewLineChars(" "));case 8:if(FCKBrowserInfo.IsIE&&!M.innerHTML){break}try{G.appendChild(this.XML.createComment(M.nodeValue))}catch(J){}break;default:G.appendChild(this.XML.createComment("Element not supported - Type: "+M.nodeType+" Name: "+M.nodeName));break}return true};FCKXHtml._AppendSpecialItem=function(B){return"___FCKsi___"+FCKXHtml.SpecialBlocks.AddItem(B)};FCKXHtml._AppendEntity=function(C,D){C.appendChild(this.XML.createTextNode("#?-:"+D+";"))};FCKXHtml._AppendTextNode=function(D,F){var E=F.length>0;if(E){D.appendChild(this.XML.createTextNode(F.replace(FCKXHtmlEntities.EntitiesRegex,FCKXHtml_GetEntity)))}return E};function FCKXHtml_GetEntity(C){var D=FCKXHtmlEntities.Entities[C]||("#"+C.charCodeAt(0));return"#?-:"+D+";"}FCKXHtml.TagProcessors={a:function(D,F){if(F.innerHTML.Trim().length==0&&!F.name){return false}var E=F.getAttribute("_fcksavedurl");if(E!=null){FCKXHtml._AppendAttribute(D,"href",E)}if(FCKBrowserInfo.IsIE){if(F.name){FCKXHtml._AppendAttribute(D,"name",F.name)}}D=FCKXHtml._AppendChildNodes(D,F,false);return D},area:function(F,J){var I=J.getAttribute("_fcksavedurl");if(I!=null){FCKXHtml._AppendAttribute(F,"href",I)}if(FCKBrowserInfo.IsIE){if(!F.attributes.getNamedItem("coords")){var H=J.getAttribute("coords",2);if(H&&H!="0,0,0"){FCKXHtml._AppendAttribute(F,"coords",H)}}if(!F.attributes.getNamedItem("shape")){var G=J.getAttribute("shape",2);if(G&&G.length>0){FCKXHtml._AppendAttribute(F,"shape",G.toLowerCase())}}}return F},body:function(C,D){C=FCKXHtml._AppendChildNodes(C,D,false);C.removeAttribute("spellcheck");return C},iframe:function(D,F){var E=F.innerHTML;if(FCKBrowserInfo.IsGecko){E=FCKTools.HTMLDecode(E)}E=E.replace(/\s_fcksavedurl="[^"]*"/g,"");D.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(E)));return D},img:function(D,F){if(!D.attributes.getNamedItem("alt")){FCKXHtml._AppendAttribute(D,"alt","")}var E=F.getAttribute("_fcksavedurl");if(E!=null){FCKXHtml._AppendAttribute(D,"src",E)}if(F.style.width){D.removeAttribute("width")}if(F.style.height){D.removeAttribute("height")}return D},li:function(E,H,G){if(G.nodeName.IEquals(["ul","ol"])){return FCKXHtml._AppendChildNodes(E,H,true)}var F=FCKXHtml.XML.createElement("ul");H._fckxhtmljob=null;do{FCKXHtml._AppendNode(F,H);do{H=FCKDomTools.GetNextSibling(H)}while(H&&H.nodeType==3&&H.nodeValue.Trim().length==0)}while(H&&H.nodeName.toLowerCase()=="li");return F},ol:function(E,H,G){if(H.innerHTML.Trim().length==0){return false}var F=G.lastChild;if(F&&F.nodeType==3){F=F.previousSibling}if(F&&F.nodeName.toUpperCase()=="LI"){H._fckxhtmljob=null;FCKXHtml._AppendNode(F,H);return false}E=FCKXHtml._AppendChildNodes(E,H);return E},pre:function(D,F){var E=F.firstChild;if(E&&E.nodeType==3){D.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem("\r\n")))}FCKXHtml._AppendChildNodes(D,F,true);return D},script:function(C,D){if(!C.attributes.getNamedItem("type")){FCKXHtml._AppendAttribute(C,"type","text/javascript")}C.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(D.text)));return C},span:function(C,D){if(D.innerHTML.length==0){return false}C=FCKXHtml._AppendChildNodes(C,D,false);return C},style:function(D,F){if(!D.attributes.getNamedItem("type")){FCKXHtml._AppendAttribute(D,"type","text/css")}var E=F.innerHTML;if(FCKBrowserInfo.IsIE){E=E.replace(/^(\r\n|\n|\r)/,"")}D.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(E)));return D},title:function(C,D){C.appendChild(FCKXHtml.XML.createTextNode(FCK.EditorDocument.title));return C}};FCKXHtml.TagProcessors.ul=FCKXHtml.TagProcessors.ol;FCKXHtml._GetMainXmlString=function(){return(new XMLSerializer()).serializeToString(this.MainNode)};FCKXHtml._AppendAttributes=function(H,O,M){var L=O.attributes;for(var N=0;N<L.length;N++){var K=L[N];if(K.specified){var J=K.nodeName.toLowerCase();var I;if(J.StartsWith("_fck")){continue}else{if(J.indexOf("_moz")==0){continue}else{if(J=="class"){I=K.nodeValue.replace(FCKRegexLib.FCK_Class,"");if(I.length==0){continue}}else{if(K.nodeValue===true){I=J}else{I=O.getAttribute(J,2)}}}}this._AppendAttribute(M,J,I)}}};if(FCKBrowserInfo.IsOpera){FCKXHtml.TagProcessors.head=function(C,D){FCKXHtml.XML._HeadElement=C;C=FCKXHtml._AppendChildNodes(C,D,true);return C};FCKXHtml.TagProcessors.meta=function(E,H,G){if(H.parentNode.nodeName.toLowerCase()!="head"){var F=FCKXHtml.XML._HeadElement;if(F&&G!=F){delete H._fckxhtmljob;FCKXHtml._AppendNode(F,H);return null}}return E}}if(FCKBrowserInfo.IsGecko){FCKXHtml.TagProcessors.link=function(C,D){if(D.href.substr(0,9).toLowerCase()=="chrome://"){return false}return C}}var FCKCodeFormatter={};FCKCodeFormatter.Init=function(){var B=this.Regex={};B.BlocksOpener=/\<(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi;B.BlocksCloser=/\<\/(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi;B.NewLineTags=/\<(BR|HR)[^\>]*\>/gi;B.MainTags=/\<\/?(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR)[^\>]*\>/gi;B.LineSplitter=/\s*\n+\s*/g;B.IncreaseIndent=/^\<(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL)[ \/\>]/i;B.DecreaseIndent=/^\<\/(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL)[ \>]/i;B.FormatIndentatorRemove=new RegExp("^"+FCKConfig.FormatIndentator);B.ProtectedTags=/(<PRE[^>]*>)([\s\S]*?)(<\/PRE>)/gi};FCKCodeFormatter._ProtectData=function(E,H,G,F){return H+"___FCKpd___"+FCKCodeFormatter.ProtectedData.AddItem(G)+F};FCKCodeFormatter.Format=function(G){if(!this.Regex){this.Init()}FCKCodeFormatter.ProtectedData=[];var N=G.replace(this.Regex.ProtectedTags,FCKCodeFormatter._ProtectData);N=N.replace(this.Regex.BlocksOpener,"\n$&");N=N.replace(this.Regex.BlocksCloser,"$&\n");N=N.replace(this.Regex.NewLineTags,"$&\n");N=N.replace(this.Regex.MainTags,"\n$&\n");var M="";var L=N.split(this.Regex.LineSplitter);N="";for(var I=0;I<L.length;I++){var K=L[I];if(K.length==0){continue}if(this.Regex.DecreaseIndent.test(K)){M=M.replace(this.Regex.FormatIndentatorRemove,"")}N+=M+K+"\n";if(this.Regex.IncreaseIndent.test(K)){M+=FCKConfig.FormatIndentator}}for(var H=0;H<FCKCodeFormatter.ProtectedData.length;H++){var J=new RegExp("___FCKpd___"+H);N=N.replace(J,FCKCodeFormatter.ProtectedData[H].replace(/\$/g,"$$$$"))}return N.Trim()};var FCKUndo={};FCKUndo.SavedData=[];FCKUndo.CurrentIndex=-1;FCKUndo.TypesCount=0;FCKUndo.Changed=false;FCKUndo.MaxTypes=25;FCKUndo.Typing=false;FCKUndo.SaveLocked=false;FCKUndo._GetBookmark=function(){FCKSelection.Restore();var D=new FCKDomRange(FCK.EditorWindow);try{D.MoveToSelection()}catch(E){return null}if(FCKBrowserInfo.IsIE){var G=D.CreateBookmark();var F=FCK.EditorDocument.body.innerHTML;D.MoveToBookmark(G);return[G,F]}return D.CreateBookmark2()};FCKUndo._SelectBookmark=function(C){if(!C){return}var E=new FCKDomRange(FCK.EditorWindow);if(C instanceof Object){if(FCKBrowserInfo.IsIE){E.MoveToBookmark(C[0])}else{E.MoveToBookmark2(C)}try{E.Select()}catch(D){E.MoveToPosition(FCK.EditorDocument.body,4);E.Select()}}};FCKUndo._CompareCursors=function(C,E){for(var D=0;D<Math.min(C.length,E.length);D++){if(C[D]<E[D]){return-1}else{if(C[D]>E[D]){return 1}}}if(C.length<E.length){return-1}else{if(C.length>E.length){return 1}}return 0};FCKUndo._CheckIsBookmarksEqual=function(G,L){if(!(G&&L)){return false}if(FCKBrowserInfo.IsIE){var K=G[1].search(G[0].StartId);var J=L[1].search(L[0].StartId);var I=G[1].search(G[0].EndId);var H=L[1].search(L[0].EndId);return K==J&&I==H}else{return this._CompareCursors(G.Start,L.Start)==0&&this._CompareCursors(G.End,L.End)==0}};FCKUndo.SaveUndoStep=function(){if(FCK.EditMode!=0||this.SaveLocked){return}if(this.SavedData.length){this.Changed=true}var C=FCK.EditorDocument.body.innerHTML;var D=this._GetBookmark();this.SavedData=this.SavedData.slice(0,this.CurrentIndex+1);if(this.CurrentIndex>0&&C==this.SavedData[this.CurrentIndex][0]&&this._CheckIsBookmarksEqual(D,this.SavedData[this.CurrentIndex][1])){return}else{if(this.CurrentIndex==0&&this.SavedData.length&&C==this.SavedData[0][0]){this.SavedData[0][1]=D;return}}if(this.CurrentIndex+1>=FCKConfig.MaxUndoLevels){this.SavedData.shift()}else{this.CurrentIndex++}this.SavedData[this.CurrentIndex]=[C,D];FCK.Events.FireEvent("OnSelectionChange")};FCKUndo.CheckUndoState=function(){return(this.Changed||this.CurrentIndex>0)};FCKUndo.CheckRedoState=function(){return(this.CurrentIndex<(this.SavedData.length-1))};FCKUndo.Undo=function(){if(this.CheckUndoState()){if(this.CurrentIndex==(this.SavedData.length-1)){this.SaveUndoStep()}this._ApplyUndoLevel(--this.CurrentIndex);FCK.Events.FireEvent("OnSelectionChange")}};FCKUndo.Redo=function(){if(this.CheckRedoState()){this._ApplyUndoLevel(++this.CurrentIndex);FCK.Events.FireEvent("OnSelectionChange")}};FCKUndo._ApplyUndoLevel=function(C){var D=this.SavedData[C];if(!D){return}if(FCKBrowserInfo.IsIE){if(D[1]&&D[1][1]){FCK.SetInnerHtml(D[1][1])}else{FCK.SetInnerHtml(D[0])}}else{FCK.EditorDocument.body.innerHTML=D[0]}this._SelectBookmark(D[1]);this.TypesCount=0;this.Changed=false;this.Typing=false};var FCKEditingArea=function(B){this.TargetElement=B;this.Mode=0;if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKEditingArea_Cleanup)}};FCKEditingArea.prototype.Start=function(P,O){var N=this.TargetElement;var M=FCKTools.GetElementDocument(N);while(N.firstChild){N.removeChild(N.firstChild)}if(this.Mode==0){if(FCK_IS_CUSTOM_DOMAIN){P='<script>document.domain="'+FCK_RUNTIME_DOMAIN+'";<\/script>'+P}if(FCKBrowserInfo.IsIE){P=P.replace(/(<base[^>]*?)\s*\/?>(?!\s*<\/base>)/gi,"$1></base>")}else{if(!O){var X=P.match(FCKRegexLib.BeforeBody);var W=P.match(FCKRegexLib.AfterBody);if(X&&W){var V=P.substr(X[1].length,P.length-X[1].length-W[1].length);P=X[1]+"&nbsp;"+W[1];if(FCKBrowserInfo.IsGecko&&(V.length==0||FCKRegexLib.EmptyParagraph.test(V))){V='<br type="_moz">'}this._BodyHTML=V}else{this._BodyHTML=P}}}var U=this.IFrame=M.createElement("iframe");var T='<script type="text/javascript" _fcktemp="true">window.onerror=function(){return true;};<\/script>';U.frameBorder=0;U.style.width=U.style.height="100%";if(FCK_IS_CUSTOM_DOMAIN&&FCKBrowserInfo.IsIE){window._FCKHtmlToLoad=P.replace(/<head>/i,"<head>"+T);U.src='javascript:void( (function(){document.open() ;document.domain="'+document.domain+'" ;document.write( window.parent._FCKHtmlToLoad );document.close() ;window.parent._FCKHtmlToLoad = null ;})() )'}else{if(!FCKBrowserInfo.IsGecko){U.src="javascript:void(0)"}}N.appendChild(U);this.Window=U.contentWindow;if(!FCK_IS_CUSTOM_DOMAIN||!FCKBrowserInfo.IsIE){var S=this.Window.document;S.open();S.write(P.replace(/<head>/i,"<head>"+T));S.close()}if(FCKBrowserInfo.IsAIR){FCKAdobeAIR.EditingArea_Start(S,P)}if(FCKBrowserInfo.IsGecko10&&!O){this.Start(P,true);return}if(U.readyState&&U.readyState!="completed"){var R=this;setTimeout(function(){try{R.Window.document.documentElement.doScroll("left")}catch(A){setTimeout(arguments.callee,0);return}R.Window._FCKEditingArea=R;FCKEditingArea_CompleteStart.call(R.Window)},0)}else{this.Window._FCKEditingArea=this;if(FCKBrowserInfo.IsGecko10){this.Window.setTimeout(FCKEditingArea_CompleteStart,500)}else{FCKEditingArea_CompleteStart.call(this.Window)}}}else{var Q=this.Textarea=M.createElement("textarea");Q.className="SourceField";Q.dir="ltr";FCKDomTools.SetElementStyles(Q,{width:"100%",height:"100%",border:"none",resize:"none",outline:"none"});N.appendChild(Q);Q.value=P;FCKTools.RunFunction(this.OnLoad)}};function FCKEditingArea_CompleteStart(){if(!this.document.body){this.setTimeout(FCKEditingArea_CompleteStart,50);return}var B=this._FCKEditingArea;B.Document=B.Window.document;B.MakeEditable();FCKTools.RunFunction(B.OnLoad)}FCKEditingArea.prototype.MakeEditable=function(){var B=this.Document;if(FCKBrowserInfo.IsIE){B.body.disabled=true;B.body.contentEditable=true;B.body.removeAttribute("disabled")}else{try{B.body.spellcheck=(this.FFSpellChecker!==false);if(this._BodyHTML){B.body.innerHTML=this._BodyHTML;B.body.offsetLeft;this._BodyHTML=null}B.designMode="on";B.execCommand("enableObjectResizing",false,!FCKConfig.DisableObjectResizing);B.execCommand("enableInlineTableEditing",false,!FCKConfig.DisableFFTableHandles)}catch(C){FCKTools.AddEventListener(this.Window.frameElement,"DOMAttrModified",FCKEditingArea_Document_AttributeNodeModified)}}};function FCKEditingArea_Document_AttributeNodeModified(C){var D=C.currentTarget.contentWindow._FCKEditingArea;if(D._timer){window.clearTimeout(D._timer)}D._timer=FCKTools.SetTimeout(FCKEditingArea_MakeEditableByMutation,1000,D)}function FCKEditingArea_MakeEditableByMutation(){delete this._timer;FCKTools.RemoveEventListener(this.Window.frameElement,"DOMAttrModified",FCKEditingArea_Document_AttributeNodeModified);this.MakeEditable()}FCKEditingArea.prototype.Focus=function(){try{if(this.Mode==0){if(FCKBrowserInfo.IsIE){this._FocusIE()}else{this.Window.focus()}}else{var B=FCKTools.GetElementDocument(this.Textarea);if((!B.hasFocus||B.hasFocus())&&B.activeElement==this.Textarea){return}this.Textarea.focus()}}catch(C){}};FCKEditingArea.prototype._FocusIE=function(){this.Document.body.setActive();this.Window.focus();var D=this.Document.selection.createRange();var F=D.parentElement();var E=F.nodeName.toLowerCase();if(F.childNodes.length>0||!(FCKListsLib.BlockElements[E]||FCKListsLib.NonEmptyBlockElements[E])){return}D=new FCKDomRange(this.Window);D.MoveToElementEditStart(F);D.Select()};function FCKEditingArea_Cleanup(){if(this.Document){this.Document.body.innerHTML=""}this.TargetElement=null;this.IFrame=null;this.Document=null;this.Textarea=null;if(this.Window){this.Window._FCKEditingArea=null;this.Window=null}}var FCKKeystrokeHandler=function(B){this.Keystrokes={};this.CancelCtrlDefaults=(B!==false)};FCKKeystrokeHandler.prototype.AttachToElement=function(B){FCKTools.AddEventListenerEx(B,"keydown",_FCKKeystrokeHandler_OnKeyDown,this);if(FCKBrowserInfo.IsGecko10||FCKBrowserInfo.IsOpera||(FCKBrowserInfo.IsGecko&&FCKBrowserInfo.IsMac)){FCKTools.AddEventListenerEx(B,"keypress",_FCKKeystrokeHandler_OnKeyPress,this)}};FCKKeystrokeHandler.prototype.SetKeystrokes=function(){for(var C=0;C<arguments.length;C++){var B=arguments[C];if(!B){continue}if(typeof(B[0])=="object"){this.SetKeystrokes.apply(this,B)}else{if(B.length==1){delete this.Keystrokes[B[0]]}else{this.Keystrokes[B[0]]=B[1]===true?true:B}}}};function _FCKKeystrokeHandler_OnKeyDown(H,N){var M=H.keyCode||H.which;var L=0;if(H.ctrlKey||H.metaKey){L+=CTRL}if(H.shiftKey){L+=SHIFT}if(H.altKey){L+=ALT}var K=M+L;var J=N._CancelIt=false;var I=N.Keystrokes[K];if(I){if(I===true||!(N.OnKeystroke&&N.OnKeystroke.apply(N,I))){return true}J=true}if(J||(N.CancelCtrlDefaults&&L==CTRL&&(M<33||M>40))){N._CancelIt=true;if(H.preventDefault){return H.preventDefault()}H.returnValue=false;H.cancelBubble=true;return false}return true}function _FCKKeystrokeHandler_OnKeyPress(C,D){if(D._CancelIt){if(C.preventDefault){return C.preventDefault()}return false}return true}FCK.DTD=(function(){var R=FCKTools.Merge;var k,Y,a,W,V,U,h,c,T,Z,S,f,d,i,j,g,b;k={isindex:1,fieldset:1};j={input:1,button:1,select:1,textarea:1,label:1};i=R({a:1},j);h=R({iframe:1},i);g={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1};f={ins:1,del:1,script:1};d=R({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},f);c=R({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},d);b=R({p:1},c);a=R({iframe:1},c,j);Z={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};Y=R({a:1},a);W={tr:1};V={"#":1};U=R({param:1},Z);T=R({form:1},k,h,g,b);S={li:1};return{col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:T,td:T,br:{},th:T,center:T,kbd:Y,button:R(b,g),basefont:{},h5:Y,h4:Y,samp:Y,h6:Y,ol:S,h1:Y,h3:Y,option:V,h2:Y,form:R(k,h,g,b),select:{optgroup:1,option:1},font:a,ins:T,menu:S,abbr:Y,label:Y,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:Y,script:V,tfoot:W,cite:Y,li:T,input:{},iframe:T,strong:a,textarea:V,noframes:T,big:a,small:a,span:a,hr:{},dt:Y,sub:a,optgroup:{option:1},param:{},bdo:Y,"var":a,div:T,object:U,sup:a,dd:T,strike:a,area:{},dir:S,map:R({area:1,form:1,p:1},k,f,g),applet:U,dl:{dt:1,dd:1},del:T,isindex:{},fieldset:R({legend:1},Z),thead:W,ul:S,acronym:Y,b:a,a:a,blockquote:T,caption:Y,i:a,u:a,tbody:W,s:Y,address:R(h,b),tt:a,legend:Y,q:Y,pre:R(d,i),p:Y,em:a,dfn:Y}})();var FCKStyle=function(B){this.Element=(B.Element||"span").toLowerCase();this._StyleDesc=B};FCKStyle.prototype={GetType:function(){var C=this.GetType_$;if(C!=undefined){return C}var D=this.Element;if(D=="#"||FCKListsLib.StyleBlockElements[D]){C=0}else{if(FCKListsLib.StyleObjectElements[D]){C=2}else{C=1}}return(this.GetType_$=C)},ApplyToSelection:function(C){var D=new FCKDomRange(C);D.MoveToSelection();this.ApplyToRange(D,true)},ApplyToRange:function(D,F,E){switch(this.GetType()){case 0:this.ApplyToRange=this._ApplyBlockStyle;break;case 1:this.ApplyToRange=this._ApplyInlineStyle;break;default:return}this.ApplyToRange(D,F,E)},ApplyToObject:function(B){if(!B){return}this.BuildElement(null,B)},RemoveFromSelection:function(C){var D=new FCKDomRange(C);D.MoveToSelection();this.RemoveFromRange(D,true)},RemoveFromRange:function(z,y,x){var v;var u=this._GetAttribsForComparison();var t=this._GetOverridesForComparison();if(z.CheckIsCollapsed()){var v=z.CreateBookmark(true);var r=z.GetBookmarkNode(v,true);var q=new FCKElementPath(r.parentNode);var p=[];var o=!FCKDomTools.GetNextSibling(r);var n=o||!FCKDomTools.GetPreviousSibling(r);var m;var l=-1;for(var AB=0;AB<q.Elements.length;AB++){var k=q.Elements[AB];if(this.CheckElementRemovable(k)){if(n&&!FCKDomTools.CheckIsEmptyElement(k,function(A){return(A!=r)})){m=k;l=p.length-1}else{var h=k.nodeName.toLowerCase();if(h==this.Element){for(var g in u){if(FCKDomTools.HasAttribute(k,g)){switch(g){case"style":this._RemoveStylesFromElement(k);break;case"class":if(FCKDomTools.GetAttributeValue(k,g)!=this.GetFinalAttributeValue(g)){continue}default:FCKDomTools.RemoveAttribute(k,g)}}}}this._RemoveOverrides(k,t[h]);if(this.GetType()==1){this._RemoveNoAttribElement(k)}}}else{if(n){p.push(k)}}n=n&&((o&&!FCKDomTools.GetNextSibling(k))||(!o&&!FCKDomTools.GetPreviousSibling(k)));if(m&&(!n||(AB==q.Elements.length-1))){var f=FCKDomTools.RemoveNode(r);for(var AA=0;AA<=l;AA++){var d=FCKDomTools.CloneElement(p[AA]);d.appendChild(f);f=d}if(o){FCKDomTools.InsertAfterNode(m,f)}else{m.parentNode.insertBefore(f,m)}n=false;m=null}}if(y){z.SelectBookmark(v)}if(x){z.MoveToBookmark(v)}return}z.Expand("inline_elements");v=z.CreateBookmark(true);var Y=z.GetBookmarkNode(v,true);var W=z.GetBookmarkNode(v,false);z.Release(true);var q=new FCKElementPath(Y);var V=q.Elements;var k;for(var AB=1;AB<V.length;AB++){k=V[AB];if(k==q.Block||k==q.BlockLimit){break}if(this.CheckElementRemovable(k)){FCKDomTools.BreakParent(Y,k,z)}}q=new FCKElementPath(W);V=q.Elements;for(var AB=1;AB<V.length;AB++){k=V[AB];if(k==q.Block||k==q.BlockLimit){break}AD=k.nodeName.toLowerCase();if(this.CheckElementRemovable(k)){FCKDomTools.BreakParent(W,k,z)}}var G=FCKDomTools.GetNextSourceNode(Y,true);while(G){var AE=FCKDomTools.GetNextSourceNode(G);if(G.nodeType==1){var AD=G.nodeName.toLowerCase();var AC=(AD==this.Element);if(AC){for(var g in u){if(FCKDomTools.HasAttribute(G,g)){switch(g){case"style":this._RemoveStylesFromElement(G);break;case"class":if(FCKDomTools.GetAttributeValue(G,g)!=this.GetFinalAttributeValue(g)){continue}default:FCKDomTools.RemoveAttribute(G,g)}}}}else{AC=!!t[AD]}if(AC){this._RemoveOverrides(G,t[AD]);this._RemoveNoAttribElement(G)}}if(AE==W){break}G=AE}this._FixBookmarkStart(Y);if(y){z.SelectBookmark(v)}if(x){z.MoveToBookmark(v)}},CheckElementRemovable:function(M,L){if(!M){return false}var K=M.nodeName.toLowerCase();if(K==this.Element){if(!L&&!FCKDomTools.HasAttributes(M)){return true}var J=this._GetAttribsForComparison();var S=(J._length==0);for(var R in J){if(R=="_length"){continue}if(this._CompareAttributeValues(R,FCKDomTools.GetAttributeValue(M,R),(this.GetFinalAttributeValue(R)||""))){S=true;if(!L){break}}else{S=false;if(L){return false}}}if(S){return true}}var Q=this._GetOverridesForComparison()[K];if(Q){if(!(J=Q.Attributes)){return true}for(var N=0;N<J.length;N++){var P=J[N][0];if(FCKDomTools.HasAttribute(M,P)){var O=J[N][1];if(O==null||(typeof O=="string"&&FCKDomTools.GetAttributeValue(M,P)==O)||O.test(FCKDomTools.GetAttributeValue(M,P))){return true}}}}return false},CheckActive:function(D){switch(this.GetType()){case 0:return this.CheckElementRemovable(D.Block||D.BlockLimit,true);case 1:var G=D.Elements;for(var E=0;E<G.length;E++){var F=G[E];if(F==D.Block||F==D.BlockLimit){continue}if(this.CheckElementRemovable(F,true)){return true}}}return false},RemoveFromElement:function(H){var O=this._GetAttribsForComparison();var N=this._GetOverridesForComparison();var M=H.getElementsByTagName(this.Element);for(var I=M.length-1;I>=0;I--){var L=M[I];for(var K in O){if(FCKDomTools.HasAttribute(L,K)){switch(K){case"style":this._RemoveStylesFromElement(L);break;case"class":if(FCKDomTools.GetAttributeValue(L,K)!=this.GetFinalAttributeValue(K)){continue}default:FCKDomTools.RemoveAttribute(L,K)}}}this._RemoveOverrides(L,N[this.Element]);this._RemoveNoAttribElement(L)}for(var J in N){if(J!=this.Element){M=H.getElementsByTagName(J);for(var I=M.length-1;I>=0;I--){var L=M[I];this._RemoveOverrides(L,N[J]);this._RemoveNoAttribElement(L)}}}},_RemoveStylesFromElement:function(E){var H=E.style.cssText;var G=this.GetFinalStyleValue();if(H.length>0&&G.length==0){return}G="(^|;)\\s*("+G.replace(/\s*([^ ]+):.*?(;|$)/g,"$1|").replace(/\|$/,"")+"):[^;]+";var F=new RegExp(G,"gi");H=H.replace(F,"").Trim();if(H.length==0||H==";"){FCKDomTools.RemoveAttribute(E,"style")}else{E.style.cssText=H.replace(F,"")}},_RemoveOverrides:function(F,K){var J=K&&K.Attributes;if(J){for(var G=0;G<J.length;G++){var I=J[G][0];if(FCKDomTools.HasAttribute(F,I)){var H=J[G][1];if(H==null||(H.test&&H.test(FCKDomTools.GetAttributeValue(F,I)))||(typeof H=="string"&&FCKDomTools.GetAttributeValue(F,I)==H)){FCKDomTools.RemoveAttribute(F,I)}}}}},_RemoveNoAttribElement:function(D){if(!FCKDomTools.HasAttributes(D)){var F=D.firstChild;var E=D.lastChild;FCKDomTools.RemoveNode(D,true);this._MergeSiblings(F);if(F!=E){this._MergeSiblings(E)}}},BuildElement:function(G,L){var K=L||G.createElement(this.Element);var J=this._StyleDesc.Attributes;var I;if(J){for(var H in J){I=this.GetFinalAttributeValue(H);if(H.toLowerCase()=="class"){K.className=I}else{K.setAttribute(H,I)}}}if(this._GetStyleText().length>0){K.style.cssText=this.GetFinalStyleValue()}return K},_CompareAttributeValues:function(D,F,E){if(D=="style"&&F&&E){F=F.replace(/;$/,"").toLowerCase();E=E.replace(/;$/,"").toLowerCase()}return(F==E||((F===null||F==="")&&(E===null||E==="")))},GetFinalAttributeValue:function(C){var D=this._StyleDesc.Attributes;var D=D?D[C]:null;if(!D&&C=="style"){return this.GetFinalStyleValue()}if(D&&this._Variables){D=D.Replace(FCKRegexLib.StyleVariableAttName,this._GetVariableReplace,this)}return D},GetFinalStyleValue:function(){var B=this._GetStyleText();if(B.length>0&&this._Variables){B=B.Replace(FCKRegexLib.StyleVariableAttName,this._GetVariableReplace,this);B=FCKTools.NormalizeCssText(B)}return B},_GetVariableReplace:function(){return this._Variables[arguments[2]]||arguments[0]},SetVariable:function(D,F){var E=this._Variables;if(!E){E=this._Variables={}}this._Variables[D]=F},_FromPre:function(G,L,K){var J=L.innerHTML;J=J.replace(/(\r\n|\r)/g,"\n");J=J.replace(/^[ \t]*\n/,"");J=J.replace(/\n$/,"");J=J.replace(/^[ \t]+|[ \t]+$/g,function(A,C,B){if(A.length==1){return"&nbsp;"}else{if(C==0){return new Array(A.length).join("&nbsp;")+" "}else{return" "+new Array(A.length).join("&nbsp;")}}});var I=new FCKHtmlIterator(J);var H=[];I.Each(function(A,B){if(!A){B=B.replace(/\n/g,"<br>");B=B.replace(/[ \t]{2,}/g,function(C){return new Array(C.length).join("&nbsp;")+" "})}H.push(B)});K.innerHTML=H.join("");return K},_ToPre:function(H,N,M){var L=N.innerHTML.Trim();L=L.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"<br />");var K=new FCKHtmlIterator(L);var J=[];K.Each(function(A,B){if(!A){B=B.replace(/([ \t\n\r]+|&nbsp;)/g," ")}else{if(A&&B=="<br />"){B="\n"}}J.push(B)});if(FCKBrowserInfo.IsIE){var I=H.createElement("div");I.appendChild(M);M.outerHTML="<pre>\n"+J.join("")+"</pre>";M=I.removeChild(I.firstChild)}else{M.innerHTML=J.join("")}return M},_CheckAndMergePre:function(D,F){if(D!=FCKDomTools.GetPreviousSourceElement(F,true)){return}var E=D.innerHTML.replace(/\n$/,"")+"\n\n"+F.innerHTML.replace(/^\n/,"");if(FCKBrowserInfo.IsIE){F.outerHTML="<pre>"+E+"</pre>"}else{F.innerHTML=E}FCKDomTools.RemoveNode(D)},_CheckAndSplitPre:function(E){var H;var G=E.firstChild;G=G&&G.nextSibling;while(G){var F=G.nextSibling;if(F&&F.nextSibling&&G.nodeName.IEquals("br")&&F.nodeName.IEquals("br")){FCKDomTools.RemoveNode(G);G=F.nextSibling;FCKDomTools.RemoveNode(F);H=FCKDomTools.InsertAfterNode(H||E,FCKDomTools.CloneElement(E));continue}if(H){G=G.previousSibling;FCKDomTools.MoveNode(G.nextSibling,H)}G=G.nextSibling}},_ApplyBlockStyle:function(Q,P,O){var N;if(P){N=Q.CreateBookmark()}var Z=new FCKDomRangeIterator(Q);Z.EnforceRealBlocks=true;var Y;var X=Q.Window.document;var W;while((Y=Z.GetNextParagraph())){var V=this.BuildElement(X);var U=V.nodeName.IEquals("pre");var T=Y.nodeName.IEquals("pre");var S=U&&!T;var R=!U&&T;if(S){V=this._ToPre(X,Y,V)}else{if(R){V=this._FromPre(X,Y,V)}else{FCKDomTools.MoveChildren(Y,V)}}Y.parentNode.insertBefore(V,Y);FCKDomTools.RemoveNode(Y);if(U){if(W){this._CheckAndMergePre(W,V)}W=V}else{if(R){this._CheckAndSplitPre(V)}}}if(P){Q.SelectBookmark(N)}if(O){Q.MoveToBookmark(N)}},_ApplyInlineStyle:function(k,j,i){var h=k.Window.document;if(k.CheckIsCollapsed()){var g=this.BuildElement(h);k.InsertNode(g);k.MoveToPosition(g,2);k.Select();return}var f=this.Element;var d=FCK.DTD[f]||FCK.DTD.span;var c=this._GetAttribsForComparison();var b;k.Expand("inline_elements");var a=k.CreateBookmark(true);var Z=k.GetBookmarkNode(a,true);var Y=k.GetBookmarkNode(a,false);k.Release(true);var X=FCKDomTools.GetNextSourceNode(Z,true);while(X){var W=false;var V=X.nodeType;var U=V==1?X.nodeName.toLowerCase():null;if(!U||d[U]){if((FCK.DTD[X.parentNode.nodeName.toLowerCase()]||FCK.DTD.span)[f]||!FCK.DTD[f]){if(!k.CheckHasRange()){k.SetStart(X,3)}if(V!=1||X.childNodes.length==0){var T=X;var S=T.parentNode;while(T==S.lastChild&&d[S.nodeName.toLowerCase()]){T=S}k.SetEnd(T,4);if(T==T.parentNode.lastChild&&!d[T.parentNode.nodeName.toLowerCase()]){W=true}}else{k.SetEnd(X,3)}}else{W=true}}else{W=true}X=FCKDomTools.GetNextSourceNode(X);if(X==Y){X=null;W=true}if(W&&k.CheckHasRange()&&!k.CheckIsCollapsed()){b=this.BuildElement(h);k.ExtractContents().AppendTo(b);if(b.innerHTML.RTrim().length>0){k.InsertNode(b);this.RemoveFromElement(b);this._MergeSiblings(b,this._GetAttribsForComparison());if(!FCKBrowserInfo.IsIE){b.normalize()}}k.Release(true)}}this._FixBookmarkStart(Z);if(j){k.SelectBookmark(a)}if(i){k.MoveToBookmark(a)}},_FixBookmarkStart:function(C){var D;while((D=C.nextSibling)){if(D.nodeType==1&&FCKListsLib.InlineNonEmptyElements[D.nodeName.toLowerCase()]){if(!D.firstChild){FCKDomTools.RemoveNode(D)}else{FCKDomTools.MoveNode(C,D,true)}continue}if(D.nodeType==3&&D.length==0){FCKDomTools.RemoveNode(D);continue}break}},_MergeSiblings:function(C,D){if(!C||C.nodeType!=1||!FCKListsLib.InlineNonEmptyElements[C.nodeName.toLowerCase()]){return}this._MergeNextSibling(C,D);this._MergePreviousSibling(C,D)},_MergeNextSibling:function(F,J){var I=F.nextSibling;var H=(I&&I.nodeType==1&&I.getAttribute("_fck_bookmark"));if(H){I=I.nextSibling}if(I&&I.nodeType==1&&I.nodeName==F.nodeName){if(!J){J=this._CreateElementAttribsForComparison(F)}if(this._CheckAttributesMatch(I,J)){var G=F.lastChild;if(H){FCKDomTools.MoveNode(F.nextSibling,F)}FCKDomTools.MoveChildren(I,F);FCKDomTools.RemoveNode(I);if(G){this._MergeNextSibling(G)}}}},_MergePreviousSibling:function(F,J){var I=F.previousSibling;var H=(I&&I.nodeType==1&&I.getAttribute("_fck_bookmark"));if(H){I=I.previousSibling}if(I&&I.nodeType==1&&I.nodeName==F.nodeName){if(!J){J=this._CreateElementAttribsForComparison(F)}if(this._CheckAttributesMatch(I,J)){var G=F.firstChild;if(H){FCKDomTools.MoveNode(F.previousSibling,F,true)}FCKDomTools.MoveChildren(I,F,true);FCKDomTools.RemoveNode(I);if(G){this._MergePreviousSibling(G)}}}},_GetStyleText:function(){var D=this._StyleDesc.Styles;var F=(this._StyleDesc.Attributes?this._StyleDesc.Attributes.style||"":"");if(F.length>0){F+=";"}for(var E in D){F+=E+":"+D[E]+";"}if(F.length>0&&!(/#\(/.test(F))){F=FCKTools.NormalizeCssText(F)}return(this._GetStyleText=function(){return F})()},_GetAttribsForComparison:function(){var D=this._GetAttribsForComparison_$;if(D){return D}D={};var F=this._StyleDesc.Attributes;if(F){for(var E in F){D[E.toLowerCase()]=F[E].toLowerCase()}}if(this._GetStyleText().length>0){D.style=this._GetStyleText().toLowerCase()}FCKTools.AppendLengthProperty(D,"_length");return(this._GetAttribsForComparison_$=D)},_GetOverridesForComparison:function(){var L=this._GetOverridesForComparison_$;if(L){return L}L={};var K=this._StyleDesc.Overrides;if(K){if(!FCKTools.IsArray(K)){K=[K]}for(var M=0;M<K.length;M++){var J=K[M];var I;var Q;var P;if(typeof J=="string"){I=J.toLowerCase()}else{I=J.Element?J.Element.toLowerCase():this.Element;P=J.Attributes}Q=L[I]||(L[I]={});if(P){var O=(Q.Attributes=Q.Attributes||[]);for(var N in P){O.push([N.toLowerCase(),P[N]])}}}}return(this._GetOverridesForComparison_$=L)},_CreateElementAttribsForComparison:function(E){var I={};var H=0;for(var F=0;F<E.attributes.length;F++){var G=E.attributes[F];if(G.specified){I[G.nodeName.toLowerCase()]=FCKDomTools.GetAttributeValue(E,G).toLowerCase();H++}}I._length=H;return I},_CheckAttributesMatch:function(H,O){var N=H.attributes;var M=0;for(var I=0;I<N.length;I++){var L=N[I];if(L.specified){var K=L.nodeName.toLowerCase();var J=O[K];if(!J){break}if(J!=FCKDomTools.GetAttributeValue(H,L).toLowerCase()){break}M++}}return(M==O._length)}};var FCKStyles=FCK.Styles={_Callbacks:{},_ObjectStyles:{},ApplyStyle:function(B){if(typeof B=="string"){B=this.GetStyles()[B]}if(B){if(B.GetType()==2){B.ApplyToObject(FCKSelection.GetSelectedElement())}else{B.ApplyToSelection(FCK.EditorWindow)}FCK.Events.FireEvent("OnSelectionChange")}},RemoveStyle:function(B){if(typeof B=="string"){B=this.GetStyles()[B]}if(B){B.RemoveFromSelection(FCK.EditorWindow);FCK.Events.FireEvent("OnSelectionChange")}},AttachStyleStateChange:function(E,H,G){var F=this._Callbacks[E];if(!F){F=this._Callbacks[E]=[]}F.push([H,G])},CheckSelectionChanges:function(){var M=FCKSelection.GetBoundaryParentElement(true);if(!M){return}var L=new FCKElementPath(M);var K=this.GetStyles();for(var J in K){var S=this._Callbacks[J];if(S){var R=K[J];var Q=R.CheckActive(L);if(Q!=(R._LastState||null)){R._LastState=Q;for(var N=0;N<S.length;N++){var P=S[N][0];var O=S[N][1];P.call(O||window,J,Q)}}}}},CheckStyleInSelection:function(B){return false},_GetRemoveFormatTagsRegex:function(){var B=new RegExp("^(?:"+FCKConfig.RemoveFormatTags.replace(/,/g,"|")+")$","i");return(this._GetRemoveFormatTagsRegex=function(){return B})&&B},RemoveAll:function(){var N=new FCKDomRange(FCK.EditorWindow);N.MoveToSelection();if(N.CheckIsCollapsed()){return}N.Expand("inline_elements");var M=N.CreateBookmark(true);var L=N.GetBookmarkNode(M,true);var K=N.GetBookmarkNode(M,false);N.Release(true);var U=this._GetRemoveFormatTagsRegex();var T=new FCKElementPath(L);var S=T.Elements;var R;for(var O=1;O<S.length;O++){R=S[O];if(R==T.Block||R==T.BlockLimit){break}if(U.test(R.nodeName)){FCKDomTools.BreakParent(L,R,N)}}T=new FCKElementPath(K);S=T.Elements;for(var O=1;O<S.length;O++){R=S[O];if(R==T.Block||R==T.BlockLimit){break}elementName=R.nodeName.toLowerCase();if(U.test(R.nodeName)){FCKDomTools.BreakParent(K,R,N)}}var Q=FCKDomTools.GetNextSourceNode(L,true,1);while(Q){if(Q==K){break}var P=FCKDomTools.GetNextSourceNode(Q,false,1);if(U.test(Q.nodeName)){FCKDomTools.RemoveNode(Q,true)}else{FCKDomTools.RemoveAttributes(Q,FCKConfig.RemoveAttributesArray)}Q=P}N.SelectBookmark(M);FCK.Events.FireEvent("OnSelectionChange")},GetStyle:function(B){return this.GetStyles()[B]},GetStyles:function(){var B=this._GetStyles;if(!B){B=this._GetStyles=FCKTools.Merge(this._LoadStylesCore(),this._LoadStylesCustom(),this._LoadStylesXml())}return B},CheckHasObjectStyle:function(B){return!!this._ObjectStyles[B]},_LoadStylesCore:function(){var E={};var H=FCKConfig.CoreStyles;for(var G in H){var F=E["_FCK_"+G]=new FCKStyle(H[G]);F.IsCore=true}return E},_LoadStylesCustom:function(){var E={};var H=FCKConfig.CustomStyles;if(H){for(var G in H){var F=E[G]=new FCKStyle(H[G]);F.Name=G}}return E},_LoadStylesXml:function(){var l={};var h=FCKConfig.StylesXmlPath;if(!h||h.length==0){return l}var g=new FCKXml();g.LoadUrl(h);var f=FCKXml.TransformToObject(g.SelectSingleNode("Styles"));var d=f.$Style;if(!d){return l}for(var o=0;o<d.length;o++){var c=d[o];var b=(c.element||"").toLowerCase();if(b.length==0){throw('The element name is required. Error loading "'+h+'"')}var a={Element:b,Attributes:{},Styles:{},Overrides:[]};var Z=c.$Attribute||[];for(var n=0;n<Z.length;n++){a.Attributes[Z[n].name]=Z[n].value}var Y=c.$Style||[];for(n=0;n<Y.length;n++){a.Styles[Y[n].name]=Y[n].value}var X=c.$Override;if(X){for(n=0;n<X.length;n++){var W=X[n];var V={Element:W.element};var U=W.$Attribute;if(U){V.Attributes={};for(var m=0;m<U.length;m++){var T=U[m].value||null;if(T){var S=T&&FCKRegexLib.RegExp.exec(T);if(S){T=new RegExp(S[1],S[2]||"")}}V.Attributes[U[m].name]=T}}a.Overrides.push(V)}}var R=new FCKStyle(a);R.Name=c.name||b;if(R.GetType()==2){this._ObjectStyles[b]=true}l[R.Name]=R}return l}};var FCKListHandler={OutdentListItem:function(R){var Q=R.parentNode;if(Q.tagName.toUpperCase().Equals("UL","OL")){var P=FCKTools.GetElementDocument(R);var M=new FCKDocumentFragment(P);var b=M.RootNode;var a=false;var Z=FCKDomTools.GetFirstChild(R,["UL","OL"]);if(Z){a=true;var Y;while((Y=Z.firstChild)){b.appendChild(Z.removeChild(Y))}FCKDomTools.RemoveNode(Z)}var X;var W=false;while((X=R.nextSibling)){if(!a&&X.nodeType==1&&X.nodeName.toUpperCase()=="LI"){W=a=true}b.appendChild(X.parentNode.removeChild(X));if(!W&&X.nodeType==1&&X.nodeName.toUpperCase().Equals("UL","OL")){FCKDomTools.RemoveNode(X,true)}}var V=Q.parentNode.tagName.toUpperCase();var U=(V=="LI");if(U||V.Equals("UL","OL")){if(a){var Z=Q.cloneNode(false);M.AppendTo(Z);R.appendChild(Z)}else{if(U){M.InsertAfterNode(Q.parentNode)}else{M.InsertAfterNode(Q)}}if(U){FCKDomTools.InsertAfterNode(Q.parentNode,Q.removeChild(R))}else{FCKDomTools.InsertAfterNode(Q,Q.removeChild(R))}}else{if(a){var T=Q.cloneNode(false);M.AppendTo(T);FCKDomTools.InsertAfterNode(Q,T)}var S=P.createElement(FCKConfig.EnterMode=="p"?"p":"div");FCKDomTools.MoveChildren(Q.removeChild(R),S);FCKDomTools.InsertAfterNode(Q,S);if(FCKConfig.EnterMode=="br"){if(FCKBrowserInfo.IsGecko){S.parentNode.insertBefore(FCKTools.CreateBogusBR(P),S)}else{FCKDomTools.InsertAfterNode(S,FCKTools.CreateBogusBR(P))}FCKDomTools.RemoveNode(S,true)}}if(this.CheckEmptyList(Q)){FCKDomTools.RemoveNode(Q,true)}}},CheckEmptyList:function(B){return(FCKDomTools.GetFirstChild(B,"LI")==null)},CheckListHasContents:function(C){var D=C.firstChild;while(D){switch(D.nodeType){case 1:if(!D.nodeName.IEquals("UL","LI")){return true}break;case 3:if(D.nodeValue.Trim().length>0){return true}}D=D.nextSibling}return false}};var FCKElementPath=function(F){var K=null;var J=null;var I=[];var H=F;while(H){if(H.nodeType==1){if(!this.LastElement){this.LastElement=H}var G=H.nodeName.toLowerCase();if(FCKBrowserInfo.IsIE&&H.scopeName!="HTML"){G=H.scopeName.toLowerCase()+":"+G}if(!J){if(!K&&FCKListsLib.PathBlockElements[G]!=null){K=H}if(FCKListsLib.PathBlockLimitElements[G]!=null){if(!K&&G=="div"&&!FCKElementPath._CheckHasBlock(H)){K=H}else{J=H}}}I.push(H);if(G=="body"){break}}H=H.parentNode}this.Block=K;this.BlockLimit=J;this.Elements=I};FCKElementPath._CheckHasBlock=function(D){var H=D.childNodes;for(var E=0,F=H.length;E<F;E++){var G=H[E];if(G.nodeType==1&&FCKListsLib.BlockElements[G.nodeName.toLowerCase()]){return true}}return false};var FCKDomRange=function(B){this.Window=B;this._Cache={}};FCKDomRange.prototype={_UpdateElementInfo:function(){var F=this._Range;if(!F){this.Release(true)}else{var J=F.startContainer;var I=new FCKElementPath(J);this.StartNode=J.nodeType==3?J:J.childNodes[F.startOffset];this.StartContainer=J;this.StartBlock=I.Block;this.StartBlockLimit=I.BlockLimit;if(F.collapsed){this.EndNode=this.StartNode;this.EndContainer=this.StartContainer;this.EndBlock=this.StartBlock;this.EndBlockLimit=this.StartBlockLimit}else{var H=F.endContainer;if(J!=H){I=new FCKElementPath(H)}var G=H;if(F.endOffset==0){while(G&&!G.previousSibling){G=G.parentNode}if(G){G=G.previousSibling}}else{if(G.nodeType==1){G=G.childNodes[F.endOffset-1]}}this.EndNode=G;this.EndContainer=H;this.EndBlock=I.Block;this.EndBlockLimit=I.BlockLimit}}this._Cache={}},CreateRange:function(){return new FCKW3CRange(this.Window.document)},DeleteContents:function(){if(this._Range){this._Range.deleteContents();this._UpdateElementInfo()}},ExtractContents:function(){if(this._Range){var B=this._Range.extractContents();this._UpdateElementInfo();return B}return null},CheckIsCollapsed:function(){if(this._Range){return this._Range.collapsed}return false},Collapse:function(B){if(this._Range){this._Range.collapse(B)}this._UpdateElementInfo()},Clone:function(){var B=FCKTools.CloneObject(this);if(this._Range){B._Range=this._Range.cloneRange()}return B},MoveToNodeContents:function(B){if(!this._Range){this._Range=this.CreateRange()}this._Range.selectNodeContents(B);this._UpdateElementInfo()},MoveToElementStart:function(B){this.SetStart(B,1);this.SetEnd(B,1)},MoveToElementEditStart:function(C){var D;while(C&&C.nodeType==1){if(FCKDomTools.CheckIsEditable(C)){D=C}else{if(D){break}}C=C.firstChild}if(D){this.MoveToElementStart(D)}},InsertNode:function(B){if(this._Range){this._Range.insertNode(B)}},CheckIsEmpty:function(){if(this.CheckIsCollapsed()){return true}var B=this.Window.document.createElement("div");this._Range.cloneContents().AppendTo(B);FCKDomTools.TrimNode(B);return(B.innerHTML.length==0)},CheckStartOfBlock:function(){var H=this._Cache;var N=H.IsStartOfBlock;if(N!=undefined){return N}var M=this.StartBlock||this.StartBlockLimit;var L=this._Range.startContainer;var K=this._Range.startOffset;var J;if(K>0){if(L.nodeType==3){var I=L.nodeValue.substr(0,K).Trim();if(I.length!=0){return H.IsStartOfBlock=false}}else{J=L.childNodes[K-1]}}if(!J){J=FCKDomTools.GetPreviousSourceNode(L,true,null,M)}while(J){switch(J.nodeType){case 1:if(!FCKListsLib.InlineChildReqElements[J.nodeName.toLowerCase()]){return H.IsStartOfBlock=false}break;case 3:if(J.nodeValue.Trim().length>0){return H.IsStartOfBlock=false}}J=FCKDomTools.GetPreviousSourceNode(J,false,null,M)}return H.IsStartOfBlock=true},CheckEndOfBlock:function(M){var L=this._Cache.IsEndOfBlock;if(L!=undefined){return L}var K=this.EndBlock||this.EndBlockLimit;var J=this._Range.endContainer;var R=this._Range.endOffset;var Q;if(J.nodeType==3){var P=J.nodeValue;if(R<P.length){P=P.substr(R);if(P.Trim().length!=0){return this._Cache.IsEndOfBlock=false}}}else{Q=J.childNodes[R]}if(!Q){Q=FCKDomTools.GetNextSourceNode(J,true,null,K)}var O=false;while(Q){switch(Q.nodeType){case 1:var N=Q.nodeName.toLowerCase();if(FCKListsLib.InlineChildReqElements[N]){break}if(N=="br"&&!O){O=true;break}return this._Cache.IsEndOfBlock=false;case 3:if(Q.nodeValue.Trim().length>0){return this._Cache.IsEndOfBlock=false}}Q=FCKDomTools.GetNextSourceNode(Q,false,null,K)}if(M){this.Select()}return this._Cache.IsEndOfBlock=true},CreateBookmark:function(G){var L={StartId:(new Date()).valueOf()+Math.floor(Math.random()*1000)+"S",EndId:(new Date()).valueOf()+Math.floor(Math.random()*1000)+"E"};var K=this.Window.document;var J;var I;var H;if(!this.CheckIsCollapsed()){I=K.createElement("span");I.style.display="none";I.id=L.EndId;I.setAttribute("_fck_bookmark",true);I.innerHTML="&nbsp;";H=this.Clone();H.Collapse(false);H.InsertNode(I)}J=K.createElement("span");J.style.display="none";J.id=L.StartId;J.setAttribute("_fck_bookmark",true);J.innerHTML="&nbsp;";H=this.Clone();H.Collapse(true);H.InsertNode(J);if(G){L.StartNode=J;L.EndNode=I}if(I){this.SetStart(J,4);this.SetEnd(I,3)}else{this.MoveToPosition(J,4)}return L},GetBookmarkNode:function(D,F){var E=this.Window.document;if(F){return D.StartNode||E.getElementById(D.StartId)}else{return D.EndNode||E.getElementById(D.EndId)}},MoveToBookmark:function(E,H){var G=this.GetBookmarkNode(E,true);var F=this.GetBookmarkNode(E,false);this.SetStart(G,3);if(!H){FCKDomTools.RemoveNode(G)}if(F){this.SetEnd(F,3);if(!H){FCKDomTools.RemoveNode(F)}}else{this.Collapse(true)}this._UpdateElementInfo()},CreateBookmark2:function(){if(!this._Range){return{Start:0,End:0}}var H={Start:[this._Range.startOffset],End:[this._Range.endOffset]};var N=this._Range.startContainer.previousSibling;var M=this._Range.endContainer.previousSibling;var L=this._Range.startContainer;var K=this._Range.endContainer;while(N&&L.nodeType==3){H.Start[0]+=N.length;L=N;N=N.previousSibling}while(M&&K.nodeType==3){H.End[0]+=M.length;K=M;M=M.previousSibling}if(L.nodeType==1&&L.childNodes[H.Start[0]]&&L.childNodes[H.Start[0]].nodeType==3){var J=L.childNodes[H.Start[0]];var I=0;while(J.previousSibling&&J.previousSibling.nodeType==3){J=J.previousSibling;I+=J.length}L=J;H.Start[0]=I}if(K.nodeType==1&&K.childNodes[H.End[0]]&&K.childNodes[H.End[0]].nodeType==3){var J=K.childNodes[H.End[0]];var I=0;while(J.previousSibling&&J.previousSibling.nodeType==3){J=J.previousSibling;I+=J.length}K=J;H.End[0]=I}H.Start=FCKDomTools.GetNodeAddress(L,true).concat(H.Start);H.End=FCKDomTools.GetNodeAddress(K,true).concat(H.End);return H},MoveToBookmark2:function(F){var J=FCKDomTools.GetNodeFromAddress(this.Window.document,F.Start.slice(0,-1),true);var I=FCKDomTools.GetNodeFromAddress(this.Window.document,F.End.slice(0,-1),true);this.Release(true);this._Range=new FCKW3CRange(this.Window.document);var H=F.Start[F.Start.length-1];var G=F.End[F.End.length-1];while(J.nodeType==3&&H>J.length){if(!J.nextSibling||J.nextSibling.nodeType!=3){break}H-=J.length;J=J.nextSibling}while(I.nodeType==3&&G>I.length){if(!I.nextSibling||I.nextSibling.nodeType!=3){break}G-=I.length;I=I.nextSibling}this._Range.setStart(J,H);this._Range.setEnd(I,G);this._UpdateElementInfo()},MoveToPosition:function(C,D){this.SetStart(C,D);this.Collapse(true)},SetStart:function(E,H,G){var F=this._Range;if(!F){F=this._Range=this.CreateRange()}switch(H){case 1:F.setStart(E,0);break;case 2:F.setStart(E,E.childNodes.length);break;case 3:F.setStartBefore(E);break;case 4:F.setStartAfter(E)}if(!G){this._UpdateElementInfo()}},SetEnd:function(E,H,G){var F=this._Range;if(!F){F=this._Range=this.CreateRange()}switch(H){case 1:F.setEnd(E,0);break;case 2:F.setEnd(E,E.childNodes.length);break;case 3:F.setEndBefore(E);break;case 4:F.setEndAfter(E)}if(!G){this._UpdateElementInfo()}},Expand:function(F){var K,G;switch(F){case"inline_elements":if(this._Range.startOffset==0){K=this._Range.startContainer;if(K.nodeType!=1){K=K.previousSibling?null:K.parentNode}if(K){while(FCKListsLib.InlineNonEmptyElements[K.nodeName.toLowerCase()]){this._Range.setStartBefore(K);if(K!=K.parentNode.firstChild){break}K=K.parentNode}}}K=this._Range.endContainer;var J=this._Range.endOffset;if((K.nodeType==3&&J>=K.nodeValue.length)||(K.nodeType==1&&J>=K.childNodes.length)||(K.nodeType!=1&&K.nodeType!=3)){if(K.nodeType!=1){K=K.nextSibling?null:K.parentNode}if(K){while(FCKListsLib.InlineNonEmptyElements[K.nodeName.toLowerCase()]){this._Range.setEndAfter(K);if(K!=K.parentNode.lastChild){break}K=K.parentNode}}}break;case"block_contents":case"list_contents":var I=FCKListsLib.BlockBoundaries;if(F=="list_contents"||FCKConfig.EnterMode=="br"){I=FCKListsLib.ListBoundaries}if(this.StartBlock&&FCKConfig.EnterMode!="br"&&F=="block_contents"){this.SetStart(this.StartBlock,1)}else{K=this._Range.startContainer;if(K.nodeType==1){var H=K.childNodes[this._Range.startOffset];if(H){K=FCKDomTools.GetPreviousSourceNode(H,true)}else{K=K.lastChild||K}}while(K&&(K.nodeType!=1||(K!=this.StartBlockLimit&&!I[K.nodeName.toLowerCase()]))){this._Range.setStartBefore(K);K=K.previousSibling||K.parentNode}}if(this.EndBlock&&FCKConfig.EnterMode!="br"&&F=="block_contents"&&this.EndBlock.nodeName.toLowerCase()!="li"){this.SetEnd(this.EndBlock,2)}else{K=this._Range.endContainer;if(K.nodeType==1){K=K.childNodes[this._Range.endOffset]||K.lastChild}while(K&&(K.nodeType!=1||(K!=this.StartBlockLimit&&!I[K.nodeName.toLowerCase()]))){this._Range.setEndAfter(K);K=K.nextSibling||K.parentNode}if(K&&K.nodeName.toLowerCase()=="br"){this._Range.setEndAfter(K)}}this._UpdateElementInfo()}},SplitBlock:function(I){var P=I||FCKConfig.EnterMode;if(!this._Range){this.MoveToSelection()}if(this.StartBlockLimit==this.EndBlockLimit){var O=this.StartBlock;var N=this.EndBlock;var M=null;if(P!="br"){if(!O){O=this.FixBlock(true,P);N=this.EndBlock}if(!N){N=this.FixBlock(false,P)}}var L=(O!=null&&this.CheckStartOfBlock());var K=(N!=null&&this.CheckEndOfBlock());if(!this.CheckIsEmpty()){this.DeleteContents()}if(O&&N&&O==N){if(K){M=new FCKElementPath(this.StartContainer);this.MoveToPosition(N,4);N=null}else{if(L){M=new FCKElementPath(this.StartContainer);this.MoveToPosition(O,3);O=null}else{this.SetEnd(O,2);var J=this.ExtractContents();N=O.cloneNode(false);N.removeAttribute("id",false);J.AppendTo(N);FCKDomTools.InsertAfterNode(O,N);this.MoveToPosition(O,4);if(FCKBrowserInfo.IsGecko&&!O.nodeName.IEquals(["ul","ol"])){FCKTools.AppendBogusBr(O)}}}}return{PreviousBlock:O,NextBlock:N,WasStartOfBlock:L,WasEndOfBlock:K,ElementPath:M}}return null},FixBlock:function(E,H){var G=this.CreateBookmark();this.Collapse(E);this.Expand("block_contents");var F=this.Window.document.createElement(H);this.ExtractContents().AppendTo(F);FCKDomTools.TrimNode(F);if(FCKDomTools.CheckIsEmptyElement(F,function(A){return A.getAttribute("_fck_bookmark")!="true"})&&FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(F)}this.InsertNode(F);this.MoveToBookmark(G);return F},Release:function(B){if(!B){this.Window=null}this.StartNode=null;this.StartContainer=null;this.StartBlock=null;this.StartBlockLimit=null;this.EndNode=null;this.EndContainer=null;this.EndBlock=null;this.EndBlockLimit=null;this._Range=null;this._Cache=null},CheckHasRange:function(){return!!this._Range},GetTouchedStartNode:function(){var C=this._Range;var D=C.startContainer;if(C.collapsed||D.nodeType!=1){return D}return D.childNodes[C.startOffset]||D},GetTouchedEndNode:function(){var C=this._Range;var D=C.endContainer;if(C.collapsed||D.nodeType!=1){return D}return D.childNodes[C.endOffset-1]||D}};FCKDomRange.prototype.MoveToSelection=function(){this.Release(true);var B=this.Window.getSelection();if(B&&B.rangeCount>0){this._Range=FCKW3CRange.CreateFromRange(this.Window.document,B.getRangeAt(0));this._UpdateElementInfo()}else{if(this.Window.document){this.MoveToElementStart(this.Window.document.body)}}};FCKDomRange.prototype.Select=function(){var E=this._Range;if(E){var I=E.startContainer;if(E.collapsed&&I.nodeType==1&&I.childNodes.length==0){I.appendChild(E._Document.createTextNode(""))}var H=this.Window.document.createRange();H.setStart(I,E.startOffset);try{H.setEnd(E.endContainer,E.endOffset)}catch(G){if(G.toString().Contains("NS_ERROR_ILLEGAL_VALUE")){E.collapse(true);H.setEnd(E.endContainer,E.endOffset)}else{throw(G)}}var F=this.Window.getSelection();F.removeAllRanges();F.addRange(H)}};FCKDomRange.prototype.SelectBookmark=function(F){var J=this.Window.document.createRange();var I=this.GetBookmarkNode(F,true);var H=this.GetBookmarkNode(F,false);J.setStart(I.parentNode,FCKDomTools.GetIndexOf(I));FCKDomTools.RemoveNode(I);if(H){J.setEnd(H.parentNode,FCKDomTools.GetIndexOf(H));FCKDomTools.RemoveNode(H)}var G=this.Window.getSelection();G.removeAllRanges();G.addRange(J)};var FCKDomRangeIterator=function(B){this.Range=B;this.ForceBrBreak=false;this.EnforceRealBlocks=false};FCKDomRangeIterator.CreateFromSelection=function(C){var D=new FCKDomRange(C);D.MoveToSelection();return new FCKDomRangeIterator(D)};FCKDomRangeIterator.prototype={GetNextParagraph:function(){var T;var S;var R;var G;var g;var f=this.ForceBrBreak?FCKListsLib.ListBoundaries:FCKListsLib.BlockBoundaries;if(!this._LastNode){var S=this.Range.Clone();S.Expand(this.ForceBrBreak?"list_contents":"block_contents");this._NextNode=S.GetTouchedStartNode();this._LastNode=S.GetTouchedEndNode();S=null}var d=this._NextNode;var c=this._LastNode;this._NextNode=null;while(d){var b=false;var a=(d.nodeType!=1);var Z=false;if(!a){var Y=d.nodeName.toLowerCase();if(f[Y]&&(!FCKBrowserInfo.IsIE||d.scopeName=="HTML")){if(Y=="br"){a=true}else{if(!S&&d.childNodes.length==0&&Y!="hr"){T=d;R=d==c;break}}if(S){S.SetEnd(d,3,true);if(Y!="br"){this._NextNode=FCKDomTools.GetNextSourceNode(d,true,null,c)}}b=true}else{if(d.firstChild){if(!S){S=new FCKDomRange(this.Range.Window);S.SetStart(d,3,true)}d=d.firstChild;continue}a=true}}else{if(d.nodeType==3){if(/^[\r\n\t ]+$/.test(d.nodeValue)){a=false}}}if(a&&!S){S=new FCKDomRange(this.Range.Window);S.SetStart(d,3,true)}R=((!b||a)&&d==c);if(S&&!b){while(!d.nextSibling&&!R){var X=d.parentNode;if(f[X.nodeName.toLowerCase()]){b=true;R=R||(X==c);break}d=X;a=true;R=(d==c);Z=true}}if(a){S.SetEnd(d,4,true)}if((b||R)&&S){S._UpdateElementInfo();if(S.StartNode==S.EndNode&&S.StartNode.parentNode==S.StartBlockLimit&&S.StartNode.getAttribute&&S.StartNode.getAttribute("_fck_bookmark")){S=null}else{break}}if(R){break}d=FCKDomTools.GetNextSourceNode(d,Z,null,c)}if(!T){if(!S){this._NextNode=null;return null}T=S.StartBlock;if(!T&&!this.EnforceRealBlocks&&S.StartBlockLimit.nodeName.IEquals("DIV","TH","TD")&&S.CheckStartOfBlock()&&S.CheckEndOfBlock()){T=S.StartBlockLimit}else{if(!T||(this.EnforceRealBlocks&&T.nodeName.toLowerCase()=="li")){T=this.Range.Window.document.createElement(FCKConfig.EnterMode=="p"?"p":"div");S.ExtractContents().AppendTo(T);FCKDomTools.TrimNode(T);S.InsertNode(T);G=true;g=true}else{if(T.nodeName.toLowerCase()!="li"){if(!S.CheckStartOfBlock()||!S.CheckEndOfBlock()){T=T.cloneNode(false);S.ExtractContents().AppendTo(T);FCKDomTools.TrimNode(T);var W=S.SplitBlock();G=!W.WasStartOfBlock;g=!W.WasEndOfBlock;S.InsertNode(T)}}else{if(!R){this._NextNode=T==c?null:FCKDomTools.GetNextSourceNode(S.EndNode,true,null,c);return T}}}}}if(G){var V=T.previousSibling;if(V&&V.nodeType==1){if(V.nodeName.toLowerCase()=="br"){V.parentNode.removeChild(V)}else{if(V.lastChild&&V.lastChild.nodeName.IEquals("br")){V.removeChild(V.lastChild)}}}}if(g){var U=T.lastChild;if(U&&U.nodeType==1&&U.nodeName.toLowerCase()=="br"){T.removeChild(U)}}if(!this._NextNode){this._NextNode=(R||T==c)?null:FCKDomTools.GetNextSourceNode(T,true,null,c)}return T}};var FCKDocumentFragment=function(C,D){this.RootNode=D||C.createDocumentFragment()};FCKDocumentFragment.prototype={AppendTo:function(B){B.appendChild(this.RootNode)},AppendHtml:function(C){var D=this.RootNode.ownerDocument.createElement("div");D.innerHTML=C;FCKDomTools.MoveChildren(D,this.RootNode)},InsertAfterNode:function(B){FCKDomTools.InsertAfterNode(B,this.RootNode)}};var FCKW3CRange=function(B){this._Document=B;this.startContainer=null;this.startOffset=null;this.endContainer=null;this.endOffset=null;this.collapsed=true};FCKW3CRange.CreateRange=function(B){return new FCKW3CRange(B)};FCKW3CRange.CreateFromRange=function(D,F){var E=FCKW3CRange.CreateRange(D);E.setStart(F.startContainer,F.startOffset);E.setEnd(F.endContainer,F.endOffset);return E};FCKW3CRange.prototype={_UpdateCollapsed:function(){this.collapsed=(this.startContainer==this.endContainer&&this.startOffset==this.endOffset)},setStart:function(C,D){this.startContainer=C;this.startOffset=D;if(!this.endContainer){this.endContainer=C;this.endOffset=D}this._UpdateCollapsed()},setEnd:function(C,D){this.endContainer=C;this.endOffset=D;if(!this.startContainer){this.startContainer=C;this.startOffset=D}this._UpdateCollapsed()},setStartAfter:function(B){this.setStart(B.parentNode,FCKDomTools.GetIndexOf(B)+1)},setStartBefore:function(B){this.setStart(B.parentNode,FCKDomTools.GetIndexOf(B))},setEndAfter:function(B){this.setEnd(B.parentNode,FCKDomTools.GetIndexOf(B)+1)},setEndBefore:function(B){this.setEnd(B.parentNode,FCKDomTools.GetIndexOf(B))},collapse:function(B){if(B){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=true},selectNodeContents:function(B){this.setStart(B,0);this.setEnd(B,B.nodeType==3?B.data.length:B.childNodes.length)},insertNode:function(D){var F=this.startContainer;var E=this.startOffset;if(F.nodeType==3){F.splitText(E);if(F==this.endContainer){this.setEnd(F.nextSibling,this.endOffset-this.startOffset)}FCKDomTools.InsertAfterNode(F,D);return}else{F.insertBefore(D,F.childNodes[E]||null);if(F==this.endContainer){this.endOffset++;this.collapsed=false}}},deleteContents:function(){if(this.collapsed){return}this._ExecContentsAction(0)},extractContents:function(){var B=new FCKDocumentFragment(this._Document);if(!this.collapsed){this._ExecContentsAction(1,B)}return B},cloneContents:function(){var B=new FCKDocumentFragment(this._Document);if(!this.collapsed){this._ExecContentsAction(2,B)}return B},_ExecContentsAction:function(g,f){var d=this.startContainer;var c=this.endContainer;var a=this.startOffset;var Y=this.endOffset;var X=false;var W=false;if(c.nodeType==3){c=c.splitText(Y)}else{if(c.childNodes.length>0){if(Y>c.childNodes.length-1){c=FCKDomTools.InsertAfterNode(c.lastChild,this._Document.createTextNode(""));W=true}else{c=c.childNodes[Y]}}}if(d.nodeType==3){d.splitText(a);if(d==c){c=d.nextSibling}}else{if(a==0){d=d.insertBefore(this._Document.createTextNode(""),d.firstChild);X=true}else{if(a>d.childNodes.length-1){d=d.appendChild(this._Document.createTextNode(""));X=true}else{d=d.childNodes[a].previousSibling}}}var V=FCKDomTools.GetParents(d);var U=FCKDomTools.GetParents(c);var m,o,n;for(m=0;m<V.length;m++){o=V[m];n=U[m];if(o!=n){break}}var T,b,Z,O,R;if(f){T=f.RootNode}for(var l=m;l<V.length;l++){b=V[l];if(T&&b!=d){Z=T.appendChild(b.cloneNode(b==d))}O=b.nextSibling;while(O){if(O==U[l]||O==c){break}R=O.nextSibling;if(g==2){T.appendChild(O.cloneNode(true))}else{O.parentNode.removeChild(O);if(g==1){T.appendChild(O)}}O=R}if(T){T=Z}}if(f){T=f.RootNode}for(var h=m;h<U.length;h++){b=U[h];if(g>0&&b!=c){Z=T.appendChild(b.cloneNode(b==c))}if(!V[h]||b.parentNode!=V[h].parentNode){O=b.previousSibling;while(O){if(O==V[h]||O==d){break}R=O.previousSibling;if(g==2){T.insertBefore(O.cloneNode(true),T.firstChild)}else{O.parentNode.removeChild(O);if(g==1){T.insertBefore(O,T.firstChild)}}O=R}}if(T){T=Z}}if(g==2){var S=this.startContainer;if(S.nodeType==3){S.data+=S.nextSibling.data;S.parentNode.removeChild(S.nextSibling)}var Q=this.endContainer;if(Q.nodeType==3&&Q.nextSibling){Q.data+=Q.nextSibling.data;Q.parentNode.removeChild(Q.nextSibling)}}else{if(o&&n&&(d.parentNode!=o.parentNode||c.parentNode!=n.parentNode)){var P=FCKDomTools.GetIndexOf(n);if(X&&n.parentNode==d.parentNode){P--}this.setStart(n.parentNode,P)}this.collapse(true)}if(X){d.parentNode.removeChild(d)}if(W&&c.parentNode){c.parentNode.removeChild(c)}},cloneRange:function(){return FCKW3CRange.CreateFromRange(this._Document,this)}};var FCKEnterKey=function(F,J,I,H){this.Window=F;this.EnterMode=J||"p";this.ShiftEnterMode=I||"br";var G=new FCKKeystrokeHandler(false);G._EnterKey=this;G.OnKeystroke=FCKEnterKey_OnKeystroke;G.SetKeystrokes([[13,"Enter"],[SHIFT+13,"ShiftEnter"],[8,"Backspace"],[CTRL+8,"CtrlBackspace"],[46,"Delete"]]);this.TabText="";if(H>0||FCKBrowserInfo.IsSafari){while(H--){this.TabText+="\xa0"}G.SetKeystrokes([9,"Tab"])}G.AttachToElement(F.document)};function FCKEnterKey_OnKeystroke(D,G){var F=this._EnterKey;try{switch(G){case"Enter":return F.DoEnter();break;case"ShiftEnter":return F.DoShiftEnter();break;case"Backspace":return F.DoBackspace();break;case"Delete":return F.DoDelete();break;case"Tab":return F.DoTab();break;case"CtrlBackspace":return F.DoCtrlBackspace();break}}catch(E){}return false}FCKEnterKey.prototype.DoEnter=function(F,J){FCKUndo.SaveUndoStep();this._HasShift=(J===true);var I=FCKSelection.GetParentElement();var H=new FCKElementPath(I);var G=F||this.EnterMode;if(G=="br"||H.Block&&H.Block.tagName.toLowerCase()=="pre"){return this._ExecuteEnterBr()}else{return this._ExecuteEnterBlock(G)}};FCKEnterKey.prototype.DoShiftEnter=function(){return this.DoEnter(this.ShiftEnterMode,true)};FCKEnterKey.prototype.DoBackspace=function(){var P=false;var O=new FCKDomRange(this.Window);O.MoveToSelection();if(FCKBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(O,this.Window.document.body)){this._FixIESelectAllBug(O);return true}var N=O.CheckIsCollapsed();if(!N){if(FCKBrowserInfo.IsIE&&this.Window.document.selection.type.toLowerCase()=="control"){var M=this.Window.document.selection.createRange();for(var Q=M.length-1;Q>=0;Q--){var Y=M.item(Q);Y.parentNode.removeChild(Y)}return true}return false}if(FCKBrowserInfo.IsIE){var X=FCKDomTools.GetPreviousSourceElement(O.StartNode,true);if(X&&X.nodeName.toLowerCase()=="br"){var W=O.Clone();W.SetStart(X,4);if(W.CheckIsEmpty()){X.parentNode.removeChild(X);return true}}}var V=O.StartBlock;var U=O.EndBlock;if(O.StartBlockLimit==O.EndBlockLimit&&V&&U){if(!N){var T=O.CheckEndOfBlock();O.DeleteContents();if(V!=U){O.SetStart(U,1);O.SetEnd(U,1)}O.Select();P=(V==U)}if(O.CheckStartOfBlock()){var S=O.StartBlock;var R=FCKDomTools.GetPreviousSourceElement(S,true,["BODY",O.StartBlockLimit.nodeName],["UL","OL"]);P=this._ExecuteBackspace(O,R,S)}else{if(FCKBrowserInfo.IsGeckoLike){O.Select()}}}O.Release();return P};FCKEnterKey.prototype.DoCtrlBackspace=function(){FCKUndo.SaveUndoStep();var B=new FCKDomRange(this.Window);B.MoveToSelection();if(FCKBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(B,this.Window.document.body)){this._FixIESelectAllBug(B);return true}return false};FCKEnterKey.prototype._ExecuteBackspace=function(M,L,K){var J=false;if(!L&&K&&K.nodeName.IEquals("LI")&&K.parentNode.parentNode.nodeName.IEquals("LI")){this._OutdentWithSelection(K,M);return true}if(L&&L.nodeName.IEquals("LI")){var R=FCKDomTools.GetLastChild(L,["UL","OL"]);while(R){L=FCKDomTools.GetLastChild(R,"LI");R=FCKDomTools.GetLastChild(L,["UL","OL"])}}if(L&&K){if(K.nodeName.IEquals("LI")&&!L.nodeName.IEquals("LI")){this._OutdentWithSelection(K,M);return true}var Q=K.parentNode;var P=L.nodeName.toLowerCase();if(FCKListsLib.EmptyElements[P]!=null||P=="table"){FCKDomTools.RemoveNode(L);J=true}else{FCKDomTools.RemoveNode(K);while(Q.innerHTML.Trim().length==0){var O=Q.parentNode;O.removeChild(Q);Q=O}FCKDomTools.LTrimNode(K);FCKDomTools.RTrimNode(L);M.SetStart(L,2,true);M.Collapse(true);var N=M.CreateBookmark(true);if(!K.tagName.IEquals(["TABLE"])){FCKDomTools.MoveChildren(K,L)}M.SelectBookmark(N);J=true}}return J};FCKEnterKey.prototype.DoDelete=function(){FCKUndo.SaveUndoStep();var G=false;var L=new FCKDomRange(this.Window);L.MoveToSelection();if(FCKBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(L,this.Window.document.body)){this._FixIESelectAllBug(L);return true}if(L.CheckIsCollapsed()&&L.CheckEndOfBlock(FCKBrowserInfo.IsGeckoLike)){var K=L.StartBlock;var J=FCKTools.GetElementAscensor(K,"td");var I=FCKDomTools.GetNextSourceElement(K,true,[L.StartBlockLimit.nodeName],["UL","OL","TR"],true);if(J){var H=FCKTools.GetElementAscensor(I,"td");if(H!=J){return true}}G=this._ExecuteBackspace(L,K,I)}L.Release();return G};FCKEnterKey.prototype.DoTab=function(){var D=new FCKDomRange(this.Window);D.MoveToSelection();var F=D._Range.startContainer;while(F){if(F.nodeType==1){var E=F.tagName.toLowerCase();if(E=="tr"||E=="td"||E=="th"||E=="tbody"||E=="table"){return false}else{break}}F=F.parentNode}if(this.TabText){D.DeleteContents();D.InsertNode(this.Window.document.createTextNode(this.TabText));D.Collapse(false);D.Select()}return true};FCKEnterKey.prototype._ExecuteEnterBlock=function(P,O){var N=O||new FCKDomRange(this.Window);var M=N.SplitBlock(P);if(M){var Z=M.PreviousBlock;var Y=M.NextBlock;var X=M.WasStartOfBlock;var W=M.WasEndOfBlock;if(Y){if(Y.parentNode.nodeName.IEquals("li")){FCKDomTools.BreakParent(Y,Y.parentNode);FCKDomTools.MoveNode(Y,Y.nextSibling,true)}}else{if(Z&&Z.parentNode.nodeName.IEquals("li")){FCKDomTools.BreakParent(Z,Z.parentNode);N.MoveToElementEditStart(Z.nextSibling);FCKDomTools.MoveNode(Z,Z.previousSibling)}}if(!X&&!W){if(Y.nodeName.IEquals("li")&&Y.firstChild&&Y.firstChild.nodeName.IEquals(["ul","ol"])){Y.insertBefore(FCKTools.GetElementDocument(Y).createTextNode("\xa0"),Y.firstChild)}if(Y){N.MoveToElementEditStart(Y)}}else{if(X&&W&&Z.tagName.toUpperCase()=="LI"){N.MoveToElementStart(Z);this._OutdentWithSelection(Z,N);N.Release();return true}var V;if(Z){var U=Z.tagName.toUpperCase();if(!this._HasShift&&!(/^H[1-6]$/).test(U)){V=FCKDomTools.CloneElement(Z)}}else{if(Y){V=FCKDomTools.CloneElement(Y)}}if(!V){V=this.Window.document.createElement(P)}var T=M.ElementPath;if(T){for(var Q=0,R=T.Elements.length;Q<R;Q++){var S=T.Elements[Q];if(S==T.Block||S==T.BlockLimit){break}if(FCKListsLib.InlineChildReqElements[S.nodeName.toLowerCase()]){S=FCKDomTools.CloneElement(S);FCKDomTools.MoveChildren(V,S);V.appendChild(S)}}}if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(V)}N.InsertNode(V);if(FCKBrowserInfo.IsIE){N.MoveToElementEditStart(V);N.Select()}N.MoveToElementEditStart(X&&!W?Y:V)}if(FCKBrowserInfo.IsGeckoLike){FCKDomTools.ScrollIntoView(Y||V,false)}N.Select()}N.Release();return true};FCKEnterKey.prototype._ExecuteEnterBr=function(M){var L=new FCKDomRange(this.Window);L.MoveToSelection();if(L.StartBlockLimit==L.EndBlockLimit){L.DeleteContents();L.MoveToSelection();var K=L.CheckStartOfBlock();var J=L.CheckEndOfBlock();var R=L.StartBlock?L.StartBlock.tagName.toUpperCase():"";var Q=this._HasShift;var P=false;if(!Q&&R=="LI"){return this._ExecuteEnterBlock(null,L)}if(!Q&&J&&(/^H[1-6]$/).test(R)){FCKDomTools.InsertAfterNode(L.StartBlock,this.Window.document.createElement("br"));if(FCKBrowserInfo.IsGecko){FCKDomTools.InsertAfterNode(L.StartBlock,this.Window.document.createTextNode(""))}L.SetStart(L.StartBlock.nextSibling,FCKBrowserInfo.IsIE?3:1)}else{var O;P=R.IEquals("pre");if(P){O=this.Window.document.createTextNode(FCKBrowserInfo.IsIE?"\r":"\n")}else{O=this.Window.document.createElement("br")}L.InsertNode(O);if(FCKBrowserInfo.IsGecko){FCKDomTools.InsertAfterNode(O,this.Window.document.createTextNode(""))}if(J&&FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(O.parentNode)}if(FCKBrowserInfo.IsIE){L.SetStart(O,4)}else{L.SetStart(O.nextSibling,1)}if(!FCKBrowserInfo.IsIE){var N=null;if(FCKBrowserInfo.IsOpera){N=this.Window.document.createElement("span")}else{N=this.Window.document.createElement("br")}O.parentNode.insertBefore(N,O.nextSibling);FCKDomTools.ScrollIntoView(N,false);N.parentNode.removeChild(N)}}L.Collapse(true);L.Select(P)}L.Release();return true};FCKEnterKey.prototype._OutdentWithSelection=function(D,F){var E=F.CreateBookmark();FCKListHandler.OutdentListItem(D);F.MoveToBookmark(E);F.Select()};FCKEnterKey.prototype._CheckIsAllContentsIncluded=function(F,J){var I=false;var H=false;if(F.StartContainer==J||F.StartContainer==J.firstChild){I=(F._Range.startOffset==0)}if(F.EndContainer==J||F.EndContainer==J.lastChild){var G=F.EndContainer.nodeType==3?F.EndContainer.length:F.EndContainer.childNodes.length;H=(F._Range.endOffset==G)}return I&&H};FCKEnterKey.prototype._FixIESelectAllBug=function(D){var F=this.Window.document;F.body.innerHTML="";var E;if(FCKConfig.EnterMode.IEquals(["div","p"])){E=F.createElement(FCKConfig.EnterMode);F.body.appendChild(E)}else{E=F.body}D.MoveToNodeContents(E);D.Collapse(true);D.Select();D.Release()};var FCKDocumentProcessor={};FCKDocumentProcessor._Items=[];FCKDocumentProcessor.AppendNew=function(){var B={};this._Items.AddItem(B);return B};FCKDocumentProcessor.Process=function(D){var G=FCK.IsDirty();var F,E=0;while((F=this._Items[E++])){F.ProcessDocument(D)}if(!G){FCK.ResetIsDirty()}};var FCKDocumentProcessor_CreateFakeImage=function(D,F){var E=FCKTools.GetElementDocument(F).createElement("IMG");E.className=D;E.src=FCKConfig.BasePath+"images/spacer.gif";E.setAttribute("_fckfakelement","true",0);E.setAttribute("_fckrealelement",FCKTempBin.AddElement(F),0);return E};if(FCKBrowserInfo.IsIE||FCKBrowserInfo.IsOpera){var FCKAnchorsProcessor=FCKDocumentProcessor.AppendNew();FCKAnchorsProcessor.ProcessDocument=function(E){var I=E.getElementsByTagName("A");var H;var F=I.length-1;while(F>=0&&(H=I[F--])){if(H.name.length>0){if(H.innerHTML!==""){if(FCKBrowserInfo.IsIE){H.className+=" FCK__AnchorC"}}else{var G=FCKDocumentProcessor_CreateFakeImage("FCK__Anchor",H.cloneNode(true));G.setAttribute("_fckanchor","true",0);H.parentNode.insertBefore(G,H);H.parentNode.removeChild(H)}}}}}var FCKPageBreaksProcessor=FCKDocumentProcessor.AppendNew();FCKPageBreaksProcessor.ProcessDocument=function(E){var I=E.getElementsByTagName("DIV");var H;var F=I.length-1;while(F>=0&&(H=I[F--])){if(H.style.pageBreakAfter=="always"&&H.childNodes.length==1&&H.childNodes[0].style&&H.childNodes[0].style.display=="none"){var G=FCKDocumentProcessor_CreateFakeImage("FCK__PageBreak",H.cloneNode(true));H.parentNode.insertBefore(G,H);H.parentNode.removeChild(H)}}};FCKEmbedAndObjectProcessor=(function(){var C=[];var G=function(B){var I=B.cloneNode(true);var H;var F=H=FCKDocumentProcessor_CreateFakeImage("FCK__UnknownObject",I);FCKEmbedAndObjectProcessor.RefreshView(F,B);for(var A=0;A<C.length;A++){H=C[A](B,H)||H}if(H!=F){FCKTempBin.RemoveElement(F.getAttribute("_fckrealelement"))}B.parentNode.replaceChild(H,B)};var E=function(A,H){var F=H.getElementsByTagName(A);for(var B=F.length-1;B>=0;B--){G(F[B])}};var D=function(A){E("object",A);E("embed",A)};return FCKTools.Merge(FCKDocumentProcessor.AppendNew(),{ProcessDocument:function(A){if(FCKBrowserInfo.IsGecko){FCKTools.RunFunction(D,this,[A])}else{D(A)}},RefreshView:function(B,A){if(A.getAttribute("width")>0){B.style.width=FCKTools.ConvertHtmlSizeToStyle(A.getAttribute("width"))}if(A.getAttribute("height")>0){B.style.height=FCKTools.ConvertHtmlSizeToStyle(A.getAttribute("height"))}},AddCustomHandler:function(A){C.push(A)}})})();FCK.GetRealElement=function(B){var C=FCKTempBin.Elements[B.getAttribute("_fckrealelement")];if(B.getAttribute("_fckflash")){if(B.style.width.length>0){C.width=FCKTools.ConvertStyleSizeToHtml(B.style.width)}if(B.style.height.length>0){C.height=FCKTools.ConvertStyleSizeToHtml(B.style.height)}}return C};if(FCKBrowserInfo.IsIE){FCKDocumentProcessor.AppendNew().ProcessDocument=function(E){var I=E.getElementsByTagName("HR");var H;var F=I.length-1;while(F>=0&&(H=I[F--])){var G=E.createElement("hr");G.mergeAttributes(H,true);FCKDomTools.InsertAfterNode(H,G);H.parentNode.removeChild(H)}}}FCKDocumentProcessor.AppendNew().ProcessDocument=function(E){var I=E.getElementsByTagName("INPUT");var H;var F=I.length-1;while(F>=0&&(H=I[F--])){if(H.type=="hidden"){var G=FCKDocumentProcessor_CreateFakeImage("FCK__InputHidden",H.cloneNode(true));G.setAttribute("_fckinputhidden","true",0);H.parentNode.insertBefore(G,H);H.parentNode.removeChild(H)}}};FCKEmbedAndObjectProcessor.AddCustomHandler(function(C,D){if(!(C.nodeName.IEquals("embed")&&(C.type=="application/x-shockwave-flash"||/\.swf($|#|\?)/i.test(C.src)))){return}D.className="FCK__Flash";D.setAttribute("_fckflash","true",0)});if(FCKBrowserInfo.IsSafari){FCKDocumentProcessor.AppendNew().ProcessDocument=function(C){var E=C.getElementsByClassName?C.getElementsByClassName("Apple-style-span"):Array.prototype.filter.call(C.getElementsByTagName("span"),function(A){return A.className=="Apple-style-span"});for(var D=E.length-1;D>=0;D--){FCKDomTools.RemoveNode(E[D],true)}}}var FCKSelection=FCK.Selection={GetParentBlock:function(){var B=this.GetParentElement();while(B){if(FCKListsLib.BlockBoundaries[B.nodeName.toLowerCase()]){break}B=B.parentNode}return B},ApplyStyle:function(B){FCKStyles.ApplyStyle(new FCKStyle(B))}};FCKSelection.GetType=function(){var D="Text";var G;try{G=this.GetSelection()}catch(E){}if(G&&G.rangeCount==1){var F=G.getRangeAt(0);if(F.startContainer==F.endContainer&&(F.endOffset-F.startOffset)==1&&F.startContainer.nodeType==1&&FCKListsLib.StyleObjectElements[F.startContainer.childNodes[F.startOffset].nodeName.toLowerCase()]){D="Control"}}return D};FCKSelection.GetSelectedElement=function(){var D=!!FCK.EditorWindow&&this.GetSelection();if(!D||D.rangeCount<1){return null}var F=D.getRangeAt(0);if(F.startContainer!=F.endContainer||F.startContainer.nodeType!=1||F.startOffset!=F.endOffset-1){return null}var E=F.startContainer.childNodes[F.startOffset];if(E.nodeType!=1){return null}return E};FCKSelection.GetParentElement=function(){if(this.GetType()=="Control"){return FCKSelection.GetSelectedElement().parentNode}else{var H=this.GetSelection();if(H){if(H.anchorNode&&H.anchorNode==H.focusNode){var O=H.getRangeAt(0);if(O.collapsed||O.startContainer.nodeType==3){return H.anchorNode.parentNode}else{return H.anchorNode}}var N=new FCKElementPath(H.anchorNode);var M=new FCKElementPath(H.focusNode);var L=null;var K=null;if(N.Elements.length>M.Elements.length){L=N.Elements;K=M.Elements}else{L=M.Elements;K=N.Elements}var J=L.length-K.length;for(var I=0;I<K.length;I++){if(L[J+I]==K[I]){return K[I]}}return null}}return null};FCKSelection.GetBoundaryParentElement=function(E){if(!FCK.EditorWindow){return null}if(this.GetType()=="Control"){return FCKSelection.GetSelectedElement().parentNode}else{var H=this.GetSelection();if(H&&H.rangeCount>0){var G=H.getRangeAt(E?0:(H.rangeCount-1));var F=E?G.startContainer:G.endContainer;return(F.nodeType==1?F:F.parentNode)}}return null};FCKSelection.SelectNode=function(D){var F=FCK.EditorDocument.createRange();F.selectNode(D);var E=this.GetSelection();E.removeAllRanges();E.addRange(F)};FCKSelection.Collapse=function(C){var D=this.GetSelection();if(C==null||C===true){D.collapseToStart()}else{D.collapseToEnd()}};FCKSelection.HasAncestorNode=function(C){var E=this.GetSelectedElement();if(!E&&FCK.EditorWindow){try{E=this.GetSelection().getRangeAt(0).startContainer}catch(D){}}while(E){if(E.nodeType==1&&E.nodeName.IEquals(C)){return true}E=E.parentNode}return false};FCKSelection.MoveToAncestorNode=function(D){var F;var E=this.GetSelectedElement();if(!E){E=this.GetSelection().getRangeAt(0).startContainer}while(E){if(E.nodeName.IEquals(D)){return E}E=E.parentNode}return null};FCKSelection.Delete=function(){var B=this.GetSelection();for(var C=0;C<B.rangeCount;C++){B.getRangeAt(C).deleteContents()}return B};FCKSelection.GetSelection=function(){return FCK.EditorWindow.getSelection()};FCKSelection.Save=function(){};FCKSelection.Restore=function(){};FCKSelection.Release=function(){};var FCKTableHandler={};FCKTableHandler.InsertRow=function(D){var F=FCKSelection.MoveToAncestorNode("TR");if(!F){return}var E=F.cloneNode(true);F.parentNode.insertBefore(E,F);FCKTableHandler.ClearRow(D?E:F)};FCKTableHandler.DeleteRows=function(F){if(!F){var K=FCKTableHandler.GetSelectedCells();var J=[];for(var G=0;G<K.length;G++){var I=FCKTools.GetElementAscensor(K[G],"TR");J[I.rowIndex]=I}for(var G=J.length;G>=0;G--){if(J[G]){FCKTableHandler.DeleteRows(J[G])}}return}var H=FCKTools.GetElementAscensor(F,"TABLE");if(H.rows.length==1){FCKTableHandler.DeleteTable(H);return}F.parentNode.removeChild(F)};FCKTableHandler.DeleteTable=function(B){if(!B){B=FCKSelection.GetSelectedElement();if(!B||B.tagName!="TABLE"){B=FCKSelection.MoveToAncestorNode("TABLE")}}if(!B){return}FCKSelection.SelectNode(B);FCKSelection.Collapse();if(B.parentNode.childNodes.length==1){B.parentNode.parentNode.removeChild(B.parentNode)}else{B.parentNode.removeChild(B)}};FCKTableHandler.InsertColumn=function(H){var O=null;var N=this.GetSelectedCells();if(N&&N.length){O=N[H?0:(N.length-1)]}if(!O){return}var M=FCKTools.GetElementAscensor(O,"TABLE");var L=O.cellIndex;for(var I=0;I<M.rows.length;I++){var K=M.rows[I];if(K.cells.length<(L+1)){continue}O=K.cells[L].cloneNode(false);if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(O)}var J=K.cells[L];if(H){K.insertBefore(O,J)}else{if(J.nextSibling){K.insertBefore(O,J.nextSibling)}else{K.appendChild(O)}}}};FCKTableHandler.DeleteColumns=function(F){if(!F){var K=FCKTableHandler.GetSelectedCells();for(var G=K.length;G>=0;G--){if(K[G]){FCKTableHandler.DeleteColumns(K[G])}}return}if(!F){return}var J=FCKTools.GetElementAscensor(F,"TABLE");var I=F.cellIndex;for(var G=J.rows.length-1;G>=0;G--){var H=J.rows[G];if(I==0&&H.cells.length==1){FCKTableHandler.DeleteRows(H);continue}if(H.cells[I]){H.removeChild(H.cells[I])}}};FCKTableHandler.InsertCell=function(F,J){var I=null;var H=this.GetSelectedCells();if(H&&H.length){I=H[J?0:(H.length-1)]}if(!I){return null}var G=FCK.EditorDocument.createElement("TD");if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(G)}if(!J&&I.cellIndex==I.parentNode.cells.length-1){I.parentNode.appendChild(G)}else{I.parentNode.insertBefore(G,J?I:I.nextSibling)}return G};FCKTableHandler.DeleteCell=function(B){if(B.parentNode.cells.length==1){FCKTableHandler.DeleteRows(FCKTools.GetElementAscensor(B,"TR"));return}B.parentNode.removeChild(B)};FCKTableHandler.DeleteCells=function(){var B=FCKTableHandler.GetSelectedCells();for(var C=B.length-1;C>=0;C--){FCKTableHandler.DeleteCell(B[C])}};FCKTableHandler._MarkCells=function(C,E){for(var D=0;D<C.length;D++){C[D][E]=true}};FCKTableHandler._UnmarkCells=function(C,E){for(var D=0;D<C.length;D++){if(FCKBrowserInfo.IsIE){C[D].removeAttribute(E)}else{delete C[D][E]}}};FCKTableHandler._ReplaceCellsByMarker=function(D,H,G){for(var F=0;F<D.length;F++){for(var E=0;E<D[F].length;E++){if(D[F][E][H]){D[F][E]=G}}}};FCKTableHandler._GetMarkerGeometry=function(L,K,J,I){var Q=0;var P=0;var O=0;var N=0;for(var M=J;L[K][M]&&L[K][M][I];M++){Q++}for(var M=J-1;L[K][M]&&L[K][M][I];M--){Q++;O++}for(var M=K;L[M]&&L[M][J]&&L[M][J][I];M++){P++}for(var M=K-1;L[M]&&L[M][J]&&L[M][J][I];M--){P++;N++}return{width:Q,height:P,x:O,y:N}};FCKTableHandler.CheckIsSelectionRectangular=function(){var H=FCKTableHandler.GetSelectedCells();if(H.length<1){return false}this._MarkCells(H,"_CellSelected");var O=this._CreateTableMap(H[0].parentNode.parentNode);var N=H[0].parentNode.rowIndex;var M=this._GetCellIndexSpan(O,N,H[0]);var L=this._GetMarkerGeometry(O,N,M,"_CellSelected");var K=M-L.x;var I=N-L.y;if(L.width>=L.height){for(M=K;M<K+L.width;M++){N=I+(M-K)%L.height;if(!O[N]||!O[N][M]){this._UnmarkCells(H,"_CellSelected");return false}var J=this._GetMarkerGeometry(O,N,M,"_CellSelected");if(J.width!=L.width||J.height!=L.height){this._UnmarkCells(H,"_CellSelected");return false}}}else{for(N=I;N<I+L.height;N++){M=K+(N-I)%L.width;if(!O[N]||!O[N][M]){this._UnmarkCells(H,"_CellSelected");return false}var J=this._GetMarkerGeometry(O,N,M,"_CellSelected");if(J.width!=L.width||J.height!=L.height){this._UnmarkCells(H,"_CellSelected");return false}}}this._UnmarkCells(H,"_CellSelected");return true};FCKTableHandler.MergeCells=function(){var P=this.GetSelectedCells();if(P.length<2){return}var O=P[0];var N=this._CreateTableMap(O.parentNode.parentNode);var M=O.parentNode.rowIndex;var Z=this._GetCellIndexSpan(N,M,O);this._MarkCells(P,"_SelectedCells");var Y=this._GetMarkerGeometry(N,M,Z,"_SelectedCells");var X=Z-Y.x;var W=M-Y.y;var V=FCKTools.GetElementDocument(O).createDocumentFragment();for(var R=0;R<Y.height;R++){var U=0;for(var Q=0;Q<Y.width;Q++){var T=N[W+R][X+Q];while(T.childNodes.length>0){var S=T.removeChild(T.firstChild);if(S.nodeType!=1||(S.getAttribute("type",2)!="_moz"&&S.getAttribute("_moz_dirty")!=null)){V.appendChild(S);U++}}}if(U>0){V.appendChild(FCKTools.GetElementDocument(O).createElement("br"))}}this._ReplaceCellsByMarker(N,"_SelectedCells",O);this._UnmarkCells(P,"_SelectedCells");this._InstallTableMap(N,O.parentNode.parentNode);O.appendChild(V);if(FCKBrowserInfo.IsGeckoLike&&(!O.firstChild)){FCKTools.AppendBogusBr(O)}this._MoveCaretToCell(O,false)};FCKTableHandler.MergeRight=function(){var F=this.GetMergeRightTarget();if(F==null){return}var J=F.refCell;var I=F.tableMap;var H=F.nextCell;var G=FCK.EditorDocument.createDocumentFragment();while(H&&H.childNodes&&H.childNodes.length>0){G.appendChild(H.removeChild(H.firstChild))}H.parentNode.removeChild(H);J.appendChild(G);this._MarkCells([H],"_Replace");this._ReplaceCellsByMarker(I,"_Replace",J);this._InstallTableMap(I,J.parentNode.parentNode);this._MoveCaretToCell(J,false)};FCKTableHandler.MergeDown=function(){var F=this.GetMergeDownTarget();if(F==null){return}var J=F.refCell;var I=F.tableMap;var H=F.nextCell;var G=FCKTools.GetElementDocument(J).createDocumentFragment();while(H&&H.childNodes&&H.childNodes.length>0){G.appendChild(H.removeChild(H.firstChild))}if(G.firstChild){G.insertBefore(FCKTools.GetElementDocument(H).createElement("br"),G.firstChild)}J.appendChild(G);this._MarkCells([H],"_Replace");this._ReplaceCellsByMarker(I,"_Replace",J);this._InstallTableMap(I,J.parentNode.parentNode);this._MoveCaretToCell(J,false)};FCKTableHandler.HorizontalSplitCell=function(){var R=FCKTableHandler.GetSelectedCells();if(R.length!=1){return}var Q=R[0];var P=this._CreateTableMap(Q.parentNode.parentNode);var O=Q.parentNode.rowIndex;var c=FCKTableHandler._GetCellIndexSpan(P,O,Q);var b=isNaN(Q.colSpan)?1:Q.colSpan;if(b>1){var a=Math.ceil(b/2);var Z=FCKTools.GetElementDocument(Q).createElement("td");if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(Z)}var Y=c+a;var X=c+b;var W=isNaN(Q.rowSpan)?1:Q.rowSpan;for(var N=O;N<O+W;N++){for(var T=Y;T<X;T++){P[N][T]=Z}}}else{var V=[];for(var T=0;T<P.length;T++){var U=P[T].slice(0,c);if(P[T].length<=c){V.push(U);continue}if(P[T][c]==Q){U.push(Q);U.push(FCKTools.GetElementDocument(Q).createElement("td"));if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(U[U.length-1])}}else{U.push(P[T][c]);U.push(P[T][c])}for(var S=c+1;S<P[T].length;S++){U.push(P[T][S])}V.push(U)}P=V}this._InstallTableMap(P,Q.parentNode.parentNode)};FCKTableHandler.VerticalSplitCell=function(){var Q=FCKTableHandler.GetSelectedCells();if(Q.length!=1){return}var P=Q[0];var O=this._CreateTableMap(P.parentNode.parentNode);var J=FCKTableHandler._GetCellIndexSpan(O,P.parentNode.rowIndex,P);var a=P.rowSpan;var Z=P.parentNode.rowIndex;if(isNaN(a)){a=1}if(a>1){P.rowSpan=Math.ceil(a/2);var Y=Z+Math.ceil(a/2);var X=null;for(var R=J+1;R<O[Y].length;R++){if(O[Y][R].parentNode.rowIndex==Y){X=O[Y][R];break}}var W=FCK.EditorDocument.createElement("td");W.rowSpan=Math.floor(a/2);if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(W)}P.parentNode.parentNode.rows[Y].insertBefore(W,X)}else{var Y=Z+1;var V=FCK.EditorDocument.createElement("tr");var U=P.parentNode.parentNode;if(U.rows.length>Y){U.insertBefore(V,U.rows[Y])}else{U.appendChild(V)}for(var R=0;R<O[Z].length;){var T=O[Z][R].colSpan;if(isNaN(T)||T<1){T=1}if(R==J){R+=T;continue}var S=O[Z][R].rowSpan;if(isNaN(S)){S=1}O[Z][R].rowSpan=S+1;R+=T}var W=FCK.EditorDocument.createElement("td");if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(W)}V.appendChild(W)}};FCKTableHandler._GetCellIndexSpan=function(E,I,G){if(E.length<I+1){return null}var F=E[I];for(var H=0;H<F.length;H++){if(F[H]==G){return H}}return null};FCKTableHandler._GetCellLocation=function(C,F){for(var D=0;D<C.length;D++){for(var E=0;E<C[D].length;E++){if(C[D][E]==F){return[D,E]}}}return null};FCKTableHandler._GetColumnCells=function(E,I){var H=[];for(var F=0;F<E.length;F++){var G=E[F][I];if(G&&(H.length==0||H[H.length-1]!=G)){H[H.length]=G}}return H};FCKTableHandler._CreateTableMap=function(M){var L=M.rows;var J=-1;var K=[];for(var O=0;O<L.length;O++){J++;if(!K[J]){K[J]=[]}var P=-1;for(var N=0;N<L[O].cells.length;N++){var I=L[O].cells[N];P++;while(K[J][P]){P++}var T=isNaN(I.colSpan)?1:I.colSpan;var S=isNaN(I.rowSpan)?1:I.rowSpan;for(var R=0;R<S;R++){if(!K[J+R]){K[J+R]=[]}for(var Q=0;Q<T;Q++){K[J+R][P+Q]=L[O].cells[N]}}P+=T-1}}return K};FCKTableHandler._InstallTableMap=function(K,I){var H=FCKBrowserInfo.IsIE?"_fckrowspan":"rowSpan";while(I.rows.length>0){var G=I.rows[0];G.parentNode.removeChild(G)}for(var M=0;M<K.length;M++){for(var L=0;L<K[M].length;L++){var P=K[M][L];if(P.parentNode){P.parentNode.removeChild(P)}P.colSpan=P[H]=1}}var O=0;for(var M=0;M<K.length;M++){for(var L=0;L<K[M].length;L++){var P=K[M][L];if(!P){continue}if(L>O){O=L}if(P._colScanned===true){continue}if(K[M][L-1]==P){P.colSpan++}if(K[M][L+1]!=P){P._colScanned=true}}}for(var M=0;M<=O;M++){for(var L=0;L<K.length;L++){if(!K[L]){continue}var P=K[L][M];if(!P||P._rowScanned===true){continue}if(K[L-1]&&K[L-1][M]==P){P[H]++}if(!K[L+1]||K[L+1][M]!=P){P._rowScanned=true}}}for(var M=0;M<K.length;M++){for(var L=0;L<K[M].length;L++){var P=K[M][L];if(FCKBrowserInfo.IsIE){P.removeAttribute("_colScanned");P.removeAttribute("_rowScanned")}else{delete P._colScanned;delete P._rowScanned}}}for(var M=0;M<K.length;M++){var N=FCKTools.GetElementDocument(I).createElement("tr");for(var L=0;L<K[M].length;){var P=K[M][L];if(K[M-1]&&K[M-1][L]==P){L+=P.colSpan;continue}N.appendChild(P);if(H!="rowSpan"){P.rowSpan=P[H];P.removeAttribute(H)}L+=P.colSpan;if(P.colSpan==1){P.removeAttribute("colspan")}if(P.rowSpan==1){P.removeAttribute("rowspan")}}I.appendChild(N)}};FCKTableHandler._MoveCaretToCell=function(D,F){var E=new FCKDomRange(FCK.EditorWindow);E.MoveToNodeContents(D);E.Collapse(F);E.Select()};FCKTableHandler.ClearRow=function(C){var E=C.cells;for(var D=0;D<E.length;D++){E[D].innerHTML="";if(FCKBrowserInfo.IsGeckoLike){FCKTools.AppendBogusBr(E[D])}}};FCKTableHandler.GetMergeRightTarget=function(){var M=this.GetSelectedCells();if(M.length!=1){return null}var L=M[0];var K=this._CreateTableMap(L.parentNode.parentNode);var J=L.parentNode.rowIndex;var R=this._GetCellIndexSpan(K,J,L);var Q=R+(isNaN(L.colSpan)?1:L.colSpan);var P=K[J][Q];if(!P){return null}this._MarkCells([L,P],"_SizeTest");var O=this._GetMarkerGeometry(K,J,R,"_SizeTest");var N=this._GetMarkerGeometry(K,J,Q,"_SizeTest");this._UnmarkCells([L,P],"_SizeTest");if(O.height!=N.height||O.y!=N.y){return null}return{refCell:L,nextCell:P,tableMap:K}};FCKTableHandler.GetMergeDownTarget=function(){var M=this.GetSelectedCells();if(M.length!=1){return null}var L=M[0];var K=this._CreateTableMap(L.parentNode.parentNode);var J=L.parentNode.rowIndex;var R=this._GetCellIndexSpan(K,J,L);var Q=J+(isNaN(L.rowSpan)?1:L.rowSpan);if(!K[Q]){return null}var P=K[Q][R];if(!P){return null}this._MarkCells([L,P],"_SizeTest");var O=this._GetMarkerGeometry(K,J,R,"_SizeTest");var N=this._GetMarkerGeometry(K,Q,R,"_SizeTest");this._UnmarkCells([L,P],"_SizeTest");if(O.width!=N.width||O.x!=N.x){return null}return{refCell:L,nextCell:P,tableMap:K}};FCKTableHandler.GetSelectedCells=function(){var F=[];var K=FCKSelection.GetSelection();if(K.rangeCount==1&&K.anchorNode.nodeType==3){var J=FCKTools.GetElementAscensor(K.anchorNode,"TD,TH");if(J){F[0]=J}return F}for(var G=0;G<K.rangeCount;G++){var I=K.getRangeAt(G);var H;if(I.startContainer.tagName.Equals("TD","TH")){H=I.startContainer}else{H=I.startContainer.childNodes[I.startOffset]}if(H.tagName.Equals("TD","TH")){F[F.length]=H}}return F};var FCKXml=function(){this.Error=false};FCKXml.GetAttribute=function(E,H,G){var F=E.attributes.getNamedItem(H);return F?F.value:G};FCKXml.TransformToObject=function(L){if(!L){return null}var K={};var J=L.attributes;for(var M=0;M<J.length;M++){var I=J[M];K[I.name]=I.value}var Q=L.childNodes;for(M=0;M<Q.length;M++){var P=Q[M];if(P.nodeType==1){var O="$"+P.nodeName;var N=K[O];if(!N){N=K[O]=[]}N.push(this.TransformToObject(P))}}return K};FCKXml.prototype={LoadUrl:function(E){this.Error=false;var I;var H=FCKTools.CreateXmlObject("XmlHttp");H.open("GET",E,false);H.send(null);if(H.status==200||H.status==304||(H.status==0&&H.readyState==4)){I=H.responseXML;if(!I){I=(new DOMParser()).parseFromString(H.responseText,"text/xml")}}else{I=null}if(I){try{var G=I.firstChild}catch(F){I=(new DOMParser()).parseFromString(H.responseText,"text/xml")}}if(!I||!I.firstChild){this.Error=true;if(window.confirm('Error loading "'+E+'" (HTTP Status: '+H.status+").\r\nDo you want to see the server response dump?")){alert(H.responseText)}}this.DOMDocument=I},SelectNodes:function(F,J){if(this.Error){return[]}var I=[];var H=this.DOMDocument.evaluate(F,J?J:this.DOMDocument,this.DOMDocument.createNSResolver(this.DOMDocument.documentElement),XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(H){var G=H.iterateNext();while(G){I[I.length]=G;G=H.iterateNext()}}return I},SelectSingleNode:function(D,F){if(this.Error){return null}var E=this.DOMDocument.evaluate(D,F?F:this.DOMDocument,this.DOMDocument.createNSResolver(this.DOMDocument.documentElement),9,null);if(E&&E.singleNodeValue){return E.singleNodeValue}else{return null}}};var FCKNamedCommand=function(B){this.Name=B};FCKNamedCommand.prototype.Execute=function(){FCK.ExecuteNamedCommand(this.Name)};FCKNamedCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return-1}return FCK.GetNamedCommandState(this.Name)};var FCKStyleCommand=function(){};FCKStyleCommand.prototype={Name:"Style",Execute:function(C,D){FCKUndo.SaveUndoStep();if(D.Selected){FCK.Styles.RemoveStyle(D.Style)}else{FCK.Styles.ApplyStyle(D.Style)}FCKUndo.SaveUndoStep();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange")},GetState:function(){if(FCK.EditMode!=0||!FCK.EditorDocument){return-1}if(FCKSelection.GetType()=="Control"){var B=FCKSelection.GetSelectedElement();if(!B||!FCKStyles.CheckHasObjectStyle(B.nodeName.toLowerCase())){return-1}}return 0}};var FCKDialogCommand=function(I,P,O,N,M,L,K,J){this.Name=I;this.Title=P;this.Url=O;this.Width=N;this.Height=M;this.CustomValue=J;this.GetStateFunction=L;this.GetStateParam=K;this.Resizable=false};FCKDialogCommand.prototype.Execute=function(){FCKDialog.OpenDialog("FCKDialog_"+this.Name,this.Title,this.Url,this.Width,this.Height,this.CustomValue,null,this.Resizable)};FCKDialogCommand.prototype.GetState=function(){if(this.GetStateFunction){return this.GetStateFunction(this.GetStateParam)}else{return FCK.EditMode==0?0:-1}};var FCKUndefinedCommand=function(){this.Name="Undefined"};FCKUndefinedCommand.prototype.Execute=function(){alert(FCKLang.NotImplemented)};FCKUndefinedCommand.prototype.GetState=function(){return 0};var FCKFormatBlockCommand=function(){};FCKFormatBlockCommand.prototype={Name:"FormatBlock",Execute:FCKStyleCommand.prototype.Execute,GetState:function(){return FCK.EditorDocument?0:-1}};var FCKFontNameCommand=function(){};FCKFontNameCommand.prototype={Name:"FontName",Execute:FCKStyleCommand.prototype.Execute,GetState:FCKFormatBlockCommand.prototype.GetState};var FCKFontSizeCommand=function(){};FCKFontSizeCommand.prototype={Name:"FontSize",Execute:FCKStyleCommand.prototype.Execute,GetState:FCKFormatBlockCommand.prototype.GetState};var FCKPreviewCommand=function(){this.Name="Preview"};FCKPreviewCommand.prototype.Execute=function(){FCK.Preview()};FCKPreviewCommand.prototype.GetState=function(){return 0};var FCKSaveCommand=function(){this.Name="Save"};FCKSaveCommand.prototype.Execute=function(){var C=FCK.GetParentForm();if(typeof(C.onsubmit)=="function"){var D=C.onsubmit();if(D!=null&&D===false){return}}if(typeof(C.submit)=="function"){C.submit()}else{C.submit.click()}};FCKSaveCommand.prototype.GetState=function(){return 0};var FCKNewPageCommand=function(){this.Name="NewPage"};FCKNewPageCommand.prototype.Execute=function(){FCKUndo.SaveUndoStep();FCK.SetData("");FCKUndo.Typing=true;FCK.Focus()};FCKNewPageCommand.prototype.GetState=function(){return 0};var FCKSourceCommand=function(){this.Name="Source"};FCKSourceCommand.prototype.Execute=function(){if(FCKConfig.SourcePopup){var C=FCKConfig.ScreenWidth*0.65;var D=FCKConfig.ScreenHeight*0.65;FCKDialog.OpenDialog("FCKDialog_Source",FCKLang.Source,"dialog/fck_source.html",C,D,null,null,true)}else{FCK.SwitchEditMode()}};FCKSourceCommand.prototype.GetState=function(){return(FCK.EditMode==0?0:1)};var FCKUndoCommand=function(){this.Name="Undo"};FCKUndoCommand.prototype.Execute=function(){FCKUndo.Undo()};FCKUndoCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return-1}return(FCKUndo.CheckUndoState()?0:-1)};var FCKRedoCommand=function(){this.Name="Redo"};FCKRedoCommand.prototype.Execute=function(){FCKUndo.Redo()};FCKRedoCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return-1}return(FCKUndo.CheckRedoState()?0:-1)};var FCKPageBreakCommand=function(){this.Name="PageBreak"};FCKPageBreakCommand.prototype.Execute=function(){FCKUndo.SaveUndoStep();var E=FCK.EditorDocument.createElement("DIV");E.style.pageBreakAfter="always";E.innerHTML='<span style="DISPLAY:none">&nbsp;</span>';var D=FCKDocumentProcessor_CreateFakeImage("FCK__PageBreak",E);var G=new FCKDomRange(FCK.EditorWindow);G.MoveToSelection();var F=G.SplitBlock();G.InsertNode(D);FCK.Events.FireEvent("OnSelectionChange")};FCKPageBreakCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return-1}return 0};var FCKUnlinkCommand=function(){this.Name="Unlink"};FCKUnlinkCommand.prototype.Execute=function(){FCKUndo.SaveUndoStep();if(FCKBrowserInfo.IsGeckoLike){var B=FCK.Selection.MoveToAncestorNode("A");if(B){FCKTools.RemoveOuterTags(B)}return}FCK.ExecuteNamedCommand(this.Name)};FCKUnlinkCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return-1}var D=FCK.GetNamedCommandState(this.Name);if(D==0&&FCK.EditMode==0){var F=FCKSelection.MoveToAncestorNode("A");var E=(F&&F.name.length>0&&F.href.length==0);if(E){D=-1}}return D};FCKVisitLinkCommand=function(){this.Name="VisitLink"};FCKVisitLinkCommand.prototype={GetState:function(){if(FCK.EditMode!=0){return-1}var C=FCK.GetNamedCommandState("Unlink");if(C==0){var D=FCKSelection.MoveToAncestorNode("A");if(!D.href){C=-1}}return C},Execute:function(){var E=FCKSelection.MoveToAncestorNode("A");var I=E.getAttribute("_fcksavedurl")||E.getAttribute("href",2);if(!/:\/\//.test(I)){var H=FCKConfig.BaseHref;var G=FCK.GetInstanceObject("parent");if(!H){H=G.document.location.href;H=H.substring(0,H.lastIndexOf("/")+1)}if(/^\//.test(I)){try{H=H.match(/^.*:\/\/+[^\/]+/)[0]}catch(F){H=G.document.location.protocol+"://"+G.parent.document.location.host}}I=H+I}if(!window.open(I,"_blank")){alert(FCKLang.VisitLinkBlocked)}}};var FCKSelectAllCommand=function(){this.Name="SelectAll"};FCKSelectAllCommand.prototype.Execute=function(){if(FCK.EditMode==0){FCK.ExecuteNamedCommand("SelectAll")}else{var B=FCK.EditingArea.Textarea;if(FCKBrowserInfo.IsIE){B.createTextRange().execCommand("SelectAll")}else{B.selectionStart=0;B.selectionEnd=B.value.length}B.focus()}};FCKSelectAllCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return-1}return 0};var FCKPasteCommand=function(){this.Name="Paste"};FCKPasteCommand.prototype={Execute:function(){if(FCKBrowserInfo.IsIE){FCK.Paste()}else{FCK.ExecuteNamedCommand("Paste")}},GetState:function(){if(FCK.EditMode!=0){return-1}return FCK.GetNamedCommandState("Paste")}};var FCKRuleCommand=function(){this.Name="Rule"};FCKRuleCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();FCK.InsertElement("hr")},GetState:function(){if(FCK.EditMode!=0){return-1}return FCK.GetNamedCommandState("InsertHorizontalRule")}};var FCKCutCopyCommand=function(B){this.Name=B?"Cut":"Copy"};FCKCutCopyCommand.prototype={Execute:function(){var D=false;if(FCKBrowserInfo.IsIE){var G=function(){D=true};var F="on"+this.Name.toLowerCase();FCK.EditorDocument.body.attachEvent(F,G);FCK.ExecuteNamedCommand(this.Name);FCK.EditorDocument.body.detachEvent(F,G)}else{try{FCK.ExecuteNamedCommand(this.Name);D=true}catch(E){}}if(!D){alert(FCKLang["PasteError"+this.Name])}},GetState:function(){return FCK.EditMode!=0?-1:FCK.GetNamedCommandState("Cut")}};var FCKAnchorDeleteCommand=function(){this.Name="AnchorDelete"};FCKAnchorDeleteCommand.prototype={Execute:function(){if(FCK.Selection.GetType()=="Control"){FCK.Selection.Delete()}else{var B=FCK.Selection.GetSelectedElement();if(B){if(B.tagName=="IMG"&&B.getAttribute("_fckanchor")){oAnchor=FCK.GetRealElement(B)}else{B=null}}if(!B){oAnchor=FCK.Selection.MoveToAncestorNode("A");if(oAnchor){FCK.Selection.SelectNode(oAnchor)}}if(oAnchor.href.length!=0){oAnchor.removeAttribute("name");if(FCKBrowserInfo.IsIE){oAnchor.className=oAnchor.className.replace(FCKRegexLib.FCK_Class,"")}return}if(B){B.parentNode.removeChild(B);return}if(oAnchor.innerHTML.length==0){oAnchor.parentNode.removeChild(oAnchor);return}FCKTools.RemoveOuterTags(oAnchor)}if(FCKBrowserInfo.IsGecko){FCK.Selection.Collapse(true)}},GetState:function(){if(FCK.EditMode!=0){return-1}return FCK.GetNamedCommandState("Unlink")}};var FCKDeleteDivCommand=function(){};FCKDeleteDivCommand.prototype={GetState:function(){if(FCK.EditMode!=0){return-1}var C=FCKSelection.GetParentElement();var D=new FCKElementPath(C);return D.BlockLimit&&D.BlockLimit.nodeName.IEquals("div")?0:-1},Execute:function(){FCKUndo.SaveUndoStep();var D=FCKDomTools.GetSelectedDivContainers();var G=new FCKDomRange(FCK.EditorWindow);G.MoveToSelection();var F=G.CreateBookmark();for(var E=0;E<D.length;E++){FCKDomTools.RemoveNode(D[E],true)}G.MoveToBookmark(F);G.Select()}};var FCKNbsp=function(){this.Name="Non Breaking Space"};FCKNbsp.prototype={Execute:function(){FCK.InsertHtml("&nbsp;")},GetState:function(){return(FCK.EditMode!=0?-1:0)}};var FCKShowBlockCommand=function(C,D){this.Name=C;if(D!=undefined){this._SavedState=D}else{this._SavedState=null}};FCKShowBlockCommand.prototype.Execute=function(){var D=this.GetState();if(D==-1){return}var G=FCK.EditorDocument.body;if(D==1){G.className=G.className.replace(/(^| )FCK__ShowBlocks/g,"")}else{G.className+=" FCK__ShowBlocks"}if(FCKBrowserInfo.IsIE){try{FCK.EditorDocument.selection.createRange().select()}catch(E){}}else{var F=FCK.EditorWindow.getSelection().focusNode;if(F.nodeType!=1){F=F.parentNode}FCKDomTools.ScrollIntoView(F,false)}FCK.Events.FireEvent("OnSelectionChange")};FCKShowBlockCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return-1}if(!FCK.EditorDocument){return 0}if(/FCK__ShowBlocks(?:\s|$)/.test(FCK.EditorDocument.body.className)){return 1}return 0};FCKShowBlockCommand.prototype.SaveState=function(){this._SavedState=this.GetState()};FCKShowBlockCommand.prototype.RestoreState=function(){if(this._SavedState!=null&&this.GetState()!=this._SavedState){this.Execute()}};var FCKSpellCheckCommand=function(){this.Name="SpellCheck";this.IsEnabled=(FCKConfig.SpellChecker=="SpellerPages")};FCKSpellCheckCommand.prototype.Execute=function(){FCKDialog.OpenDialog("FCKDialog_SpellCheck","Spell Check","dialog/fck_spellerpages.html",440,480)};FCKSpellCheckCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return-1}return this.IsEnabled?0:-1};var FCKTextColorCommand=function(C){this.Name=C=="ForeColor"?"TextColor":"BGColor";this.Type=C;var D;if(FCKBrowserInfo.IsIE){D=window}else{if(FCK.ToolbarSet._IFrame){D=FCKTools.GetElementWindow(FCK.ToolbarSet._IFrame)}else{D=window.parent}}this._Panel=new FCKPanel(D);this._Panel.AppendStyleSheet(FCKConfig.SkinEditorCSS);this._Panel.MainNode.className="FCK_Panel";this._CreatePanelBody(this._Panel.Document,this._Panel.MainNode);FCK.ToolbarSet.ToolbarItems.GetItem(this.Name).RegisterPanel(this._Panel);FCKTools.DisableSelection(this._Panel.Document.body)};FCKTextColorCommand.prototype.Execute=function(D,F,E){this._Panel.Show(D,F,E)};FCKTextColorCommand.prototype.SetColor=function(C){FCKUndo.SaveUndoStep();var D=FCKStyles.GetStyle("_FCK_"+(this.Type=="ForeColor"?"Color":"BackColor"));if(!C||C.length==0){FCK.Styles.RemoveStyle(D)}else{D.SetVariable("Color",C);FCKStyles.ApplyStyle(D)}FCKUndo.SaveUndoStep();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange")};FCKTextColorCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return-1}return 0};function FCKTextColorCommand_OnMouseOver(){this.className="ColorSelected"}function FCKTextColorCommand_OnMouseOut(){this.className="ColorDeselected"}function FCKTextColorCommand_OnClick(D,F,E){this.className="ColorDeselected";F.SetColor(E);F._Panel.Hide()}function FCKTextColorCommand_AutoOnClick(C,D){this.className="ColorDeselected";D.SetColor("");D._Panel.Hide()}function FCKTextColorCommand_MoreOnClick(C,D){this.className="ColorDeselected";D._Panel.Hide();FCKDialog.OpenDialog("FCKDialog_Color",FCKLang.DlgColorTitle,"dialog/fck_colorselector.html",410,320,FCKTools.Bind(D,D.SetColor))}FCKTextColorCommand.prototype._CreatePanelBody=function(O,N){function P(){var A=O.createElement("DIV");A.className="ColorDeselected";FCKTools.AddEventListenerEx(A,"mouseover",FCKTextColorCommand_OnMouseOver);FCKTools.AddEventListenerEx(A,"mouseout",FCKTextColorCommand_OnMouseOut);return A}var F=N.appendChild(O.createElement("TABLE"));F.className="ForceBaseFont";F.style.tableLayout="fixed";F.cellPadding=0;F.cellSpacing=0;F.border=0;F.width=150;var X=F.insertRow(-1).insertCell(-1);X.colSpan=8;var M=X.appendChild(P());M.innerHTML='<table cellspacing="0" cellpadding="0" width="100%" border="0">\n   <tr>\n    <td><div class="ColorBoxBorder"><div class="ColorBox" style="background-color: #000000"></div></div></td>\n    <td nowrap width="100%" align="center">'+FCKLang.ColorAutomatic+"</td>\n   </tr>\n  </table>";FCKTools.AddEventListenerEx(M,"click",FCKTextColorCommand_AutoOnClick,this);if(!FCKBrowserInfo.IsIE){M.style.width="96%"}var W=FCKConfig.FontColors.toString().split(",");var V=0;while(V<W.length){var U=F.insertRow(-1);for(var Q=0;Q<8;Q++,V++){if(V<W.length){var T=W[V].split("/");var S="#"+T[0];var R=T[1]||S}M=U.insertCell(-1).appendChild(P());M.innerHTML='<div class="ColorBoxBorder"><div class="ColorBox" style="background-color: '+S+'"></div></div>';if(V>=W.length){M.style.visibility="hidden"}else{FCKTools.AddEventListenerEx(M,"click",FCKTextColorCommand_OnClick,[this,R])}}}if(FCKConfig.EnableMoreFontColors){X=F.insertRow(-1).insertCell(-1);X.colSpan=8;M=X.appendChild(P());M.innerHTML='<table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td nowrap align="center">'+FCKLang.ColorMoreColors+"</td></tr></table>";FCKTools.AddEventListenerEx(M,"click",FCKTextColorCommand_MoreOnClick,this)}if(!FCKBrowserInfo.IsIE){M.style.width="96%"}};var FCKPastePlainTextCommand=function(){this.Name="PasteText"};FCKPastePlainTextCommand.prototype.Execute=function(){FCK.PasteAsPlainText()};FCKPastePlainTextCommand.prototype.GetState=function(){if(FCK.EditMode!=0){return-1}return FCK.GetNamedCommandState("Paste")};var FCKPasteWordCommand=function(){this.Name="PasteWord"};FCKPasteWordCommand.prototype.Execute=function(){FCK.PasteFromWord()};FCKPasteWordCommand.prototype.GetState=function(){if(FCK.EditMode!=0||FCKConfig.ForcePasteAsPlainText){return-1}else{return FCK.GetNamedCommandState("Paste")}};var FCKTableCommand=function(B){this.Name=B};FCKTableCommand.prototype.Execute=function(){FCKUndo.SaveUndoStep();if(!FCKBrowserInfo.IsGecko){switch(this.Name){case"TableMergeRight":return FCKTableHandler.MergeRight();case"TableMergeDown":return FCKTableHandler.MergeDown()}}switch(this.Name){case"TableInsertRowAfter":return FCKTableHandler.InsertRow(false);case"TableInsertRowBefore":return FCKTableHandler.InsertRow(true);case"TableDeleteRows":return FCKTableHandler.DeleteRows();case"TableInsertColumnAfter":return FCKTableHandler.InsertColumn(false);case"TableInsertColumnBefore":return FCKTableHandler.InsertColumn(true);case"TableDeleteColumns":return FCKTableHandler.DeleteColumns();case"TableInsertCellAfter":return FCKTableHandler.InsertCell(null,false);case"TableInsertCellBefore":return FCKTableHandler.InsertCell(null,true);case"TableDeleteCells":return FCKTableHandler.DeleteCells();case"TableMergeCells":return FCKTableHandler.MergeCells();case"TableHorizontalSplitCell":return FCKTableHandler.HorizontalSplitCell();case"TableVerticalSplitCell":return FCKTableHandler.VerticalSplitCell();case"TableDelete":return FCKTableHandler.DeleteTable();default:return alert(FCKLang.UnknownCommand.replace(/%1/g,this.Name))}};FCKTableCommand.prototype.GetState=function(){if(FCK.EditorDocument!=null&&FCKSelection.HasAncestorNode("TABLE")){switch(this.Name){case"TableHorizontalSplitCell":case"TableVerticalSplitCell":if(FCKTableHandler.GetSelectedCells().length==1){return 0}else{return-1}case"TableMergeCells":if(FCKTableHandler.CheckIsSelectionRectangular()&&FCKTableHandler.GetSelectedCells().length>1){return 0}else{return-1}case"TableMergeRight":return FCKTableHandler.GetMergeRightTarget()?0:-1;case"TableMergeDown":return FCKTableHandler.GetMergeDownTarget()?0:-1;default:return 0}}else{return-1}};var FCKFitWindow=function(){this.Name="FitWindow"};FCKFitWindow.prototype.Execute=function(){var O=window.frameElement;var N=O.style;var M=parent;var L=M.document.documentElement;var V=M.document.body;var U=V.style;var T;var S=new FCKDomRange(FCK.EditorWindow);S.MoveToSelection();var R=FCKTools.GetScrollPosition(FCK.EditorWindow);if(!this.IsMaximized){if(FCKBrowserInfo.IsIE){M.attachEvent("onresize",FCKFitWindow_Resize)}else{M.addEventListener("resize",FCKFitWindow_Resize,true)}this._ScrollPos=FCKTools.GetScrollPosition(M);T=O;while((T=T.parentNode)){if(T.nodeType==1){T._fckSavedStyles=FCKTools.SaveStyles(T);T.style.zIndex=FCKConfig.FloatingPanelsZIndex-1}}if(FCKBrowserInfo.IsIE){this.documentElementOverflow=L.style.overflow;L.style.overflow="hidden";U.overflow="hidden"}else{U.overflow="hidden";U.width="0px";U.height="0px"}this._EditorFrameStyles=FCKTools.SaveStyles(O);var Q=FCKTools.GetViewPaneSize(M);N.position="absolute";O.offsetLeft;N.zIndex=FCKConfig.FloatingPanelsZIndex-1;N.left="0px";N.top="0px";N.width=Q.Width+"px";N.height=Q.Height+"px";if(!FCKBrowserInfo.IsIE){N.borderRight=N.borderBottom="9999px solid white";N.backgroundColor="white"}M.scrollTo(0,0);var P=FCKTools.GetWindowPosition(M,O);if(P.x!=0){N.left=(-1*P.x)+"px"}if(P.y!=0){N.top=(-1*P.y)+"px"}this.IsMaximized=true}else{if(FCKBrowserInfo.IsIE){M.detachEvent("onresize",FCKFitWindow_Resize)}else{M.removeEventListener("resize",FCKFitWindow_Resize,true)}T=O;while((T=T.parentNode)){if(T._fckSavedStyles){FCKTools.RestoreStyles(T,T._fckSavedStyles);T._fckSavedStyles=null}}if(FCKBrowserInfo.IsIE){L.style.overflow=this.documentElementOverflow}FCKTools.RestoreStyles(O,this._EditorFrameStyles);M.scrollTo(this._ScrollPos.X,this._ScrollPos.Y);this.IsMaximized=false}FCKToolbarItems.GetItem("FitWindow").RefreshState();if(FCK.EditMode==0){FCK.EditingArea.MakeEditable()}FCK.Focus();S.Select();FCK.EditorWindow.scrollTo(R.X,R.Y)};FCKFitWindow.prototype.GetState=function(){if(FCKConfig.ToolbarLocation!="In"){return-1}else{return(this.IsMaximized?1:0)}};function FCKFitWindow_Resize(){var C=FCKTools.GetViewPaneSize(parent);var D=window.frameElement.style;D.width=C.Width+"px";D.height=C.Height+"px"}var FCKListCommand=function(C,D){this.Name=C;this.TagName=D};FCKListCommand.prototype={GetState:function(){if(FCK.EditMode!=0||!FCK.EditorWindow){return-1}var C=FCKSelection.GetBoundaryParentElement(true);var D=C;while(D){if(D.nodeName.IEquals(["ul","ol"])){break}D=D.parentNode}if(D&&D.nodeName.IEquals(this.TagName)){return 1}else{return 0}},Execute:function(){FCKUndo.SaveUndoStep();var v=FCK.EditorDocument;var u=new FCKDomRange(FCK.EditorWindow);u.MoveToSelection();var t=this.GetState();if(t==0){FCKDomTools.TrimNode(v.body);if(!v.body.firstChild){var r=v.createElement("p");v.body.appendChild(r);u.MoveToNodeContents(r)}}var q=u.CreateBookmark();var p=[];var o={};var n=new FCKDomRangeIterator(u);var m;n.ForceBrBreak=(t==0);var l=true;var k=null;while(l){while((m=n.GetNextParagraph())){var j=new FCKElementPath(m);var h=null;var g=false;var f=j.BlockLimit;for(var x=j.Elements.length-1;x>=0;x--){var d=j.Elements[x];if(d.nodeName.IEquals(["ol","ul"])){if(f._FCK_ListGroupObject){f._FCK_ListGroupObject=null}var c=d._FCK_ListGroupObject;if(c){c.contents.push(m)}else{c={root:d,contents:[m]};p.push(c);FCKDomTools.SetElementMarker(o,d,"_FCK_ListGroupObject",c)}g=true;break}}if(g){continue}var b=f;if(b._FCK_ListGroupObject){b._FCK_ListGroupObject.contents.push(m)}else{var c={root:b,contents:[m]};FCKDomTools.SetElementMarker(o,b,"_FCK_ListGroupObject",c);p.push(c)}}if(FCKBrowserInfo.IsIE){l=false}else{if(k==null){k=[];var Y=FCKSelection.GetSelection();if(Y&&p.length==0){k.push(Y.getRangeAt(0))}for(var x=1;Y&&x<Y.rangeCount;x++){k.push(Y.getRangeAt(x))}}if(k.length<1){l=false}else{var X=FCKW3CRange.CreateFromRange(v,k.shift());u._Range=X;u._UpdateElementInfo();if(u.StartNode.nodeName.IEquals("td")){u.SetStart(u.StartNode,1)}if(u.EndNode.nodeName.IEquals("td")){u.SetEnd(u.EndNode,2)}n=new FCKDomRangeIterator(u);n.ForceBrBreak=(t==0)}}}var V=[];while(p.length>0){var c=p.shift();if(t==0){if(c.root.nodeName.IEquals(["ul","ol"])){this._ChangeListType(c,o,V)}else{this._CreateList(c,V)}}else{if(t==1&&c.root.nodeName.IEquals(["ul","ol"])){this._RemoveList(c,o)}}}for(var x=0;x<V.length;x++){var h=V[x];var S=false;var y=h;while(!S){y=y.nextSibling;if(y&&y.nodeType==3&&y.nodeValue.search(/^[\n\r\t ]*$/)==0){continue}S=true}if(y&&y.nodeName.IEquals(this.TagName)){y.parentNode.removeChild(y);while(y.firstChild){h.appendChild(y.removeChild(y.firstChild))}}S=false;y=h;while(!S){y=y.previousSibling;if(y&&y.nodeType==3&&y.nodeValue.search(/^[\n\r\t ]*$/)==0){continue}S=true}if(y&&y.nodeName.IEquals(this.TagName)){y.parentNode.removeChild(y);while(y.lastChild){h.insertBefore(y.removeChild(y.lastChild),h.firstChild)}}}FCKDomTools.ClearAllMarkers(o);u.MoveToBookmark(q);u.Select();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange")},_ChangeListType:function(M,L,K){var J=FCKDomTools.ListToArray(M.root,L);var S=[];for(var N=0;N<M.contents.length;N++){var R=M.contents[N];R=FCKTools.GetElementAscensor(R,"li");if(!R||R._FCK_ListItem_Processed){continue}S.push(R);FCKDomTools.SetElementMarker(L,R,"_FCK_ListItem_Processed",true)}var Q=FCKTools.GetElementDocument(M.root).createElement(this.TagName);for(var N=0;N<S.length;N++){var P=S[N]._FCK_ListArray_Index;J[P].parent=Q}var O=FCKDomTools.ArrayToList(J,L);for(var N=0;N<O.listNode.childNodes.length;N++){if(O.listNode.childNodes[N].nodeName.IEquals(this.TagName)){K.push(O.listNode.childNodes[N])}}M.root.parentNode.replaceChild(O.listNode,M.root)},_CreateList:function(Q,P){var O=Q.contents;var N=FCKTools.GetElementDocument(Q.root);var a=[];if(O.length==1&&O[0]==Q.root){var Z=N.createElement("div");while(O[0].firstChild){Z.appendChild(O[0].removeChild(O[0].firstChild))}O[0].appendChild(Z);O[0]=Z}var Y=Q.contents[0].parentNode;for(var R=0;R<O.length;R++){Y=FCKDomTools.GetCommonParents(Y,O[R].parentNode).pop()}for(var R=0;R<O.length;R++){var X=O[R];while(X.parentNode){if(X.parentNode==Y){a.push(X);break}X=X.parentNode}}if(a.length<1){return}var W=a[a.length-1].nextSibling;var V=N.createElement(this.TagName);P.push(V);while(a.length){var U=a.shift();var T=N.createDocumentFragment();while(U.firstChild){T.appendChild(U.removeChild(U.firstChild))}U.parentNode.removeChild(U);var S=N.createElement("li");S.appendChild(T);V.appendChild(S)}Y.insertBefore(V,W)},_RemoveList:function(N,M){var L=FCKDomTools.ListToArray(N.root,M);var K=[];for(var O=0;O<N.contents.length;O++){var U=N.contents[O];U=FCKTools.GetElementAscensor(U,"li");if(!U||U._FCK_ListItem_Processed){continue}K.push(U);FCKDomTools.SetElementMarker(M,U,"_FCK_ListItem_Processed",true)}var T=null;for(var O=0;O<K.length;O++){var S=K[O]._FCK_ListArray_Index;L[S].indent=-1;T=S}for(var O=T+1;O<L.length;O++){if(L[O].indent>L[O-1].indent+1){var R=L[O-1].indent+1-L[O].indent;var Q=L[O].indent;while(L[O]&&L[O].indent>=Q){L[O].indent+=R;O++}O--}}var P=FCKDomTools.ArrayToList(L,M);if(N.root.nextSibling==null||N.root.nextSibling.nodeName.IEquals("br")){if(P.listNode.lastChild.nodeName.IEquals("br")){P.listNode.removeChild(P.listNode.lastChild)}}N.root.parentNode.replaceChild(P.listNode,N.root)}};var FCKJustifyCommand=function(D){this.AlignValue=D;var F=FCKConfig.ContentLangDirection.toLowerCase();this.IsDefaultAlign=(D=="left"&&F=="ltr")||(D=="right"&&F=="rtl");var E=this._CssClassName=(function(){var A=FCKConfig.JustifyClasses;if(A){switch(D){case"left":return A[0]||null;case"center":return A[1]||null;case"right":return A[2]||null;case"justify":return A[3]||null}}return null})();if(E&&E.length>0){this._CssClassRegex=new RegExp("(?:^|\\s+)"+E+"(?=$|\\s)")}};FCKJustifyCommand._GetClassNameRegex=function(){var E=FCKJustifyCommand._ClassRegex;if(E!=undefined){return E}var I=[];var H=FCKConfig.JustifyClasses;if(H){for(var F=0;F<4;F++){var G=H[F];if(G&&G.length>0){I.push(G)}}}if(I.length>0){E=new RegExp("(?:^|\\s+)(?:"+I.join("|")+")(?=$|\\s)")}else{E=null}return FCKJustifyCommand._ClassRegex=E};FCKJustifyCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var I=new FCKDomRange(FCK.EditorWindow);I.MoveToSelection();var P=this.GetState();if(P==-1){return}var O=I.CreateBookmark();var N=this._CssClassName;var M=new FCKDomRangeIterator(I);var L;while((L=M.GetNextParagraph())){L.removeAttribute("align");if(N){var K=L.className.replace(FCKJustifyCommand._GetClassNameRegex(),"");if(P==0){if(K.length>0){K+=" "}L.className=K+N}else{if(K.length==0){FCKDomTools.RemoveAttribute(L,"class")}}}else{var J=L.style;if(P==0){J.textAlign=this.AlignValue}else{J.textAlign="";if(J.cssText.length==0){L.removeAttribute("style")}}}}I.MoveToBookmark(O);I.Select();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange")},GetState:function(){if(FCK.EditMode!=0||!FCK.EditorWindow){return-1}var D=new FCKElementPath(FCKSelection.GetBoundaryParentElement(true));var F=D.Block||D.BlockLimit;if(!F||F.nodeName.toLowerCase()=="body"){return 0}var E;if(FCKBrowserInfo.IsIE){E=F.currentStyle.textAlign}else{E=FCK.EditorWindow.getComputedStyle(F,"").getPropertyValue("text-align")}E=E.replace(/(-moz-|-webkit-|start|auto)/i,"");if((!E&&this.IsDefaultAlign)||E==this.AlignValue){return 1}return 0}};var FCKIndentCommand=function(C,D){this.Name=C;this.Offset=D;this.IndentCSSProperty=FCKConfig.ContentLangDirection.IEquals("ltr")?"marginLeft":"marginRight"};FCKIndentCommand._InitIndentModeParameters=function(){if(FCKConfig.IndentClasses&&FCKConfig.IndentClasses.length>0){this._UseIndentClasses=true;this._IndentClassMap={};for(var A=0;A<FCKConfig.IndentClasses.length;A++){this._IndentClassMap[FCKConfig.IndentClasses[A]]=A+1}this._ClassNameRegex=new RegExp("(?:^|\\s+)("+FCKConfig.IndentClasses.join("|")+")(?=$|\\s)")}else{this._UseIndentClasses=false}};FCKIndentCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var D=new FCKDomRange(FCK.EditorWindow);D.MoveToSelection();var F=D.CreateBookmark();var E=FCKDomTools.GetCommonParentNode(D.StartNode||D.StartContainer,D.EndNode||D.EndContainer,["ul","ol"]);if(E){this._IndentList(D,E)}else{this._IndentBlock(D)}D.MoveToBookmark(F);D.Select();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange")},GetState:function(){if(FCK.EditMode!=0||!FCK.EditorWindow){return-1}if(FCKIndentCommand._UseIndentClasses==undefined){FCKIndentCommand._InitIndentModeParameters()}var M=FCKSelection.GetBoundaryParentElement(true);var L=FCKSelection.GetBoundaryParentElement(false);var K=FCKDomTools.GetCommonParentNode(M,L,["ul","ol"]);if(K){if(this.Name.IEquals("outdent")){return 0}var J=FCKTools.GetElementAscensor(M,"li");if(!J||!J.previousSibling){return-1}return 0}if(!FCKIndentCommand._UseIndentClasses&&this.Name.IEquals("indent")){return 0}var R=new FCKElementPath(M);var Q=R.Block||R.BlockLimit;if(!Q){return-1}if(FCKIndentCommand._UseIndentClasses){var P=Q.className.match(FCKIndentCommand._ClassNameRegex);var O=0;if(P!=null){P=P[1];O=FCKIndentCommand._IndentClassMap[P]}if((this.Name=="outdent"&&O==0)||(this.Name=="indent"&&O==FCKConfig.IndentClasses.length)){return-1}return 0}else{var N=parseInt(Q.style[this.IndentCSSProperty],10);if(isNaN(N)){N=0}if(N<=0){return-1}return 0}},_IndentBlock:function(M){var L=new FCKDomRangeIterator(M);L.EnforceRealBlocks=true;M.Expand("block_contents");var K=FCKDomTools.GetCommonParents(M.StartContainer,M.EndContainer);var J=K[K.length-1];var R;while((R=L.GetNextParagraph())){if(!(R==J||R.parentNode==J)){continue}if(FCKIndentCommand._UseIndentClasses){var Q=R.className.match(FCKIndentCommand._ClassNameRegex);var P=0;if(Q!=null){Q=Q[1];P=FCKIndentCommand._IndentClassMap[Q]}if(this.Name.IEquals("outdent")){P--}else{if(this.Name.IEquals("indent")){P++}}P=Math.min(P,FCKConfig.IndentClasses.length);P=Math.max(P,0);var O=R.className.replace(FCKIndentCommand._ClassNameRegex,"");if(P<1){R.className=O}else{R.className=(O.length>0?O+" ":"")+FCKConfig.IndentClasses[P-1]}}else{var N=parseInt(R.style[this.IndentCSSProperty],10);if(isNaN(N)){N=0}N+=this.Offset;N=Math.max(N,0);N=Math.ceil(N/this.Offset)*this.Offset;R.style[this.IndentCSSProperty]=N?N+FCKConfig.IndentUnit:"";if(R.getAttribute("style")==""){R.removeAttribute("style")}}}},_IndentList:function(S,R){var Q=S.StartContainer;var P=S.EndContainer;while(Q&&Q.parentNode!=R){Q=Q.parentNode}while(P&&P.parentNode!=R){P=P.parentNode}if(!Q||!P){return}var f=Q;var d=[];var c=false;while(c==false){if(f==P){c=true}d.push(f);f=f.nextSibling}if(d.length<1){return}var b=FCKDomTools.GetParents(R);for(var T=0;T<b.length;T++){if(b[T].nodeName.IEquals(["ul","ol"])){R=b[T];break}}var a=this.Name.IEquals("indent")?1:-1;var Z=d[0];var Y=d[d.length-1];var X={};var W=FCKDomTools.ListToArray(R,X);var V=W[Y._FCK_ListArray_Index].indent;for(var T=Z._FCK_ListArray_Index;T<=Y._FCK_ListArray_Index;T++){W[T].indent+=a}for(var T=Y._FCK_ListArray_Index+1;T<W.length&&W[T].indent>V;T++){W[T].indent+=a}var U=FCKDomTools.ArrayToList(W);if(U){R.parentNode.replaceChild(U.listNode,R)}FCKDomTools.ClearAllMarkers(X)}};var FCKBlockQuoteCommand=function(){};FCKBlockQuoteCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var u=this.GetState();var t=new FCKDomRange(FCK.EditorWindow);t.MoveToSelection();var r=t.CreateBookmark();if(FCKBrowserInfo.IsIE){var q=t.GetBookmarkNode(r,true);var p=t.GetBookmarkNode(r,false);var o;if(q&&q.parentNode.nodeName.IEquals("blockquote")&&!q.previousSibling){o=q;while((o=o.nextSibling)){if(FCKListsLib.BlockElements[o.nodeName.toLowerCase()]){FCKDomTools.MoveNode(q,o,true)}}}if(p&&p.parentNode.nodeName.IEquals("blockquote")&&!p.previousSibling){o=p;while((o=o.nextSibling)){if(FCKListsLib.BlockElements[o.nodeName.toLowerCase()]){if(o.firstChild==q){FCKDomTools.InsertAfterNode(q,p)}else{FCKDomTools.MoveNode(p,o,true)}}}}}var n=new FCKDomRangeIterator(t);var m;if(u==0){n.EnforceRealBlocks=true;var l=[];while((m=n.GetNextParagraph())){l.push(m)}if(l.length<1){para=t.Window.document.createElement(FCKConfig.EnterMode.IEquals("p")?"p":"div");t.InsertNode(para);para.appendChild(t.Window.document.createTextNode("\ufeff"));t.MoveToBookmark(r);t.MoveToNodeContents(para);t.Collapse(true);r=t.CreateBookmark();l.push(para)}var k=l[0].parentNode;var j=[];for(var v=0;v<l.length;v++){m=l[v];k=FCKDomTools.GetCommonParents(m.parentNode,k).pop()}var h=null;while(l.length>0){m=l.shift();while(m.parentNode!=k){m=m.parentNode}if(m!=h){j.push(m)}h=m}while(j.length>0){m=j.shift();if(m.nodeName.IEquals("blockquote")){var g=FCKTools.GetElementDocument(m).createDocumentFragment();while(m.firstChild){g.appendChild(m.removeChild(m.firstChild));l.push(g.lastChild)}m.parentNode.replaceChild(g,m)}else{l.push(m)}}var f=t.Window.document.createElement("blockquote");k.insertBefore(f,l[0]);while(l.length>0){m=l.shift();f.appendChild(m)}}else{if(u==1){var d=[];while((m=n.GetNextParagraph())){var c=null;var b=null;while(m.parentNode){if(m.parentNode.nodeName.IEquals("blockquote")){c=m.parentNode;b=m;break}m=m.parentNode}if(c&&b){d.push(b)}}var a=[];while(d.length>0){var X=d.shift();var f=X.parentNode;if(X==X.parentNode.firstChild){f.parentNode.insertBefore(f.removeChild(X),f);if(!f.firstChild){f.parentNode.removeChild(f)}}else{if(X==X.parentNode.lastChild){f.parentNode.insertBefore(f.removeChild(X),f.nextSibling);if(!f.firstChild){f.parentNode.removeChild(f)}}else{FCKDomTools.BreakParent(X,X.parentNode,t)}}a.push(X)}if(FCKConfig.EnterMode.IEquals("br")){while(a.length){var X=a.shift();var V=true;if(X.nodeName.IEquals("div")){var g=FCKTools.GetElementDocument(X).createDocumentFragment();var U=V&&X.previousSibling&&!FCKListsLib.BlockBoundaries[X.previousSibling.nodeName.toLowerCase()];if(V&&U){g.appendChild(FCKTools.GetElementDocument(X).createElement("br"))}var T=X.nextSibling&&!FCKListsLib.BlockBoundaries[X.nextSibling.nodeName.toLowerCase()];while(X.firstChild){g.appendChild(X.removeChild(X.firstChild))}if(T){g.appendChild(FCKTools.GetElementDocument(X).createElement("br"))}X.parentNode.replaceChild(g,X);V=false}}}}}t.MoveToBookmark(r);t.Select();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange")},GetState:function(){if(FCK.EditMode!=0||!FCK.EditorWindow){return-1}var C=new FCKElementPath(FCKSelection.GetBoundaryParentElement(true));var E=C.Block||C.BlockLimit;if(!E||E.nodeName.toLowerCase()=="body"){return 0}for(var D=0;D<C.Elements.length;D++){if(C.Elements[D].nodeName.IEquals("blockquote")){return 1}}return 0}};var FCKCoreStyleCommand=function(B){this.Name="CoreStyle";this.StyleName="_FCK_"+B;this.IsActive=false;FCKStyles.AttachStyleStateChange(this.StyleName,this._OnStyleStateChange,this)};FCKCoreStyleCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();if(this.IsActive){FCKStyles.RemoveStyle(this.StyleName)}else{FCKStyles.ApplyStyle(this.StyleName)}FCK.Focus();FCK.Events.FireEvent("OnSelectionChange")},GetState:function(){if(FCK.EditMode!=0){return-1}return this.IsActive?1:0},_OnStyleStateChange:function(C,D){this.IsActive=D}};var FCKRemoveFormatCommand=function(){this.Name="RemoveFormat"};FCKRemoveFormatCommand.prototype={Execute:function(){FCKStyles.RemoveAll();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange")},GetState:function(){return FCK.EditorWindow?0:-1}};var FCKCommands=FCK.Commands={};FCKCommands.LoadedCommands={};FCKCommands.RegisterCommand=function(C,D){this.LoadedCommands[C]=D};FCKCommands.GetCommand=function(C){var D=FCKCommands.LoadedCommands[C];if(D){return D}switch(C){case"Bold":case"Italic":case"Underline":case"StrikeThrough":case"Subscript":case"Superscript":D=new FCKCoreStyleCommand(C);break;case"RemoveFormat":D=new FCKRemoveFormatCommand();break;case"DocProps":D=new FCKDialogCommand("DocProps",FCKLang.DocProps,"dialog/fck_docprops.html",400,380,FCKCommands.GetFullPageState);break;case"Templates":D=new FCKDialogCommand("Templates",FCKLang.DlgTemplatesTitle,"dialog/fck_template.html",380,450);break;case"Link":D=new FCKDialogCommand("Link",FCKLang.DlgLnkWindowTitle,"dialog/fck_link.html",400,300);break;case"Unlink":D=new FCKUnlinkCommand();break;case"VisitLink":D=new FCKVisitLinkCommand();break;case"Anchor":D=new FCKDialogCommand("Anchor",FCKLang.DlgAnchorTitle,"dialog/fck_anchor.html",370,160);break;case"AnchorDelete":D=new FCKAnchorDeleteCommand();break;case"BulletedList":D=new FCKDialogCommand("BulletedList",FCKLang.BulletedListProp,"dialog/fck_listprop.html?UL",370,160);break;case"NumberedList":D=new FCKDialogCommand("NumberedList",FCKLang.NumberedListProp,"dialog/fck_listprop.html?OL",370,160);break;case"About":D=new FCKDialogCommand("About",FCKLang.About,"dialog/fck_about.html",420,330,function(){return 0});break;case"Find":D=new FCKDialogCommand("Find",FCKLang.DlgFindAndReplaceTitle,"dialog/fck_replace.html",340,230,null,null,"Find");break;case"Replace":D=new FCKDialogCommand("Replace",FCKLang.DlgFindAndReplaceTitle,"dialog/fck_replace.html",340,230,null,null,"Replace");break;case"Image":D=new FCKDialogCommand("Image",FCKLang.DlgImgTitle,"dialog/fck_image.html",450,390);break;case"Flash":D=new FCKDialogCommand("Flash",FCKLang.DlgFlashTitle,"dialog/fck_flash.html",450,390);break;case"SpecialChar":D=new FCKDialogCommand("SpecialChar",FCKLang.DlgSpecialCharTitle,"dialog/fck_specialchar.html",400,290);break;case"Smiley":D=new FCKDialogCommand("Smiley",FCKLang.DlgSmileyTitle,"dialog/fck_smiley.html",FCKConfig.SmileyWindowWidth,FCKConfig.SmileyWindowHeight);break;case"Table":D=new FCKDialogCommand("Table",FCKLang.DlgTableTitle,"dialog/fck_table.html",480,250);break;case"TableProp":D=new FCKDialogCommand("Table",FCKLang.DlgTableTitle,"dialog/fck_table.html?Parent",480,250);break;case"TableCellProp":D=new FCKDialogCommand("TableCell",FCKLang.DlgCellTitle,"dialog/fck_tablecell.html",550,240);break;case"Style":D=new FCKStyleCommand();break;case"FontName":D=new FCKFontNameCommand();break;case"FontSize":D=new FCKFontSizeCommand();break;case"FontFormat":D=new FCKFormatBlockCommand();break;case"Source":D=new FCKSourceCommand();break;case"Preview":D=new FCKPreviewCommand();break;case"Save":D=new FCKSaveCommand();break;case"NewPage":D=new FCKNewPageCommand();break;case"PageBreak":D=new FCKPageBreakCommand();break;case"Rule":D=new FCKRuleCommand();break;case"Nbsp":D=new FCKNbsp();break;case"TextColor":D=new FCKTextColorCommand("ForeColor");break;case"BGColor":D=new FCKTextColorCommand("BackColor");break;case"Paste":D=new FCKPasteCommand();break;case"PasteText":D=new FCKPastePlainTextCommand();break;case"PasteWord":D=new FCKPasteWordCommand();break;case"JustifyLeft":D=new FCKJustifyCommand("left");break;case"JustifyCenter":D=new FCKJustifyCommand("center");break;case"JustifyRight":D=new FCKJustifyCommand("right");break;case"JustifyFull":D=new FCKJustifyCommand("justify");break;case"Indent":D=new FCKIndentCommand("indent",FCKConfig.IndentLength);break;case"Outdent":D=new FCKIndentCommand("outdent",FCKConfig.IndentLength*-1);break;case"Blockquote":D=new FCKBlockQuoteCommand();break;case"CreateDiv":D=new FCKDialogCommand("CreateDiv",FCKLang.CreateDiv,"dialog/fck_div.html",380,210,null,null,true);break;case"EditDiv":D=new FCKDialogCommand("EditDiv",FCKLang.EditDiv,"dialog/fck_div.html",380,210,null,null,false);break;case"DeleteDiv":D=new FCKDeleteDivCommand();break;case"TableInsertRowAfter":D=new FCKTableCommand("TableInsertRowAfter");break;case"TableInsertRowBefore":D=new FCKTableCommand("TableInsertRowBefore");break;case"TableDeleteRows":D=new FCKTableCommand("TableDeleteRows");break;case"TableInsertColumnAfter":D=new FCKTableCommand("TableInsertColumnAfter");break;case"TableInsertColumnBefore":D=new FCKTableCommand("TableInsertColumnBefore");break;case"TableDeleteColumns":D=new FCKTableCommand("TableDeleteColumns");break;case"TableInsertCellAfter":D=new FCKTableCommand("TableInsertCellAfter");break;case"TableInsertCellBefore":D=new FCKTableCommand("TableInsertCellBefore");break;case"TableDeleteCells":D=new FCKTableCommand("TableDeleteCells");break;case"TableMergeCells":D=new FCKTableCommand("TableMergeCells");break;case"TableMergeRight":D=new FCKTableCommand("TableMergeRight");break;case"TableMergeDown":D=new FCKTableCommand("TableMergeDown");break;case"TableHorizontalSplitCell":D=new FCKTableCommand("TableHorizontalSplitCell");break;case"TableVerticalSplitCell":D=new FCKTableCommand("TableVerticalSplitCell");break;case"TableDelete":D=new FCKTableCommand("TableDelete");break;case"Form":D=new FCKDialogCommand("Form",FCKLang.Form,"dialog/fck_form.html",380,210);break;case"Checkbox":D=new FCKDialogCommand("Checkbox",FCKLang.Checkbox,"dialog/fck_checkbox.html",380,200);break;case"Radio":D=new FCKDialogCommand("Radio",FCKLang.RadioButton,"dialog/fck_radiobutton.html",380,200);break;case"TextField":D=new FCKDialogCommand("TextField",FCKLang.TextField,"dialog/fck_textfield.html",380,210);break;case"Textarea":D=new FCKDialogCommand("Textarea",FCKLang.Textarea,"dialog/fck_textarea.html",380,210);break;case"HiddenField":D=new FCKDialogCommand("HiddenField",FCKLang.HiddenField,"dialog/fck_hiddenfield.html",380,190);break;case"Button":D=new FCKDialogCommand("Button",FCKLang.Button,"dialog/fck_button.html",380,210);break;case"Select":D=new FCKDialogCommand("Select",FCKLang.SelectionField,"dialog/fck_select.html",400,340);break;case"ImageButton":D=new FCKDialogCommand("ImageButton",FCKLang.ImageButton,"dialog/fck_image.html?ImageButton",450,390);break;case"SpellCheck":D=new FCKSpellCheckCommand();break;case"FitWindow":D=new FCKFitWindow();break;case"Undo":D=new FCKUndoCommand();break;case"Redo":D=new FCKRedoCommand();break;case"Copy":D=new FCKCutCopyCommand(false);break;case"Cut":D=new FCKCutCopyCommand(true);break;case"SelectAll":D=new FCKSelectAllCommand();break;case"InsertOrderedList":D=new FCKListCommand("insertorderedlist","ol");break;case"InsertUnorderedList":D=new FCKListCommand("insertunorderedlist","ul");break;case"ShowBlocks":D=new FCKShowBlockCommand("ShowBlocks",FCKConfig.StartupShowBlocks?1:0);break;case"Undefined":D=new FCKUndefinedCommand();break;default:if(FCKRegexLib.NamedCommands.test(C)){D=new FCKNamedCommand(C)}else{alert(FCKLang.UnknownCommand.replace(/%1/g,C));return null}}FCKCommands.LoadedCommands[C]=D;return D};FCKCommands.GetFullPageState=function(){return FCKConfig.FullPage?0:-1};FCKCommands.GetBooleanState=function(B){return B?-1:0};var FCKPanel=function(G){this.IsRTL=(FCKLang.Dir=="rtl");this.IsContextMenu=false;this._LockCounter=0;this._Window=G||window;var L;if(FCKBrowserInfo.IsIE){this._Popup=this._Window.createPopup();var K=this._Window.document;if(FCK_IS_CUSTOM_DOMAIN&&!FCKBrowserInfo.IsIE7){K.domain=FCK_ORIGINAL_DOMAIN;document.domain=FCK_ORIGINAL_DOMAIN}L=this.Document=this._Popup.document;if(FCK_IS_CUSTOM_DOMAIN){L.domain=FCK_RUNTIME_DOMAIN;K.domain=FCK_RUNTIME_DOMAIN;document.domain=FCK_RUNTIME_DOMAIN}FCK.IECleanup.AddItem(this,FCKPanel_Cleanup)}else{var J=this._IFrame=this._Window.document.createElement("iframe");FCKTools.ResetStyles(J);J.src="javascript:void(0)";J.allowTransparency=true;J.frameBorder="0";J.scrolling="no";J.style.width=J.style.height="0px";FCKDomTools.SetElementStyles(J,{position:"absolute",zIndex:FCKConfig.FloatingPanelsZIndex});this._Window.document.body.appendChild(J);var I=J.contentWindow;L=this.Document=I.document;var H="";if(FCKBrowserInfo.IsSafari){H='<base href="'+window.document.location+'">'}L.open();L.write("<html><head>"+H+'</head><body style="margin:0px;padding:0px;"></body></html>');L.close();if(FCKBrowserInfo.IsAIR){FCKAdobeAIR.Panel_Contructor(L,window.document.location)}FCKTools.AddEventListenerEx(I,"focus",FCKPanel_Window_OnFocus,this);FCKTools.AddEventListenerEx(I,"blur",FCKPanel_Window_OnBlur,this)}L.dir=FCKLang.Dir;FCKTools.AddEventListener(L,"contextmenu",FCKTools.CancelEvent);this.MainNode=L.body.appendChild(L.createElement("DIV"));this.MainNode.style.cssFloat=this.IsRTL?"right":"left"};FCKPanel.prototype.AppendStyleSheet=function(B){FCKTools.AppendStyleSheet(this.Document,B)};FCKPanel.prototype.Preload=function(C,D,B){if(this._Popup){this._Popup.show(C,D,0,0,B)}};FCKPanel.prototype.Show=function(W,U,Q,P,O){var N;var b=this.MainNode;if(this._Popup){this._Popup.show(W,U,0,0,Q);FCKDomTools.SetElementStyles(b,{B:P?P+"px":"",C:O?O+"px":""});N=b.offsetWidth;if(this.IsRTL){if(this.IsContextMenu){W=W-N+1}else{if(Q){W=(W*-1)+Q.offsetWidth-N}}}this._Popup.show(W,U,N,b.offsetHeight,Q);if(this.OnHide){if(this._Timer){CheckPopupOnHide.call(this,true)}this._Timer=FCKTools.SetInterval(CheckPopupOnHide,100,this)}}else{if(typeof(FCK.ToolbarSet.CurrentInstance.FocusManager)!="undefined"){FCK.ToolbarSet.CurrentInstance.FocusManager.Lock()}if(this.ParentPanel){this.ParentPanel.Lock();FCKPanel_Window_OnBlur(null,this.ParentPanel)}if(FCKBrowserInfo.IsGecko&&FCKBrowserInfo.IsMac){this._IFrame.scrolling="";FCKTools.RunFunction(function(){this._IFrame.scrolling="no"},this)}if(FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel&&FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel!=this){FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel.Hide(false,true)}FCKDomTools.SetElementStyles(b,{B:P?P+"px":"",C:O?O+"px":""});N=b.offsetWidth;if(!P){this._IFrame.width=1}if(!O){this._IFrame.height=1}N=b.offsetWidth||b.firstChild.offsetWidth;var a=FCKTools.GetDocumentPosition(this._Window,Q.nodeType==9?(FCKTools.IsStrictMode(Q)?Q.documentElement:Q.body):Q);var Z=FCKDomTools.GetPositionedAncestor(this._IFrame.parentNode);if(Z){var Y=FCKTools.GetDocumentPosition(FCKTools.GetElementWindow(Z),Z);a.x-=Y.x;a.y-=Y.y}if(this.IsRTL&&!this.IsContextMenu){W=(W*-1)}W+=a.x;U+=a.y;if(this.IsRTL){if(this.IsContextMenu){W=W-N+1}else{if(Q){W=W+Q.offsetWidth-N}}}else{var X=FCKTools.GetViewPaneSize(this._Window);var V=FCKTools.GetScrollPosition(this._Window);var T=X.Height+V.Y;var S=X.Width+V.X;if((W+N)>S){W-=W+N-S}if((U+b.offsetHeight)>T){U-=U+b.offsetHeight-T}}FCKDomTools.SetElementStyles(this._IFrame,{left:W+"px",top:U+"px"});this._IFrame.contentWindow.focus();this._IsOpened=true;var R=this;this._resizeTimer=setTimeout(function(){var B=b.offsetWidth||b.firstChild.offsetWidth;var A=b.offsetHeight;R._IFrame.style.width=B+"px";R._IFrame.style.height=A+"px"},0);FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel=this}FCKTools.RunFunction(this.OnShow,this)};FCKPanel.prototype.Hide=function(C,D){if(this._Popup){this._Popup.hide()}else{if(!this._IsOpened||this._LockCounter>0){return}if(typeof(FCKFocusManager)!="undefined"&&!D){FCKFocusManager.Unlock()}this._IFrame.style.width=this._IFrame.style.height="0px";this._IsOpened=false;if(this._resizeTimer){clearTimeout(this._resizeTimer);this._resizeTimer=null}if(this.ParentPanel){this.ParentPanel.Unlock()}if(!C){FCKTools.RunFunction(this.OnHide,this)}}};FCKPanel.prototype.CheckIsOpened=function(){if(this._Popup){return this._Popup.isOpen}else{return this._IsOpened}};FCKPanel.prototype.CreateChildPanel=function(){var C=this._Popup?FCKTools.GetDocumentWindow(this.Document):this._Window;var D=new FCKPanel(C);D.ParentPanel=this;return D};FCKPanel.prototype.Lock=function(){this._LockCounter++};FCKPanel.prototype.Unlock=function(){if(--this._LockCounter==0&&!this.HasFocus){this.Hide()}};function FCKPanel_Window_OnFocus(C,B){B.HasFocus=true}function FCKPanel_Window_OnBlur(C,B){B.HasFocus=false;if(B._LockCounter==0){FCKTools.RunFunction(B.Hide,B)}}function CheckPopupOnHide(B){if(B||!this._Popup.isOpen){window.clearInterval(this._Timer);this._Timer=null;FCKTools.RunFunction(this.OnHide,this)}}function FCKPanel_Cleanup(){this._Popup=null;this._Window=null;this.Document=null;this.MainNode=null}var FCKIcon=function(C){var D=C?typeof(C):"undefined";switch(D){case"number":this.Path=FCKConfig.SkinPath+"fck_strip.gif";this.Size=16;this.Position=C;break;case"undefined":this.Path=FCK_SPACER_PATH;break;case"string":this.Path=C;break;default:this.Path=C[0];this.Size=C[1];this.Position=C[2]}};FCKIcon.prototype.CreateIconElement=function(D){var G,E;if(this.Position){var F="-"+((this.Position-1)*this.Size)+"px";if(FCKBrowserInfo.IsIE){G=D.createElement("DIV");E=G.appendChild(D.createElement("IMG"));E.src=this.Path;E.style.top=F}else{G=D.createElement("IMG");G.src=FCK_SPACER_PATH;G.style.backgroundPosition="0px "+F;G.style.backgroundImage='url("'+this.Path+'")'}}else{if(FCKBrowserInfo.IsIE){G=D.createElement("DIV");E=G.appendChild(D.createElement("IMG"));E.src=this.Path?this.Path:FCK_SPACER_PATH}else{G=D.createElement("IMG");G.src=this.Path?this.Path:FCK_SPACER_PATH}}G.className="TB_Button_Image";return G};var FCKToolbarButtonUI=function(G,L,K,J,I,H){this.Name=G;this.Label=L||G;this.Tooltip=K||this.Label;this.Style=I||0;this.State=H||0;this.Icon=new FCKIcon(J);if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKToolbarButtonUI_Cleanup)}};FCKToolbarButtonUI.prototype._CreatePaddingElement=function(C){var D=C.createElement("IMG");D.className="TB_Button_Padding";D.src=FCK_SPACER_PATH;return D};FCKToolbarButtonUI.prototype.Create=function(H){var N=FCKTools.GetElementDocument(H);var M=this.MainElement=N.createElement("DIV");M.title=this.Tooltip;if(FCKBrowserInfo.IsGecko){M.onmousedown=FCKTools.CancelEvent}FCKTools.AddEventListenerEx(M,"mouseover",FCKToolbarButtonUI_OnMouseOver,this);FCKTools.AddEventListenerEx(M,"mouseout",FCKToolbarButtonUI_OnMouseOut,this);FCKTools.AddEventListenerEx(M,"click",FCKToolbarButtonUI_OnClick,this);this.ChangeState(this.State,true);if(this.Style==0&&!this.ShowArrow){M.appendChild(this.Icon.CreateIconElement(N))}else{var L=M.appendChild(N.createElement("TABLE"));L.cellPadding=0;L.cellSpacing=0;var K=L.insertRow(-1);var J=K.insertCell(-1);if(this.Style==0||this.Style==2){J.appendChild(this.Icon.CreateIconElement(N))}else{J.appendChild(this._CreatePaddingElement(N))}if(this.Style==1||this.Style==2){J=K.insertCell(-1);J.className="TB_Button_Text";J.noWrap=true;J.appendChild(N.createTextNode(this.Label))}if(this.ShowArrow){if(this.Style!=0){K.insertCell(-1).appendChild(this._CreatePaddingElement(N))}J=K.insertCell(-1);var I=J.appendChild(N.createElement("IMG"));I.src=FCKConfig.SkinPath+"images/toolbar.buttonarrow.gif";I.width=5;I.height=3}J=K.insertCell(-1);J.appendChild(this._CreatePaddingElement(N))}H.appendChild(M)};FCKToolbarButtonUI.prototype.ChangeState=function(C,E){if(!E&&this.State==C){return}var D=this.MainElement;if(!D){return}switch(parseInt(C,10)){case 0:D.className="TB_Button_Off";break;case 1:D.className="TB_Button_On";break;case-1:D.className="TB_Button_Disabled";break}this.State=C};function FCKToolbarButtonUI_OnMouseOver(C,D){if(D.State==0){this.className="TB_Button_Off_Over"}else{if(D.State==1){this.className="TB_Button_On_Over"}}}function FCKToolbarButtonUI_OnMouseOut(C,D){if(D.State==0){this.className="TB_Button_Off"}else{if(D.State==1){this.className="TB_Button_On"}}}function FCKToolbarButtonUI_OnClick(C,D){if(D.OnClick&&D.State!=-1){D.OnClick(D)}}function FCKToolbarButtonUI_Cleanup(){this.MainElement=null}var FCKToolbarButton=function(H,N,M,L,K,J,I){this.CommandName=H;this.Label=N;this.Tooltip=M;this.Style=L;this.SourceView=K?true:false;this.ContextSensitive=J?true:false;if(I==null){this.IconPath=FCKConfig.SkinPath+"toolbar/"+H.toLowerCase()+".gif"}else{if(typeof(I)=="number"){this.IconPath=[FCKConfig.SkinPath+"fck_strip.gif",16,I]}else{this.IconPath=I}}};FCKToolbarButton.prototype.Create=function(B){this._UIButton=new FCKToolbarButtonUI(this.CommandName,this.Label,this.Tooltip,this.IconPath,this.Style);this._UIButton.OnClick=this.Click;this._UIButton._ToolbarButton=this;this._UIButton.Create(B)};FCKToolbarButton.prototype.RefreshState=function(){var C=this._UIButton;if(!C){return}var D=FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName).GetState();if(D==C.State){return}C.ChangeState(D)};FCKToolbarButton.prototype.Click=function(){var B=this._ToolbarButton||this;FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(B.CommandName).Execute()};FCKToolbarButton.prototype.Enable=function(){this.RefreshState()};FCKToolbarButton.prototype.Disable=function(){this._UIButton.ChangeState(-1)};var FCKSpecialCombo=function(F,J,I,H,G){this.FieldWidth=J||100;this.PanelWidth=I||150;this.PanelMaxHeight=H||150;this.Label="&nbsp;";this.Caption=F;this.Tooltip=F;this.Style=2;this.Enabled=true;this.Items={};this._Panel=new FCKPanel(G||window);this._Panel.AppendStyleSheet(FCKConfig.SkinEditorCSS);this._PanelBox=this._Panel.MainNode.appendChild(this._Panel.Document.createElement("DIV"));this._PanelBox.className="SC_Panel";this._PanelBox.style.width=this.PanelWidth+"px";this._PanelBox.innerHTML='<table cellpadding="0" cellspacing="0" width="100%" style="TABLE-LAYOUT: fixed"><tr><td nowrap></td></tr></table>';this._ItemsHolderEl=this._PanelBox.getElementsByTagName("TD")[0];if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKSpecialCombo_Cleanup)}};function FCKSpecialCombo_ItemOnMouseOver(){this.className+=" SC_ItemOver"}function FCKSpecialCombo_ItemOnMouseOut(){this.className=this.originalClass}function FCKSpecialCombo_ItemOnClick(D,F,E){this.className=this.originalClass;F._Panel.Hide();F.SetLabel(this.FCKItemLabel);if(typeof(F.OnSelect)=="function"){F.OnSelect(E,this)}}FCKSpecialCombo.prototype.ClearItems=function(){if(this.Items){this.Items={}}var B=this._ItemsHolderEl;while(B.firstChild){B.removeChild(B.firstChild)}};FCKSpecialCombo.prototype.AddItem=function(F,J,I,H){var G=this._ItemsHolderEl.appendChild(this._Panel.Document.createElement("DIV"));G.className=G.originalClass="SC_Item";G.innerHTML=J;G.FCKItemLabel=I||F;G.Selected=false;if(FCKBrowserInfo.IsIE){G.style.width="100%"}if(H){G.style.backgroundColor=H}FCKTools.AddEventListenerEx(G,"mouseover",FCKSpecialCombo_ItemOnMouseOver);FCKTools.AddEventListenerEx(G,"mouseout",FCKSpecialCombo_ItemOnMouseOut);FCKTools.AddEventListenerEx(G,"click",FCKSpecialCombo_ItemOnClick,[this,F]);this.Items[F.toString().toLowerCase()]=G;return G};FCKSpecialCombo.prototype.SelectItem=function(B){if(typeof B=="string"){B=this.Items[B.toString().toLowerCase()]}if(B){B.className=B.originalClass="SC_ItemSelected";B.Selected=true}};FCKSpecialCombo.prototype.SelectItemByLabel=function(E,H){for(var G in this.Items){var F=this.Items[G];if(F.FCKItemLabel==E){F.className=F.originalClass="SC_ItemSelected";F.Selected=true;if(H){this.SetLabel(E)}}}};FCKSpecialCombo.prototype.DeselectAll=function(B){for(var C in this.Items){if(!this.Items[C]){continue}this.Items[C].className=this.Items[C].originalClass="SC_Item";this.Items[C].Selected=false}if(B){this.SetLabel("")}};FCKSpecialCombo.prototype.SetLabelById=function(C){C=C?C.toString().toLowerCase():"";var D=this.Items[C];this.SetLabel(D?D.FCKItemLabel:"")};FCKSpecialCombo.prototype.SetLabel=function(C){C=(!C||C.length==0)?"&nbsp;":C;if(C==this.Label){return}this.Label=C;var D=this._LabelEl;if(D){D.innerHTML=C;FCKTools.DisableSelection(D)}};FCKSpecialCombo.prototype.SetEnabled=function(B){this.Enabled=B;if(this._OuterTable){this._OuterTable.className=B?"":"SC_FieldDisabled"}};FCKSpecialCombo.prototype.Create=function(H){var N=FCKTools.GetElementDocument(H);var M=this._OuterTable=H.appendChild(N.createElement("TABLE"));M.cellPadding=0;M.cellSpacing=0;M.insertRow(-1);var L;var K;switch(this.Style){case 0:L="TB_ButtonType_Icon";K=false;break;case 1:L="TB_ButtonType_Text";K=false;break;case 2:K=true;break}if(this.Caption&&this.Caption.length>0&&K){var J=M.rows[0].insertCell(-1);J.innerHTML=this.Caption;J.className="SC_FieldCaption"}var I=FCKTools.AppendElement(M.rows[0].insertCell(-1),"div");if(K){I.className="SC_Field";I.style.width=this.FieldWidth+"px";I.innerHTML='<table width="100%" cellpadding="0" cellspacing="0" style="TABLE-LAYOUT: fixed;"><tbody><tr><td class="SC_FieldLabel"><label>&nbsp;</label></td><td class="SC_FieldButton">&nbsp;</td></tr></tbody></table>';this._LabelEl=I.getElementsByTagName("label")[0];this._LabelEl.innerHTML=this.Label}else{I.className="TB_Button_Off";I.innerHTML='<table title="'+this.Tooltip+'" class="'+L+'" cellspacing="0" cellpadding="0" border="0"><tr><td><img class="TB_Button_Padding" src="'+FCK_SPACER_PATH+'" /></td><td class="TB_Text">'+this.Caption+'</td><td><img class="TB_Button_Padding" src="'+FCK_SPACER_PATH+'" /></td><td class="TB_ButtonArrow"><img src="'+FCKConfig.SkinPath+'images/toolbar.buttonarrow.gif" width="5" height="3"></td><td><img class="TB_Button_Padding" src="'+FCK_SPACER_PATH+'" /></td></tr></table>'}FCKTools.AddEventListenerEx(I,"mouseover",FCKSpecialCombo_OnMouseOver,this);FCKTools.AddEventListenerEx(I,"mouseout",FCKSpecialCombo_OnMouseOut,this);FCKTools.AddEventListenerEx(I,"click",FCKSpecialCombo_OnClick,this);FCKTools.DisableSelection(this._Panel.Document.body)};function FCKSpecialCombo_Cleanup(){this._LabelEl=null;this._OuterTable=null;this._ItemsHolderEl=null;this._PanelBox=null;if(this.Items){for(var B in this.Items){this.Items[B]=null}}}function FCKSpecialCombo_OnMouseOver(C,D){if(D.Enabled){switch(D.Style){case 0:this.className="TB_Button_On_Over";break;case 1:this.className="TB_Button_On_Over";break;case 2:this.className="SC_Field SC_FieldOver";break}}}function FCKSpecialCombo_OnMouseOut(C,D){switch(D.Style){case 0:this.className="TB_Button_Off";break;case 1:this.className="TB_Button_Off";break;case 2:this.className="SC_Field";break}}function FCKSpecialCombo_OnClick(I,F){if(F.Enabled){var K=F._Panel;var J=F._PanelBox;var H=F._ItemsHolderEl;var G=F.PanelMaxHeight;if(F.OnBeforeClick){F.OnBeforeClick(F)}if(FCKBrowserInfo.IsIE){K.Preload(0,this.offsetHeight,this)}if(H.offsetHeight>G){J.style.height=G+"px"}else{J.style.height=""}K.Show(0,this.offsetHeight,this)}}var FCKToolbarSpecialCombo=function(){this.SourceView=false;this.ContextSensitive=true;this.FieldWidth=null;this.PanelWidth=null;this.PanelMaxHeight=null};FCKToolbarSpecialCombo.prototype.DefaultLabel="";function FCKToolbarSpecialCombo_OnSelect(C,D){FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName).Execute(C,D)}FCKToolbarSpecialCombo.prototype.Create=function(B){this._Combo=new FCKSpecialCombo(this.GetLabel(),this.FieldWidth,this.PanelWidth,this.PanelMaxHeight,FCKBrowserInfo.IsIE?window:FCKTools.GetElementWindow(B).parent);this._Combo.Tooltip=this.Tooltip;this._Combo.Style=this.Style;this.CreateItems(this._Combo);this._Combo.Create(B);this._Combo.CommandName=this.CommandName;this._Combo.OnSelect=FCKToolbarSpecialCombo_OnSelect};function FCKToolbarSpecialCombo_RefreshActiveItems(C,D){C.DeselectAll();C.SelectItem(D);C.SetLabelById(D)}FCKToolbarSpecialCombo.prototype.RefreshState=function(){var C;var D=FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName).GetState();if(D!=-1){C=1;if(this.RefreshActiveItems){this.RefreshActiveItems(this._Combo,D)}else{if(this._LastValue!==D){this._LastValue=D;if(!D||D.length==0){this._Combo.DeselectAll();this._Combo.SetLabel(this.DefaultLabel)}else{FCKToolbarSpecialCombo_RefreshActiveItems(this._Combo,D)}}}}else{C=-1}if(C==this.State){return}if(C==-1){this._Combo.DeselectAll();this._Combo.SetLabel("")}this.State=C;this._Combo.SetEnabled(C!=-1)};FCKToolbarSpecialCombo.prototype.Enable=function(){this.RefreshState()};FCKToolbarSpecialCombo.prototype.Disable=function(){this.State=-1;this._Combo.DeselectAll();this._Combo.SetLabel("");this._Combo.SetEnabled(false)};var FCKToolbarStyleCombo=function(C,D){if(C===false){return}this.CommandName="Style";this.Label=this.GetLabel();this.Tooltip=C?C:this.Label;this.Style=D?D:2;this.DefaultLabel=FCKConfig.DefaultStyleLabel||""};FCKToolbarStyleCombo.prototype=new FCKToolbarSpecialCombo;FCKToolbarStyleCombo.prototype.GetLabel=function(){return FCKLang.Style};FCKToolbarStyleCombo.prototype.GetStyles=function(){var E={};var H=FCK.ToolbarSet.CurrentInstance.Styles.GetStyles();for(var G in H){var F=H[G];if(!F.IsCore){E[G]=F}}return E};FCKToolbarStyleCombo.prototype.CreateItems=function(H){var N=H._Panel.Document;FCKTools.AppendStyleSheet(N,FCKConfig.ToolbarComboPreviewCSS);FCKTools.AppendStyleString(N,FCKConfig.EditorAreaStyles);N.body.className+=" ForceBaseFont";FCKConfig.ApplyBodyAttributes(N.body);var M=this.GetStyles();for(var L in M){var K=M[L];var J=K.GetType()==2?L:FCKToolbarStyleCombo_BuildPreview(K,K.Label||L);var I=H.AddItem(L,J);I.Style=K}H.OnBeforeClick=this.StyleCombo_OnBeforeClick};FCKToolbarStyleCombo.prototype.RefreshActiveItems=function(G){var N=FCK.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(true);if(N){var M=new FCKElementPath(N);var L=M.Elements;for(var K=0;K<L.length;K++){for(var H in G.Items){var J=G.Items[H];var I=J.Style;if(I.CheckElementRemovable(L[K],true)){G.SetLabel(I.Label||I.Name);return}}}}G.SetLabel(this.DefaultLabel)};FCKToolbarStyleCombo.prototype.StyleCombo_OnBeforeClick=function(H){H.DeselectAll();var O;var N;var M;var L=FCK.ToolbarSet.CurrentInstance.Selection;if(L.GetType()=="Control"){O=L.GetSelectedElement();M=O.nodeName.toLowerCase()}else{O=L.GetBoundaryParentElement(true);N=new FCKElementPath(O)}for(var I in H.Items){var K=H.Items[I];var J=K.Style;if((M&&J.Element==M)||(!M&&J.GetType()!=2)){K.style.display="";if((N&&J.CheckActive(N))||(!N&&J.CheckElementRemovable(O,true))){H.SelectItem(J.Name)}}else{K.style.display="none"}}};function FCKToolbarStyleCombo_BuildPreview(H,N){var M=H.GetType();var L=[];if(M==0){L.push('<div class="BaseFont">')}var K=H.Element;if(K=="bdo"){K="span"}L=["<",K];var J=H._StyleDesc.Attributes;if(J){for(var I in J){L.push(" ",I,'="',H.GetFinalAttributeValue(I),'"')}}if(H._GetStyleText().length>0){L.push(' style="',H.GetFinalStyleValue(),'"')}L.push(">",N,"</",K,">");if(M==0){L.push("</div>")}return L.join("")}var FCKToolbarFontFormatCombo=function(C,D){if(C===false){return}this.CommandName="FontFormat";this.Label=this.GetLabel();this.Tooltip=C?C:this.Label;this.Style=D?D:2;this.NormalLabel="Normal";this.PanelWidth=190;this.DefaultLabel=FCKConfig.DefaultFontFormatLabel||""};FCKToolbarFontFormatCombo.prototype=new FCKToolbarStyleCombo(false);FCKToolbarFontFormatCombo.prototype.GetLabel=function(){return FCKLang.FontFormat};FCKToolbarFontFormatCombo.prototype.GetStyles=function(){var G={};var M=FCKLang.FontFormats.split(";");var L={p:M[0],pre:M[1],address:M[2],h1:M[3],h2:M[4],h3:M[5],h4:M[6],h5:M[7],h6:M[8],div:M[9]||(M[0]+" (DIV)")};var K=FCKConfig.FontFormats.split(";");for(var H=0;H<K.length;H++){var J=K[H];var I=FCKStyles.GetStyle("_FCK_"+J);if(I){I.Label=L[J];G["_FCK_"+J]=I}else{alert("The FCKConfig.CoreStyles['"+J+"'] setting was not found. Please check the fckconfig.js file")}}return G};FCKToolbarFontFormatCombo.prototype.RefreshActiveItems=function(G){var M=FCK.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(true);if(M){var L=new FCKElementPath(M);var K=L.Block;if(K){for(var H in G.Items){var J=G.Items[H];var I=J.Style;if(I.CheckElementRemovable(K)){G.SetLabel(I.Label);return}}}}G.SetLabel(this.DefaultLabel)};FCKToolbarFontFormatCombo.prototype.StyleCombo_OnBeforeClick=function(G){G.DeselectAll();var M=FCK.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(true);if(M){var L=new FCKElementPath(M);var K=L.Block;for(var H in G.Items){var J=G.Items[H];var I=J.Style;if(I.CheckElementRemovable(K)){G.SelectItem(J);return}}}};var FCKToolbarFontsCombo=function(C,D){this.CommandName="FontName";this.Label=this.GetLabel();this.Tooltip=C?C:this.Label;this.Style=D?D:2;this.DefaultLabel=FCKConfig.DefaultFontLabel||""};FCKToolbarFontsCombo.prototype=new FCKToolbarFontFormatCombo(false);FCKToolbarFontsCombo.prototype.GetLabel=function(){return FCKLang.Font};FCKToolbarFontsCombo.prototype.GetStyles=function(){var H=FCKStyles.GetStyle("_FCK_FontFace");if(!H){alert("The FCKConfig.CoreStyles['Size'] setting was not found. Please check the fckconfig.js file");return{}}var O={};var N=FCKConfig.FontNames.split(";");for(var I=0;I<N.length;I++){var M=N[I].split("/");var L=M[0];var K=M[1]||L;var J=FCKTools.CloneObject(H);J.SetVariable("Font",L);J.Label=K;O[K]=J}return O};FCKToolbarFontsCombo.prototype.RefreshActiveItems=FCKToolbarStyleCombo.prototype.RefreshActiveItems;FCKToolbarFontsCombo.prototype.StyleCombo_OnBeforeClick=function(F){F.DeselectAll();var K=FCKSelection.GetBoundaryParentElement(true);if(K){var J=new FCKElementPath(K);for(var G in F.Items){var I=F.Items[G];var H=I.Style;if(H.CheckActive(J)){F.SelectItem(I);return}}}};var FCKToolbarFontSizeCombo=function(C,D){this.CommandName="FontSize";this.Label=this.GetLabel();this.Tooltip=C?C:this.Label;this.Style=D?D:2;this.DefaultLabel=FCKConfig.DefaultFontSizeLabel||"";this.FieldWidth=70};FCKToolbarFontSizeCombo.prototype=new FCKToolbarFontFormatCombo(false);FCKToolbarFontSizeCombo.prototype.GetLabel=function(){return FCKLang.FontSize};FCKToolbarFontSizeCombo.prototype.GetStyles=function(){var H=FCKStyles.GetStyle("_FCK_Size");if(!H){alert("The FCKConfig.CoreStyles['FontFace'] setting was not found. Please check the fckconfig.js file");return{}}var O={};var N=FCKConfig.FontSizes.split(";");for(var I=0;I<N.length;I++){var M=N[I].split("/");var L=M[0];var K=M[1]||L;var J=FCKTools.CloneObject(H);J.SetVariable("Size",L);J.Label=K;O[K]=J}return O};FCKToolbarFontSizeCombo.prototype.RefreshActiveItems=FCKToolbarStyleCombo.prototype.RefreshActiveItems;FCKToolbarFontSizeCombo.prototype.StyleCombo_OnBeforeClick=FCKToolbarFontsCombo.prototype.StyleCombo_OnBeforeClick;var FCKToolbarPanelButton=function(H,N,M,L,K){this.CommandName=H;var J;if(K==null){J=FCKConfig.SkinPath+"toolbar/"+H.toLowerCase()+".gif"}else{if(typeof(K)=="number"){J=[FCKConfig.SkinPath+"fck_strip.gif",16,K]}}var I=this._UIButton=new FCKToolbarButtonUI(H,N,M,J,L);I._FCKToolbarPanelButton=this;I.ShowArrow=true;I.OnClick=FCKToolbarPanelButton_OnButtonClick};FCKToolbarPanelButton.prototype.TypeName="FCKToolbarPanelButton";FCKToolbarPanelButton.prototype.Create=function(C){C.className+="Menu";this._UIButton.Create(C);var D=FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName)._Panel;this.RegisterPanel(D)};FCKToolbarPanelButton.prototype.RegisterPanel=function(D){if(D._FCKToolbarPanelButton){return}D._FCKToolbarPanelButton=this;var F=D.Document.body.appendChild(D.Document.createElement("div"));F.style.position="absolute";F.style.top="0px";var E=D._FCKToolbarPanelButtonLineDiv=F.appendChild(D.Document.createElement("IMG"));E.className="TB_ConnectionLine";E.style.position="absolute";E.src=FCK_SPACER_PATH;D.OnHide=FCKToolbarPanelButton_OnPanelHide};function FCKToolbarPanelButton_OnButtonClick(E){var I=this._FCKToolbarPanelButton;var G=I._UIButton.MainElement;I._UIButton.ChangeState(1);var H=FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(I.CommandName);var F=H._Panel;F._FCKToolbarPanelButtonLineDiv.style.width=(G.offsetWidth-2)+"px";H.Execute(0,G.offsetHeight-1,G)}function FCKToolbarPanelButton_OnPanelHide(){var B=this._FCKToolbarPanelButton;B._UIButton.ChangeState(0)}FCKToolbarPanelButton.prototype.RefreshState=FCKToolbarButton.prototype.RefreshState;FCKToolbarPanelButton.prototype.Enable=FCKToolbarButton.prototype.Enable;FCKToolbarPanelButton.prototype.Disable=FCKToolbarButton.prototype.Disable;var FCKToolbarItems={};FCKToolbarItems.LoadedItems={};FCKToolbarItems.RegisterItem=function(C,D){this.LoadedItems[C]=D};FCKToolbarItems.GetItem=function(C){var D=FCKToolbarItems.LoadedItems[C];if(D){return D}switch(C){case"Source":D=new FCKToolbarButton("Source",FCKLang.Source,null,2,true,true,1);break;case"DocProps":D=new FCKToolbarButton("DocProps",FCKLang.DocProps,null,null,null,null,2);break;case"Save":D=new FCKToolbarButton("Save",FCKLang.Save,null,null,true,null,3);break;case"NewPage":D=new FCKToolbarButton("NewPage",FCKLang.NewPage,null,null,true,null,4);break;case"Preview":D=new FCKToolbarButton("Preview",FCKLang.Preview,null,null,true,null,5);break;case"Templates":D=new FCKToolbarButton("Templates",FCKLang.Templates,null,null,null,null,6);break;case"About":D=new FCKToolbarButton("About",FCKLang.About,null,null,true,null,47);break;case"Cut":D=new FCKToolbarButton("Cut",FCKLang.Cut,null,null,false,true,7);break;case"Copy":D=new FCKToolbarButton("Copy",FCKLang.Copy,null,null,false,true,8);break;case"Paste":D=new FCKToolbarButton("Paste",FCKLang.Paste,null,null,false,true,9);break;case"PasteText":D=new FCKToolbarButton("PasteText",FCKLang.PasteText,null,null,false,true,10);break;case"PasteWord":D=new FCKToolbarButton("PasteWord",FCKLang.PasteWord,null,null,false,true,11);break;case"Print":D=new FCKToolbarButton("Print",FCKLang.Print,null,null,false,true,12);break;case"SpellCheck":D=new FCKToolbarButton("SpellCheck",FCKLang.SpellCheck,null,null,null,null,13);break;case"Undo":D=new FCKToolbarButton("Undo",FCKLang.Undo,null,null,false,true,14);break;case"Redo":D=new FCKToolbarButton("Redo",FCKLang.Redo,null,null,false,true,15);break;case"SelectAll":D=new FCKToolbarButton("SelectAll",FCKLang.SelectAll,null,null,true,null,18);break;case"RemoveFormat":D=new FCKToolbarButton("RemoveFormat",FCKLang.RemoveFormat,null,null,false,true,19);break;case"FitWindow":D=new FCKToolbarButton("FitWindow",FCKLang.FitWindow,null,null,true,true,66);break;case"Bold":D=new FCKToolbarButton("Bold",FCKLang.Bold,null,null,false,true,20);break;case"Italic":D=new FCKToolbarButton("Italic",FCKLang.Italic,null,null,false,true,21);break;case"Underline":D=new FCKToolbarButton("Underline",FCKLang.Underline,null,null,false,true,22);break;case"StrikeThrough":D=new FCKToolbarButton("StrikeThrough",FCKLang.StrikeThrough,null,null,false,true,23);break;case"Subscript":D=new FCKToolbarButton("Subscript",FCKLang.Subscript,null,null,false,true,24);break;case"Superscript":D=new FCKToolbarButton("Superscript",FCKLang.Superscript,null,null,false,true,25);break;case"OrderedList":D=new FCKToolbarButton("InsertOrderedList",FCKLang.NumberedListLbl,FCKLang.NumberedList,null,false,true,26);break;case"UnorderedList":D=new FCKToolbarButton("InsertUnorderedList",FCKLang.BulletedListLbl,FCKLang.BulletedList,null,false,true,27);break;case"Outdent":D=new FCKToolbarButton("Outdent",FCKLang.DecreaseIndent,null,null,false,true,28);break;case"Indent":D=new FCKToolbarButton("Indent",FCKLang.IncreaseIndent,null,null,false,true,29);break;case"Blockquote":D=new FCKToolbarButton("Blockquote",FCKLang.Blockquote,null,null,false,true,73);break;case"CreateDiv":D=new FCKToolbarButton("CreateDiv",FCKLang.CreateDiv,null,null,false,true,74);break;case"Link":D=new FCKToolbarButton("Link",FCKLang.InsertLinkLbl,FCKLang.InsertLink,null,false,true,34);break;case"Unlink":D=new FCKToolbarButton("Unlink",FCKLang.RemoveLink,null,null,false,true,35);break;case"Anchor":D=new FCKToolbarButton("Anchor",FCKLang.Anchor,null,null,null,null,36);break;case"Image":D=new FCKToolbarButton("Image",FCKLang.InsertImageLbl,FCKLang.InsertImage,null,false,true,37);break;case"Flash":D=new FCKToolbarButton("Flash",FCKLang.InsertFlashLbl,FCKLang.InsertFlash,null,false,true,38);break;case"Table":D=new FCKToolbarButton("Table",FCKLang.InsertTableLbl,FCKLang.InsertTable,null,false,true,39);break;case"SpecialChar":D=new FCKToolbarButton("SpecialChar",FCKLang.InsertSpecialCharLbl,FCKLang.InsertSpecialChar,null,false,true,42);break;case"Smiley":D=new FCKToolbarButton("Smiley",FCKLang.InsertSmileyLbl,FCKLang.InsertSmiley,null,false,true,41);break;case"PageBreak":D=new FCKToolbarButton("PageBreak",FCKLang.PageBreakLbl,FCKLang.PageBreak,null,false,true,43);break;case"Rule":D=new FCKToolbarButton("Rule",FCKLang.InsertLineLbl,FCKLang.InsertLine,null,false,true,40);break;case"JustifyLeft":D=new FCKToolbarButton("JustifyLeft",FCKLang.LeftJustify,null,null,false,true,30);break;case"JustifyCenter":D=new FCKToolbarButton("JustifyCenter",FCKLang.CenterJustify,null,null,false,true,31);break;case"JustifyRight":D=new FCKToolbarButton("JustifyRight",FCKLang.RightJustify,null,null,false,true,32);break;case"JustifyFull":D=new FCKToolbarButton("JustifyFull",FCKLang.BlockJustify,null,null,false,true,33);break;case"Style":D=new FCKToolbarStyleCombo();break;case"FontName":D=new FCKToolbarFontsCombo();break;case"FontSize":D=new FCKToolbarFontSizeCombo();break;case"FontFormat":D=new FCKToolbarFontFormatCombo();break;case"TextColor":D=new FCKToolbarPanelButton("TextColor",FCKLang.TextColor,null,null,45);break;case"BGColor":D=new FCKToolbarPanelButton("BGColor",FCKLang.BGColor,null,null,46);break;case"Find":D=new FCKToolbarButton("Find",FCKLang.Find,null,null,null,null,16);break;case"Replace":D=new FCKToolbarButton("Replace",FCKLang.Replace,null,null,null,null,17);break;case"Form":D=new FCKToolbarButton("Form",FCKLang.Form,null,null,null,null,48);break;case"Checkbox":D=new FCKToolbarButton("Checkbox",FCKLang.Checkbox,null,null,null,null,49);break;case"Radio":D=new FCKToolbarButton("Radio",FCKLang.RadioButton,null,null,null,null,50);break;case"TextField":D=new FCKToolbarButton("TextField",FCKLang.TextField,null,null,null,null,51);break;case"Textarea":D=new FCKToolbarButton("Textarea",FCKLang.Textarea,null,null,null,null,52);break;case"HiddenField":D=new FCKToolbarButton("HiddenField",FCKLang.HiddenField,null,null,null,null,56);break;case"Button":D=new FCKToolbarButton("Button",FCKLang.Button,null,null,null,null,54);break;case"Select":D=new FCKToolbarButton("Select",FCKLang.SelectionField,null,null,null,null,53);break;case"ImageButton":D=new FCKToolbarButton("ImageButton",FCKLang.ImageButton,null,null,null,null,55);break;case"ShowBlocks":D=new FCKToolbarButton("ShowBlocks",FCKLang.ShowBlocks,null,null,null,true,72);break;default:alert(FCKLang.UnknownToolbarItem.replace(/%1/g,C));return null}FCKToolbarItems.LoadedItems[C]=D;return D};var FCKToolbar=function(){this.Items=[]};FCKToolbar.prototype.AddItem=function(B){return this.Items[this.Items.length]=B};FCKToolbar.prototype.AddButton=function(H,N,M,L,K,J){if(typeof(L)=="number"){L=[this.DefaultIconsStrip,this.DefaultIconSize,L]}var I=new FCKToolbarButtonUI(H,N,M,L,K,J);I._FCKToolbar=this;I.OnClick=FCKToolbar_OnItemClick;return this.AddItem(I)};function FCKToolbar_OnItemClick(C){var D=C._FCKToolbar;if(D.OnItemClick){D.OnItemClick(D,C)}}FCKToolbar.prototype.AddSeparator=function(){this.AddItem(new FCKToolbarSeparator())};FCKToolbar.prototype.Create=function(E){var J=FCKTools.GetElementDocument(E);var H=J.createElement("table");H.className="TB_Toolbar";H.style.styleFloat=H.style.cssFloat=(FCKLang.Dir=="ltr"?"left":"right");H.dir=FCKLang.Dir;H.cellPadding=0;H.cellSpacing=0;var I=H.insertRow(-1);var G;if(!this.HideStart){G=I.insertCell(-1);G.appendChild(J.createElement("div")).className="TB_Start"}for(var F=0;F<this.Items.length;F++){this.Items[F].Create(I.insertCell(-1))}if(!this.HideEnd){G=I.insertCell(-1);G.appendChild(J.createElement("div")).className="TB_End"}E.appendChild(H)};var FCKToolbarSeparator=function(){};FCKToolbarSeparator.prototype.Create=function(B){FCKTools.AppendElement(B,"div").className="TB_Separator"};var FCKToolbarBreak=function(){};FCKToolbarBreak.prototype.Create=function(C){var D=C.ownerDocument.createElement("div");D.style.clear=D.style.cssFloat=FCKLang.Dir=="rtl"?"right":"left";C.appendChild(D)};function FCKToolbarSet_Create(A){var B;var C=A||FCKConfig.ToolbarLocation;switch(C){case"In":document.getElementById("xToolbarRow").style.display="";B=new FCKToolbarSet(document);break;case"None":B=new FCKToolbarSet(document);break;default:FCK.Events.AttachEvent("OnBlur",FCK_OnBlur);FCK.Events.AttachEvent("OnFocus",FCK_OnFocus);var D;var E=C.match(/^Out:(.+)\((\w+)\)$/);if(E){if(FCKBrowserInfo.IsAIR){FCKAdobeAIR.ToolbarSet_GetOutElement(window,E)}else{D=eval("parent."+E[1]).document.getElementById(E[2])}}else{E=C.match(/^Out:(\w+)$/);if(E){D=parent.document.getElementById(E[1])}}if(!D){alert('Invalid value for "ToolbarLocation"');return arguments.callee("In")}B=D.__FCKToolbarSet;if(B){break}var F=FCKTools.GetElementDocument(D).createElement("iframe");F.src="javascript:void(0)";F.frameBorder=0;F.width="100%";F.height="10";D.appendChild(F);F.unselectable="on";var G=F.contentWindow.document;var H="";if(FCKBrowserInfo.IsSafari){H='<base href="'+window.document.location+'">'}G.open();G.write("<html><head>"+H+'<script type="text/javascript"> var adjust = function() { window.frameElement.height = document.body.scrollHeight ; }; window.onresize = window.onload = function(){var timer = null;var lastHeight = -1;var lastChange = 0;var poller = function(){var currentHeight = document.body.scrollHeight || 0;var currentTime = (new Date()).getTime();if (currentHeight != lastHeight){lastChange = currentTime;adjust();lastHeight = document.body.scrollHeight;}if (lastChange < currentTime - 1000) clearInterval(timer);};timer = setInterval(poller, 100);}<\/script></head><body style="overflow: hidden">'+document.getElementById("xToolbarSpace").innerHTML+"</body></html>");G.close();if(FCKBrowserInfo.IsAIR){FCKAdobeAIR.ToolbarSet_InitOutFrame(G)}FCKTools.AddEventListener(G,"contextmenu",FCKTools.CancelEvent);FCKTools.AppendStyleSheet(G,FCKConfig.SkinEditorCSS);B=D.__FCKToolbarSet=new FCKToolbarSet(G);B._IFrame=F;if(FCK.IECleanup){FCK.IECleanup.AddItem(D,FCKToolbarSet_Target_Cleanup)}}B.CurrentInstance=FCK;if(!B.ToolbarItems){B.ToolbarItems=FCKToolbarItems}FCK.AttachToOnSelectionChange(B.RefreshItemsState);return B}function FCK_OnBlur(C){var D=C.ToolbarSet;if(D.CurrentInstance==C){D.Disable()}}function FCK_OnFocus(D){var F=D.ToolbarSet;var E=D||FCK;F.CurrentInstance.FocusManager.RemoveWindow(F._IFrame.contentWindow);F.CurrentInstance=E;E.FocusManager.AddWindow(F._IFrame.contentWindow,true);F.Enable()}function FCKToolbarSet_Cleanup(){this._TargetElement=null;this._IFrame=null}function FCKToolbarSet_Target_Cleanup(){this.__FCKToolbarSet=null}var FCKToolbarSet=function(D){this._Document=D;this._TargetElement=D.getElementById("xToolbar");var F=D.getElementById("xExpandHandle");var E=D.getElementById("xCollapseHandle");F.title=FCKLang.ToolbarExpand;FCKTools.AddEventListener(F,"click",FCKToolbarSet_Expand_OnClick);E.title=FCKLang.ToolbarCollapse;FCKTools.AddEventListener(E,"click",FCKToolbarSet_Collapse_OnClick);if(!FCKConfig.ToolbarCanCollapse||FCKConfig.ToolbarStartExpanded){this.Expand()}else{this.Collapse()}E.style.display=FCKConfig.ToolbarCanCollapse?"":"none";if(FCKConfig.ToolbarCanCollapse){E.style.display=""}else{D.getElementById("xTBLeftBorder").style.display=""}this.Toolbars=[];this.IsLoaded=false;if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKToolbarSet_Cleanup)}};function FCKToolbarSet_Expand_OnClick(){FCK.ToolbarSet.Expand()}function FCKToolbarSet_Collapse_OnClick(){FCK.ToolbarSet.Collapse()}FCKToolbarSet.prototype.Expand=function(){this._ChangeVisibility(false)};FCKToolbarSet.prototype.Collapse=function(){this._ChangeVisibility(true)};FCKToolbarSet.prototype._ChangeVisibility=function(B){this._Document.getElementById("xCollapsed").style.display=B?"":"none";this._Document.getElementById("xExpanded").style.display=B?"none":"";if(FCKBrowserInfo.IsGecko){FCKTools.RunFunction(window.onresize)}};FCKToolbarSet.prototype.Load=function(H){this.Name=H;this.Items=[];this.ItemsWysiwygOnly=[];this.ItemsContextSensitive=[];this._TargetElement.innerHTML="";var N=FCKConfig.ToolbarSets[H];if(!N){alert(FCKLang.UnknownToolbarSet.replace(/%1/g,H));return}this.Toolbars=[];for(var G=0;G<N.length;G++){var M=N[G];if(!M){continue}var L;if(typeof(M)=="string"){if(M=="/"){L=new FCKToolbarBreak()}}else{L=new FCKToolbar();for(var I=0;I<M.length;I++){var K=M[I];if(K=="-"){L.AddSeparator()}else{var J=FCKToolbarItems.GetItem(K);if(J){L.AddItem(J);this.Items.push(J);if(!J.SourceView){this.ItemsWysiwygOnly.push(J)}if(J.ContextSensitive){this.ItemsContextSensitive.push(J)}}}}}L.Create(this._TargetElement);this.Toolbars[this.Toolbars.length]=L}FCKTools.DisableSelection(this._Document.getElementById("xCollapseHandle").parentNode);if(FCK.Status!=2){FCK.Events.AttachEvent("OnStatusChange",this.RefreshModeState)}else{this.RefreshModeState()}this.IsLoaded=true;this.IsEnabled=true;FCKTools.RunFunction(this.OnLoad)};FCKToolbarSet.prototype.Enable=function(){if(this.IsEnabled){return}this.IsEnabled=true;var B=this.Items;for(var C=0;C<B.length;C++){B[C].RefreshState()}};FCKToolbarSet.prototype.Disable=function(){if(!this.IsEnabled){return}this.IsEnabled=false;var B=this.Items;for(var C=0;C<B.length;C++){B[C].Disable()}};FCKToolbarSet.prototype.RefreshModeState=function(D){if(FCK.Status!=2){return}var H=D?D.ToolbarSet:this;var G=H.ItemsWysiwygOnly;if(FCK.EditMode==0){for(var F=0;F<G.length;F++){G[F].Enable()}H.RefreshItemsState(D)}else{H.RefreshItemsState(D);for(var E=0;E<G.length;E++){G[E].Disable()}}};FCKToolbarSet.prototype.RefreshItemsState=function(C){var E=(C?C.ToolbarSet:this).ItemsContextSensitive;for(var D=0;D<E.length;D++){E[D].RefreshState()}};var FCKDialog=(function(){var H;var O;var N;var M=window.parent;while(M.parent&&M.parent!=M){try{if(M.parent.document.domain!=document.domain){break}if(M.parent.document.getElementsByTagName("frameset").length>0){break}}catch(L){break}M=M.parent}var K=M.document;var J=function(){if(!O){O=FCKConfig.FloatingPanelsZIndex+999}return++O};var I=function(){if(!N){return}var A=FCKTools.IsStrictMode(K)?K.documentElement:K.body;FCKDomTools.SetElementStyles(N,{width:Math.max(A.scrollWidth,A.clientWidth,K.scrollWidth||0)-1+"px",height:Math.max(A.scrollHeight,A.clientHeight,K.scrollHeight||0)-1+"px"})};return{OpenDialog:function(E,A,V,C,W,F,D,B){if(!H){this.DisplayMainCover()}var U={Title:A,Page:V,Editor:window,CustomValue:F,TopWindow:M};FCK.ToolbarSet.CurrentInstance.Selection.Save();var T=FCKTools.GetViewPaneSize(M);var S={X:0,Y:0};var R=FCKBrowserInfo.IsIE&&(!FCKBrowserInfo.IsIE7||!FCKTools.IsStrictMode(M.document));if(R){S=FCKTools.GetScrollPosition(M)}var Q=Math.max(S.Y+(T.Height-W-20)/2,0);var P=Math.max(S.X+(T.Width-C-20)/2,0);var G=K.createElement("iframe");FCKTools.ResetStyles(G);G.src=FCKConfig.BasePath+"fckdialog.html";G.frameBorder=0;G.allowTransparency=true;FCKDomTools.SetElementStyles(G,{position:(R)?"absolute":"fixed",top:Q+"px",left:P+"px",width:C+"px",height:W+"px",zIndex:J()});G._DialogArguments=U;K.body.appendChild(G);G._ParentDialog=H;H=G},OnDialogClose:function(B){var A=B.frameElement;FCKDomTools.RemoveNode(A);if(A._ParentDialog){H=A._ParentDialog;A._ParentDialog.contentWindow.SetEnabled(true)}else{if(!FCKBrowserInfo.IsIE){FCK.Focus()}this.HideMainCover();setTimeout(function(){H=null},0);FCK.ToolbarSet.CurrentInstance.Selection.Release()}},DisplayMainCover:function(){N=K.createElement("div");FCKTools.ResetStyles(N);FCKDomTools.SetElementStyles(N,{position:"absolute",zIndex:J(),top:"0px",left:"0px",backgroundColor:FCKConfig.BackgroundBlockerColor});FCKDomTools.SetOpacity(N,FCKConfig.BackgroundBlockerOpacity);if(FCKBrowserInfo.IsIE&&!FCKBrowserInfo.IsIE7){var B=K.createElement("iframe");FCKTools.ResetStyles(B);B.hideFocus=true;B.frameBorder=0;B.src=FCKTools.GetVoidUrl();FCKDomTools.SetElementStyles(B,{width:"100%",height:"100%",position:"absolute",left:"0px",top:"0px",filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});N.appendChild(B)}FCKTools.AddEventListener(M,"resize",I);I();K.body.appendChild(N);FCKFocusManager.Lock();var A=FCK.ToolbarSet.CurrentInstance.GetInstanceObject("frameElement");A._fck_originalTabIndex=A.tabIndex;A.tabIndex=-1},HideMainCover:function(){FCKDomTools.RemoveNode(N);FCKFocusManager.Unlock();var A=FCK.ToolbarSet.CurrentInstance.GetInstanceObject("frameElement");A.tabIndex=A._fck_originalTabIndex;FCKDomTools.ClearElementJSProperty(A,"_fck_originalTabIndex")},GetCover:function(){return N}}})();var FCKMenuItem=function(G,L,K,J,I,H){this.Name=L;this.Label=K||L;this.IsDisabled=I;this.Icon=new FCKIcon(J);this.SubMenu=new FCKMenuBlockPanel();this.SubMenu.Parent=G;this.SubMenu.OnClick=FCKTools.CreateEventListener(FCKMenuItem_SubMenu_OnClick,this);this.CustomData=H;if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKMenuItem_Cleanup)}};FCKMenuItem.prototype.AddItem=function(F,J,I,H,G){this.HasSubMenu=true;return this.SubMenu.AddItem(F,J,I,H,G)};FCKMenuItem.prototype.AddSeparator=function(){this.SubMenu.AddSeparator()};FCKMenuItem.prototype.Create=function(F){var K=this.HasSubMenu;var J=FCKTools.GetElementDocument(F);var G=this.MainElement=F.insertRow(-1);G.className=this.IsDisabled?"MN_Item_Disabled":"MN_Item";if(!this.IsDisabled){FCKTools.AddEventListenerEx(G,"mouseover",FCKMenuItem_OnMouseOver,[this]);FCKTools.AddEventListenerEx(G,"click",FCKMenuItem_OnClick,[this]);if(!K){FCKTools.AddEventListenerEx(G,"mouseout",FCKMenuItem_OnMouseOut,[this])}}var I=G.insertCell(-1);I.className="MN_Icon";I.appendChild(this.Icon.CreateIconElement(J));I=G.insertCell(-1);I.className="MN_Label";I.noWrap=true;I.appendChild(J.createTextNode(this.Label));I=G.insertCell(-1);if(K){I.className="MN_Arrow";var H=I.appendChild(J.createElement("IMG"));H.src=FCK_IMAGES_PATH+"arrow_"+FCKLang.Dir+".gif";H.width=4;H.height=7;this.SubMenu.Create();this.SubMenu.Panel.OnHide=FCKTools.CreateEventListener(FCKMenuItem_SubMenu_OnHide,this)}};FCKMenuItem.prototype.Activate=function(){this.MainElement.className="MN_Item_Over";if(this.HasSubMenu){this.SubMenu.Show(this.MainElement.offsetWidth+2,-2,this.MainElement)}FCKTools.RunFunction(this.OnActivate,this)};FCKMenuItem.prototype.Deactivate=function(){this.MainElement.className="MN_Item";if(this.HasSubMenu){this.SubMenu.Hide()}};function FCKMenuItem_SubMenu_OnClick(C,D){FCKTools.RunFunction(D.OnClick,D,[C])}function FCKMenuItem_SubMenu_OnHide(B){B.Deactivate()}function FCKMenuItem_OnClick(C,D){if(D.HasSubMenu){D.Activate()}else{D.Deactivate();FCKTools.RunFunction(D.OnClick,D,[D])}}function FCKMenuItem_OnMouseOver(C,D){D.Activate()}function FCKMenuItem_OnMouseOut(C,D){D.Deactivate()}function FCKMenuItem_Cleanup(){this.MainElement=null}var FCKMenuBlock=function(){this._Items=[]};FCKMenuBlock.prototype.Count=function(){return this._Items.length};FCKMenuBlock.prototype.AddItem=function(G,L,K,J,I){var H=new FCKMenuItem(this,G,L,K,J,I);H.OnClick=FCKTools.CreateEventListener(FCKMenuBlock_Item_OnClick,this);H.OnActivate=FCKTools.CreateEventListener(FCKMenuBlock_Item_OnActivate,this);this._Items.push(H);return H};FCKMenuBlock.prototype.AddSeparator=function(){this._Items.push(new FCKMenuSeparator())};FCKMenuBlock.prototype.RemoveAllItems=function(){this._Items=[];var B=this._ItemsTable;if(B){while(B.rows.length>0){B.deleteRow(0)}}};FCKMenuBlock.prototype.Create=function(F){if(!this._ItemsTable){if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKMenuBlock_Cleanup)}this._Window=FCKTools.GetElementWindow(F);var K=FCKTools.GetElementDocument(F);var J=F.appendChild(K.createElement("table"));J.cellPadding=0;J.cellSpacing=0;FCKTools.DisableSelection(J);var I=J.insertRow(-1).insertCell(-1);I.className="MN_Menu";var H=this._ItemsTable=I.appendChild(K.createElement("table"));H.cellPadding=0;H.cellSpacing=0}for(var G=0;G<this._Items.length;G++){this._Items[G].Create(this._ItemsTable)}};function FCKMenuBlock_Item_OnClick(C,D){if(D.Hide){D.Hide()}FCKTools.RunFunction(D.OnClick,D,[C])}function FCKMenuBlock_Item_OnActivate(C){var D=C._ActiveItem;if(D&&D!=this){if(!FCKBrowserInfo.IsIE&&D.HasSubMenu&&!this.HasSubMenu){C._Window.focus();C.Panel.HasFocus=true}D.Deactivate()}C._ActiveItem=this}function FCKMenuBlock_Cleanup(){this._Window=null;this._ItemsTable=null}var FCKMenuSeparator=function(){};FCKMenuSeparator.prototype.Create=function(D){var G=FCKTools.GetElementDocument(D);var E=D.insertRow(-1);var F=E.insertCell(-1);F.className="MN_Separator MN_Icon";F=E.insertCell(-1);F.className="MN_Separator";F.appendChild(G.createElement("DIV")).className="MN_Separator_Line";F=E.insertCell(-1);F.className="MN_Separator";F.appendChild(G.createElement("DIV")).className="MN_Separator_Line"};var FCKMenuBlockPanel=function(){FCKMenuBlock.call(this)};FCKMenuBlockPanel.prototype=new FCKMenuBlock();FCKMenuBlockPanel.prototype.Create=function(){var B=this.Panel=(this.Parent&&this.Parent.Panel?this.Parent.Panel.CreateChildPanel():new FCKPanel());B.AppendStyleSheet(FCKConfig.SkinEditorCSS);FCKMenuBlock.prototype.Create.call(this,B.MainNode)};FCKMenuBlockPanel.prototype.Show=function(C,D,B){if(!this.Panel.CheckIsOpened()){this.Panel.Show(C,D,B)}};FCKMenuBlockPanel.prototype.Hide=function(){if(this.Panel.CheckIsOpened()){this.Panel.Hide()}};var FCKContextMenu=function(E,H){this.CtrlDisable=false;var G=this._Panel=new FCKPanel(E);G.AppendStyleSheet(FCKConfig.SkinEditorCSS);G.IsContextMenu=true;if(FCKBrowserInfo.IsGecko){G.Document.addEventListener("draggesture",function(A){A.preventDefault();return false},true)}var F=this._MenuBlock=new FCKMenuBlock();F.Panel=G;F.OnClick=FCKTools.CreateEventListener(FCKContextMenu_MenuBlock_OnClick,this);this._Redraw=true};FCKContextMenu.prototype.SetMouseClickWindow=function(B){if(!FCKBrowserInfo.IsIE){this._Document=B.document;if(FCKBrowserInfo.IsOpera&&!("oncontextmenu"in document.createElement("foo"))){this._Document.addEventListener("mousedown",FCKContextMenu_Document_OnMouseDown,false);this._Document.addEventListener("mouseup",FCKContextMenu_Document_OnMouseUp,false)}this._Document.addEventListener("contextmenu",FCKContextMenu_Document_OnContextMenu,false)}};FCKContextMenu.prototype.AddItem=function(G,L,K,J,I){var H=this._MenuBlock.AddItem(G,L,K,J,I);this._Redraw=true;return H};FCKContextMenu.prototype.AddSeparator=function(){this._MenuBlock.AddSeparator();this._Redraw=true};FCKContextMenu.prototype.RemoveAllItems=function(){this._MenuBlock.RemoveAllItems();this._Redraw=true};FCKContextMenu.prototype.AttachToElement=function(B){if(FCKBrowserInfo.IsIE){FCKTools.AddEventListenerEx(B,"contextmenu",FCKContextMenu_AttachedElement_OnContextMenu,this)}else{B._FCKContextMenu=this}};function FCKContextMenu_Document_OnContextMenu(C){if(FCKConfig.BrowserContextMenu){return true}var B=C.target;while(B){if(B._FCKContextMenu){if(B._FCKContextMenu.CtrlDisable&&(C.ctrlKey||C.metaKey)){return true}FCKTools.CancelEvent(C);FCKContextMenu_AttachedElement_OnContextMenu(C,B._FCKContextMenu,B);return false}B=B.parentNode}return true}var FCKContextMenu_OverrideButton;function FCKContextMenu_Document_OnMouseDown(G){if(!G||G.button!=2){return false}if(FCKConfig.BrowserContextMenu){return true}var E=G.target;while(E){if(E._FCKContextMenu){if(E._FCKContextMenu.CtrlDisable&&(G.ctrlKey||G.metaKey)){return true}var I=FCKContextMenu_OverrideButton;if(!I){var H=FCKTools.GetElementDocument(G.target);I=FCKContextMenu_OverrideButton=H.createElement("input");I.type="button";var F=H.createElement("p");H.body.appendChild(F);F.appendChild(I)}I.style.cssText="position:absolute;top:"+(G.clientY-2)+"px;left:"+(G.clientX-2)+"px;width:5px;height:5px;opacity:0.01"}E=E.parentNode}return false}function FCKContextMenu_Document_OnMouseUp(D){if(FCKConfig.BrowserContextMenu){return true}var C=FCKContextMenu_OverrideButton;if(C){var E=C.parentNode;E.parentNode.removeChild(E);FCKContextMenu_OverrideButton=undefined;if(D&&D.button==2){FCKContextMenu_Document_OnContextMenu(D);return false}}return true}function FCKContextMenu_AttachedElement_OnContextMenu(F,J,H){if((J.CtrlDisable&&(F.ctrlKey||F.metaKey))||FCKConfig.BrowserContextMenu){return true}var G=H||this;if(J.OnBeforeOpen){J.OnBeforeOpen.call(J,G)}if(J._MenuBlock.Count()==0){return false}if(J._Redraw){J._MenuBlock.Create(J._Panel.MainNode);J._Redraw=false}FCKTools.DisableSelection(J._Panel.Document.body);var E=0;var I=0;if(FCKBrowserInfo.IsIE){E=F.screenX;I=F.screenY}else{if(FCKBrowserInfo.IsSafari){E=F.clientX;I=F.clientY}else{E=F.pageX;I=F.pageY}}J._Panel.Show(E,I,F.currentTarget||null);return false}function FCKContextMenu_MenuBlock_OnClick(C,D){D._Panel.Hide();FCKTools.RunFunction(D.OnItemClick,D,C)}FCK.ContextMenu={};FCK.ContextMenu.Listeners=[];FCK.ContextMenu.RegisterListener=function(B){if(B){this.Listeners.push(B)}};function FCK_ContextMenu_Init(){var C=FCK.ContextMenu._InnerContextMenu=new FCKContextMenu(FCKBrowserInfo.IsIE?window:window.parent,FCKLang.Dir);C.CtrlDisable=FCKConfig.BrowserContextMenuOnCtrl;C.OnBeforeOpen=FCK_ContextMenu_OnBeforeOpen;C.OnItemClick=FCK_ContextMenu_OnItemClick;var E=FCK.ContextMenu;for(var D=0;D<FCKConfig.ContextMenu.length;D++){E.RegisterListener(FCK_ContextMenu_GetListener(FCKConfig.ContextMenu[D]))}}function FCK_ContextMenu_GetListener(B){switch(B){case"Generic":return{AddItems:function(D,A,C){D.AddItem("Cut",FCKLang.Cut,7,FCKCommands.GetCommand("Cut").GetState()==-1);D.AddItem("Copy",FCKLang.Copy,8,FCKCommands.GetCommand("Copy").GetState()==-1);D.AddItem("Paste",FCKLang.Paste,9,FCKCommands.GetCommand("Paste").GetState()==-1)}};case"Table":return{AddItems:function(H,A,E){var I=(E=="TABLE");var G=(!I&&FCKSelection.HasAncestorNode("TABLE"));if(G){H.AddSeparator();var F=H.AddItem("Cell",FCKLang.CellCM);F.AddItem("TableInsertCellBefore",FCKLang.InsertCellBefore,69);F.AddItem("TableInsertCellAfter",FCKLang.InsertCellAfter,58);F.AddItem("TableDeleteCells",FCKLang.DeleteCells,59);if(FCKBrowserInfo.IsGecko){F.AddItem("TableMergeCells",FCKLang.MergeCells,60,FCKCommands.GetCommand("TableMergeCells").GetState()==-1)}else{F.AddItem("TableMergeRight",FCKLang.MergeRight,60,FCKCommands.GetCommand("TableMergeRight").GetState()==-1);F.AddItem("TableMergeDown",FCKLang.MergeDown,60,FCKCommands.GetCommand("TableMergeDown").GetState()==-1)}F.AddItem("TableHorizontalSplitCell",FCKLang.HorizontalSplitCell,61,FCKCommands.GetCommand("TableHorizontalSplitCell").GetState()==-1);F.AddItem("TableVerticalSplitCell",FCKLang.VerticalSplitCell,61,FCKCommands.GetCommand("TableVerticalSplitCell").GetState()==-1);F.AddSeparator();F.AddItem("TableCellProp",FCKLang.CellProperties,57,FCKCommands.GetCommand("TableCellProp").GetState()==-1);H.AddSeparator();F=H.AddItem("Row",FCKLang.RowCM);F.AddItem("TableInsertRowBefore",FCKLang.InsertRowBefore,70);F.AddItem("TableInsertRowAfter",FCKLang.InsertRowAfter,62);F.AddItem("TableDeleteRows",FCKLang.DeleteRows,63);H.AddSeparator();F=H.AddItem("Column",FCKLang.ColumnCM);F.AddItem("TableInsertColumnBefore",FCKLang.InsertColumnBefore,71);F.AddItem("TableInsertColumnAfter",FCKLang.InsertColumnAfter,64);F.AddItem("TableDeleteColumns",FCKLang.DeleteColumns,65)}if(I||G){H.AddSeparator();H.AddItem("TableDelete",FCKLang.TableDelete);H.AddItem("TableProp",FCKLang.TableProperties,39)}}};case"Link":return{AddItems:function(J,A,C){var I=(C=="A"||FCKSelection.HasAncestorNode("A"));if(I||FCK.GetNamedCommandState("Unlink")!=-1){var H=FCKSelection.MoveToAncestorNode("A");var D=(H&&H.name.length>0&&H.href.length==0);if(D){return}J.AddSeparator();J.AddItem("VisitLink",FCKLang.VisitLink);J.AddSeparator();if(I){J.AddItem("Link",FCKLang.EditLink,34)}J.AddItem("Unlink",FCKLang.RemoveLink,35)}}};case"Image":return{AddItems:function(D,A,C){if(C=="IMG"&&!A.getAttribute("_fckfakelement")){D.AddSeparator();D.AddItem("Image",FCKLang.ImageProperties,37)}}};case"Anchor":return{AddItems:function(H,A,C){var E=FCKSelection.MoveToAncestorNode("A");var D=(E&&E.name.length>0);if(D||(C=="IMG"&&A.getAttribute("_fckanchor"))){H.AddSeparator();H.AddItem("Anchor",FCKLang.AnchorProp,36);H.AddItem("AnchorDelete",FCKLang.AnchorDelete)}}};case"Flash":return{AddItems:function(D,A,C){if(C=="IMG"&&A.getAttribute("_fckflash")){D.AddSeparator();D.AddItem("Flash",FCKLang.FlashProperties,38)}}};case"Form":return{AddItems:function(D,A,C){if(FCKSelection.HasAncestorNode("FORM")){D.AddSeparator();D.AddItem("Form",FCKLang.FormProp,48)}}};case"Checkbox":return{AddItems:function(D,A,C){if(C=="INPUT"&&A.type=="checkbox"){D.AddSeparator();D.AddItem("Checkbox",FCKLang.CheckboxProp,49)}}};case"Radio":return{AddItems:function(D,A,C){if(C=="INPUT"&&A.type=="radio"){D.AddSeparator();D.AddItem("Radio",FCKLang.RadioButtonProp,50)}}};case"TextField":return{AddItems:function(D,A,C){if(C=="INPUT"&&(A.type=="text"||A.type=="password")){D.AddSeparator();D.AddItem("TextField",FCKLang.TextFieldProp,51)}}};case"HiddenField":return{AddItems:function(D,A,C){if(C=="IMG"&&A.getAttribute("_fckinputhidden")){D.AddSeparator();D.AddItem("HiddenField",FCKLang.HiddenFieldProp,56)}}};case"ImageButton":return{AddItems:function(D,A,C){if(C=="INPUT"&&A.type=="image"){D.AddSeparator();D.AddItem("ImageButton",FCKLang.ImageButtonProp,55)}}};case"Button":return{AddItems:function(D,A,C){if(C=="INPUT"&&(A.type=="button"||A.type=="submit"||A.type=="reset")){D.AddSeparator();D.AddItem("Button",FCKLang.ButtonProp,54)}}};case"Select":return{AddItems:function(D,A,C){if(C=="SELECT"){D.AddSeparator();D.AddItem("Select",FCKLang.SelectionFieldProp,53)}}};case"Textarea":return{AddItems:function(D,A,C){if(C=="TEXTAREA"){D.AddSeparator();D.AddItem("Textarea",FCKLang.TextareaProp,52)}}};case"BulletedList":return{AddItems:function(D,A,C){if(FCKSelection.HasAncestorNode("UL")){D.AddSeparator();D.AddItem("BulletedList",FCKLang.BulletedListProp,27)}}};case"NumberedList":return{AddItems:function(D,A,C){if(FCKSelection.HasAncestorNode("OL")){D.AddSeparator();D.AddItem("NumberedList",FCKLang.NumberedListProp,26)}}};case"DivContainer":return{AddItems:function(E,A,D){var C=FCKDomTools.GetSelectedDivContainers();if(C.length>0){E.AddSeparator();E.AddItem("EditDiv",FCKLang.EditDiv,75);E.AddItem("DeleteDiv",FCKLang.DeleteDiv,76)}}}}return null}function FCK_ContextMenu_OnBeforeOpen(){FCK.Events.FireEvent("OnSelectionChange");var D,E;if((D=FCKSelection.GetSelectedElement())){E=D.tagName}var H=FCK.ContextMenu._InnerContextMenu;H.RemoveAllItems();var G=FCK.ContextMenu.Listeners;for(var F=0;F<G.length;F++){G[F].AddItems(H,D,E)}}function FCK_ContextMenu_OnItemClick(B){FCK.Focus();FCKCommands.GetCommand(B.Name).Execute(B.CustomData)}var FCKHtmlIterator=function(B){this._sourceHtml=B};FCKHtmlIterator.prototype={Next:function(){var E=this._sourceHtml;if(E==null){return null}var H=FCKRegexLib.HtmlTag.exec(E);var G=false;var F="";if(H){if(H.index>0){F=E.substr(0,H.index);this._sourceHtml=E.substr(H.index)}else{G=true;F=H[0];this._sourceHtml=E.substr(H[0].length)}}else{F=E;this._sourceHtml=null}return{isTag:G,value:F}},Each:function(C){var D;while((D=this.Next())){C(D.isTag,D.value)}}};var FCKHtmlIterator=function(B){this._sourceHtml=B};FCKHtmlIterator.prototype={Next:function(){var E=this._sourceHtml;if(E==null){return null}var H=FCKRegexLib.HtmlTag.exec(E);var G=false;var F="";if(H){if(H.index>0){F=E.substr(0,H.index);this._sourceHtml=E.substr(H.index)}else{G=true;F=H[0];this._sourceHtml=E.substr(H[0].length)}}else{F=E;this._sourceHtml=null}return{isTag:G,value:F}},Each:function(C){var D;while((D=this.Next())){C(D.isTag,D.value)}}};var FCKPlugin=function(D,F,E){this.Name=D;this.BasePath=E?E:FCKConfig.PluginsPath;this.Path=this.BasePath+D+"/";if(!F||F.length==0){this.AvailableLangs=[]}else{this.AvailableLangs=F.split(",")}};FCKPlugin.prototype.Load=function(){if(this.AvailableLangs.length>0){var B;if(this.AvailableLangs.IndexOf(FCKLanguageManager.ActiveLanguage.Code)>=0){B=FCKLanguageManager.ActiveLanguage.Code}else{B=this.AvailableLangs[0]}LoadScript(this.Path+"lang/"+B+".js")}LoadScript(this.Path+"fckplugin.js")};var FCKPlugins=FCK.Plugins={};FCKPlugins.ItemsCount=0;FCKPlugins.Items={};FCKPlugins.Load=function(){var D=FCKPlugins.Items;for(var E=0;E<FCKConfig.Plugins.Items.length;E++){var H=FCKConfig.Plugins.Items[E];var G=D[H[0]]=new FCKPlugin(H[0],H[1],H[2]);FCKPlugins.ItemsCount++}for(var F in D){D[F].Load()}FCKPlugins.Load=null};